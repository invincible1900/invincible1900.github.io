<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta http-equiv="X-UA-Compatible" content="ie=edge">
<title>Markmap</title>
<style>
* {
  margin: 0;
  padding: 0;
}
#mindmap {
  display: block;
  width: 100vw;
  height: 100vh;
}
</style>
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/prismjs@1.25.0/themes/prism.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/markmap-toolbar@0.2.0/dist/style.css">
</head>
<body>
<svg id="mindmap"></svg>
<script src="https://cdn.jsdelivr.net/npm/d3@6.7.0"></script><script src="https://cdn.jsdelivr.net/npm/markmap-view@0.2.7"></script><script src="https://cdn.jsdelivr.net/npm/markmap-toolbar@0.2.0/dist/index.umd.min.js"></script><script>(r => {
                setTimeout(r);
              })(() => {
  const {
    markmap,
    mm
  } = window;
  const toolbar = new markmap.Toolbar();
  toolbar.attach(mm);
  const el = toolbar.render();
  el.setAttribute('style', 'position:absolute;bottom:20px;right:20px');
  document.body.append(el);
})</script><script>((getMarkmap, getOptions, data) => {
        const {
          Markmap
        } = getMarkmap();
        window.mm = Markmap.create('svg#mindmap', getOptions == null ? void 0 : getOptions(), data);
      })(() => window.markmap,null,{"t":"heading","d":1,"p":{"lines":[0,1]},"v":"Nodes","c":[{"t":"bullet_list","d":2,"p":{"lines":[1,150]},"v":"","c":[{"t":"list_item","d":3,"p":{"lines":[1,2]},"v":"Takeaway","c":[{"t":"list_item","d":5,"p":{"lines":[2,3]},"v":"创建一个 Node 对象实例 node 的时候，会创建一段连续内存"},{"t":"list_item","d":5,"p":{"lines":[3,4]},"v":"node 的左边(内存低地址方向) 保存的是 Node::Use 对象数组(<code>sizeof(arr[i]) == sizeof(Node::Use)</code>)"},{"t":"list_item","d":5,"p":{"lines":[4,5]},"v":"node 的右边(内存高地址方向) 保存的是 Node::Inputs.input_root_为首的指针数组 (<code>sizeof(arr[i] == sizeof(ZoneNodePtr) == sizeof(Node *)</code>)"},{"t":"list_item","d":5,"p":{"lines":[5,6]},"v":"Node::Use 保存的是 node 的出口节点(Turbolizer图中位于该节点的下方)"},{"t":"list_item","d":5,"p":{"lines":[6,7]},"v":"Node::Inputs 区域保存的是 node 的入口节点(Turbolizer图中位于该节点的上方)"},{"t":"list_item","d":5,"p":{"lines":[7,8]},"v":"一个 Edge 对象代表的是连接两个 node 的线，Edge.to() 节点(位于 Turbolizer图的上方) 指向 Edge.from()(位于下方) 节点"}]},{"t":"list_item","d":3,"p":{"lines":[8,9]},"v":"The Big Map","c":[{"t":"list_item","d":5,"p":{"lines":[9,10]},"v":"class Node","c":[{"t":"list_item","d":7,"p":{"lines":[10,11]},"v":"class Node::Inputs"},{"t":"list_item","d":7,"p":{"lines":[11,12]},"v":"class Node::Use"},{"t":"list_item","d":7,"p":{"lines":[12,13]},"v":"class Node::UseEdges"},{"t":"list_item","d":7,"p":{"lines":[13,14]},"v":"class Node::InputEdges"}]},{"t":"list_item","d":5,"p":{"lines":[14,15]},"v":"class Edge"},{"t":"list_item","d":5,"p":{"lines":[15,16]},"v":"class NodeProperties"},{"t":"list_item","d":5,"p":{"lines":[16,17]},"v":"class NodeWrapper"},{"t":"list_item","d":5,"p":{"lines":[17,18]},"v":"class ZoneNodePtr"}]},{"t":"list_item","d":3,"p":{"lines":[18,150]},"v":"<pre class=\"language-cpp\"><code class=\"language-cpp\"><span class=\"token comment\">// src/compiler/node.h</span>\n<span class=\"token number\">214</span>   <span class=\"token comment\">// {Use} links are laid out in memory directly before a {Node}, followed by</span>\n<span class=\"token number\">215</span>   <span class=\"token comment\">// direct pointers to input {Nodes}.</span>\n<span class=\"token number\">216</span>   <span class=\"token comment\">//</span>\n<span class=\"token number\">217</span>   <span class=\"token comment\">// inline case:</span>\n<span class=\"token number\">218</span>   <span class=\"token comment\">// |Use #N  |Use #N-1|...|Use #1  |Use #0  |Node xxxx |I#0|I#1|...|I#N-1|I#N|</span>\n<span class=\"token number\">219</span>   <span class=\"token comment\">//          ^                              ^                  ^</span>\n<span class=\"token number\">220</span>   <span class=\"token comment\">//          + Use                          + Node             + Input</span>\n<span class=\"token comment\">// ++++++++++++++++++++++++++++++++++++++++++++++++++++++++++</span>\n<span class=\"token comment\">// src/compiler/node.cc</span>\n<span class=\"token comment\">// 连续内存的创建</span>\n<span class=\"token number\">58</span> Node<span class=\"token operator\">*</span> <span class=\"token class-name\">Node</span><span class=\"token double-colon punctuation\">::</span><span class=\"token function\">NewImpl</span><span class=\"token punctuation\">(</span>Zone<span class=\"token operator\">*</span> zone<span class=\"token punctuation\">,</span> NodeId id<span class=\"token punctuation\">,</span> <span class=\"token keyword\">const</span> Operator<span class=\"token operator\">*</span> op<span class=\"token punctuation\">,</span> <span class=\"token keyword\">int</span> input_count<span class=\"token punctuation\">,</span>\n<span class=\"token punctuation\">.</span><span class=\"token punctuation\">.</span><span class=\"token punctuation\">.</span>\n<span class=\"token number\">104</span>     size_t size <span class=\"token operator\">=</span> <span class=\"token keyword\">sizeof</span><span class=\"token punctuation\">(</span>Node<span class=\"token punctuation\">)</span> <span class=\"token operator\">+</span> capacity <span class=\"token operator\">*</span> <span class=\"token punctuation\">(</span><span class=\"token keyword\">sizeof</span><span class=\"token punctuation\">(</span>ZoneNodePtr<span class=\"token punctuation\">)</span> <span class=\"token operator\">+</span> <span class=\"token keyword\">sizeof</span><span class=\"token punctuation\">(</span>Use<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token comment\">// capacity == input_count</span>\n\n<span class=\"token comment\">// ++++++++++++++++++++++++++++++++++++++++++++++++++++++++++</span>\nb <span class=\"token punctuation\">.</span><span class=\"token punctuation\">.</span><span class=\"token operator\">/</span><span class=\"token punctuation\">.</span><span class=\"token punctuation\">.</span><span class=\"token operator\">/</span>src<span class=\"token operator\">/</span>compiler<span class=\"token operator\">/</span>graph<span class=\"token operator\">-</span>reducer<span class=\"token punctuation\">.</span>cc<span class=\"token operator\">:</span><span class=\"token number\">261</span>\n<span class=\"token comment\">// ++++++++++++++++++++++++++++++++++++++++++++++++++++++++++</span>\n<span class=\"token comment\">// node == edge.to()</span>\n<span class=\"token punctuation\">(</span>gdb<span class=\"token punctuation\">)</span> p node\n$<span class=\"token number\">43</span> <span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span>Node <span class=\"token operator\">*</span><span class=\"token punctuation\">)</span> <span class=\"token number\">0x555555777dd0</span>\n<span class=\"token punctuation\">(</span>gdb<span class=\"token punctuation\">)</span> p edge<span class=\"token punctuation\">.</span><span class=\"token function\">to</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n$<span class=\"token number\">56</span> <span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span>Node <span class=\"token operator\">*</span><span class=\"token punctuation\">)</span> <span class=\"token number\">0x555555777dd0</span>\n<span class=\"token comment\">// ++++++++++++++++++++++++++++++++++++++++++++++++++++++++++</span>\n<span class=\"token comment\">// edge.from() == edge.use_->from()</span>\n<span class=\"token punctuation\">(</span>gdb<span class=\"token punctuation\">)</span> p edge<span class=\"token punctuation\">.</span><span class=\"token function\">from</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n$<span class=\"token number\">57</span> <span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span>Node <span class=\"token operator\">*</span><span class=\"token punctuation\">)</span> <span class=\"token number\">0x555555778150</span>\n<span class=\"token punctuation\">(</span>gdb<span class=\"token punctuation\">)</span> p edge<span class=\"token punctuation\">.</span>use_<span class=\"token operator\">-></span><span class=\"token function\">from</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n$<span class=\"token number\">58</span> <span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span>Node <span class=\"token operator\">*</span><span class=\"token punctuation\">)</span> <span class=\"token number\">0x555555778150</span>\n<span class=\"token comment\">// ++++++++++++++++++++++++++++++++++++++++++++++++++++++++++</span>\n<span class=\"token comment\">// edge.use_->from() == edge.use_ + edge.use_->input_index()</span>\n<span class=\"token punctuation\">(</span>gdb<span class=\"token punctuation\">)</span> p edge<span class=\"token punctuation\">.</span>use_<span class=\"token operator\">-></span><span class=\"token function\">input_index</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n$<span class=\"token number\">44</span> <span class=\"token operator\">=</span> <span class=\"token number\">3</span>\n<span class=\"token punctuation\">(</span>gdb<span class=\"token punctuation\">)</span> p edge<span class=\"token punctuation\">.</span>use_<span class=\"token operator\">-></span><span class=\"token function\">from</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n$<span class=\"token number\">49</span> <span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span>Node <span class=\"token operator\">*</span><span class=\"token punctuation\">)</span> <span class=\"token number\">0x555555778150</span>\n<span class=\"token punctuation\">(</span>gdb<span class=\"token punctuation\">)</span> p edge<span class=\"token punctuation\">.</span>use_ <span class=\"token operator\">+</span> <span class=\"token number\">4</span>\n$<span class=\"token number\">50</span> <span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span>Node<span class=\"token double-colon punctuation\">::</span>Use <span class=\"token operator\">*</span><span class=\"token punctuation\">)</span> <span class=\"token number\">0x555555778150</span>\n<span class=\"token comment\">// ++++++++++++++++++++++++++++++++++++++++++++++++++++++++++</span>\n<span class=\"token punctuation\">(</span>gdb<span class=\"token punctuation\">)</span> p edge<span class=\"token punctuation\">.</span>use_<span class=\"token operator\">-></span><span class=\"token function\">from</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">+</span> <span class=\"token number\">1</span>\n$<span class=\"token number\">65</span> <span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span>Node <span class=\"token operator\">*</span><span class=\"token punctuation\">)</span> <span class=\"token number\">0x555555778170</span>\n<span class=\"token punctuation\">(</span>gdb<span class=\"token punctuation\">)</span> <span class=\"token function\">p</span> <span class=\"token punctuation\">(</span>ZoneNodePtr <span class=\"token operator\">*</span><span class=\"token punctuation\">)</span><span class=\"token number\">0x555555778170</span> <span class=\"token operator\">+</span> <span class=\"token number\">3</span>\n$<span class=\"token number\">66</span> <span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span>ZoneNodePtr <span class=\"token operator\">*</span><span class=\"token punctuation\">)</span> <span class=\"token number\">0x555555778188</span>\n<span class=\"token punctuation\">(</span>gdb<span class=\"token punctuation\">)</span> p edge<span class=\"token punctuation\">.</span>use_<span class=\"token operator\">-></span><span class=\"token function\">input_ptr</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n$<span class=\"token number\">64</span> <span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span>ZoneNodePtr <span class=\"token operator\">*</span><span class=\"token punctuation\">)</span> <span class=\"token number\">0x555555778188</span>\n<span class=\"token comment\">// ++++++++++++++++++++++++++++++++++++++++++++++++++++++++++</span>\n<span class=\"token punctuation\">(</span>gdb<span class=\"token punctuation\">)</span> p node\n$<span class=\"token number\">68</span> <span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span>Node <span class=\"token operator\">*</span><span class=\"token punctuation\">)</span> <span class=\"token number\">0x555555777dd0</span>\n<span class=\"token punctuation\">(</span>gdb<span class=\"token punctuation\">)</span> p node <span class=\"token operator\">+</span> <span class=\"token number\">1</span>\n$<span class=\"token number\">74</span> <span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span>Node <span class=\"token operator\">*</span><span class=\"token punctuation\">)</span> <span class=\"token number\">0x555555777df0</span>\n<span class=\"token punctuation\">(</span>gdb<span class=\"token punctuation\">)</span> x<span class=\"token operator\">/</span><span class=\"token number\">1</span>xg <span class=\"token punctuation\">(</span>node<span class=\"token operator\">+</span><span class=\"token number\">1</span><span class=\"token punctuation\">)</span>\n<span class=\"token number\">0x555555777df0</span><span class=\"token operator\">:</span> <span class=\"token number\">0x00005555557773b8</span>\n<span class=\"token comment\">// (**(ZoneNodePtr *)(node + 1))->first_use_->next->from() == node</span>\n<span class=\"token punctuation\">(</span>gdb<span class=\"token punctuation\">)</span>  <span class=\"token function\">p</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span>Node <span class=\"token operator\">*</span><span class=\"token punctuation\">)</span><span class=\"token number\">0x00005555557773b8</span><span class=\"token punctuation\">)</span><span class=\"token operator\">-></span>first_use_<span class=\"token operator\">-></span>next<span class=\"token operator\">-></span><span class=\"token function\">from</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n$<span class=\"token number\">69</span> <span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span>Node <span class=\"token operator\">*</span><span class=\"token punctuation\">)</span> <span class=\"token number\">0x555555777dd0</span>\n\n<span class=\"token comment\">// (**(ZoneNodePtr *)(node + 1))->first_use_->next + 1 == node</span>\n<span class=\"token punctuation\">(</span>gdb<span class=\"token punctuation\">)</span>  <span class=\"token function\">p</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span>Node <span class=\"token operator\">*</span><span class=\"token punctuation\">)</span><span class=\"token number\">0x00005555557773b8</span><span class=\"token punctuation\">)</span><span class=\"token operator\">-></span>first_use_<span class=\"token operator\">-></span>next\n$<span class=\"token number\">70</span> <span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span>Node<span class=\"token double-colon punctuation\">::</span>ZoneUsePtr<span class=\"token punctuation\">)</span> <span class=\"token number\">0x555555777db8</span>\n<span class=\"token punctuation\">(</span>gdb<span class=\"token punctuation\">)</span>  <span class=\"token function\">p</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span>Node <span class=\"token operator\">*</span><span class=\"token punctuation\">)</span><span class=\"token number\">0x00005555557773b8</span><span class=\"token punctuation\">)</span><span class=\"token operator\">-></span>first_use_<span class=\"token operator\">-></span>next <span class=\"token operator\">+</span> <span class=\"token number\">1</span>\n$<span class=\"token number\">71</span> <span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span>Node<span class=\"token double-colon punctuation\">::</span>Use <span class=\"token operator\">*</span><span class=\"token punctuation\">)</span> <span class=\"token number\">0x555555777dd0</span>\n\n<span class=\"token comment\">// (**(ZoneNodePtr *)(node + 1))->first_use_->next->input_ptr() == node + 1</span>\n<span class=\"token punctuation\">(</span>gdb<span class=\"token punctuation\">)</span> <span class=\"token function\">p</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span>Node <span class=\"token operator\">*</span><span class=\"token punctuation\">)</span><span class=\"token number\">0x00005555557773b8</span><span class=\"token punctuation\">)</span><span class=\"token operator\">-></span>first_use_<span class=\"token operator\">-></span>next<span class=\"token operator\">-></span><span class=\"token function\">input_ptr</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n$<span class=\"token number\">73</span> <span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span>ZoneNodePtr <span class=\"token operator\">*</span><span class=\"token punctuation\">)</span> <span class=\"token number\">0x555555777df0</span>\n<span class=\"token punctuation\">(</span>gdb<span class=\"token punctuation\">)</span> p node <span class=\"token operator\">+</span> <span class=\"token number\">1</span>\n$<span class=\"token number\">79</span> <span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span>Node <span class=\"token operator\">*</span><span class=\"token punctuation\">)</span> <span class=\"token number\">0x555555777df0</span>\n<span class=\"token comment\">// ++++++++++++++++++++++++++++++++++++++++++++++++++++++++++</span>\n<span class=\"token comment\">// 一个 node 的 use 链表保存的是使用这个 node 的节点</span>\n<span class=\"token punctuation\">.</span><span class=\"token operator\">/</span>d8  <span class=\"token operator\">--</span>allow<span class=\"token operator\">-</span>natives<span class=\"token operator\">-</span>syntax <span class=\"token operator\">--</span>trace<span class=\"token operator\">-</span>turbo<span class=\"token operator\">-</span>graph  js<span class=\"token operator\">-</span>code<span class=\"token operator\">/</span>debug<span class=\"token punctuation\">.</span>js <span class=\"token operator\">|</span> more\n<span class=\"token punctuation\">.</span><span class=\"token punctuation\">.</span><span class=\"token punctuation\">.</span>\n#<span class=\"token number\">19</span><span class=\"token operator\">:</span><span class=\"token function\">Return</span><span class=\"token punctuation\">(</span>#<span class=\"token number\">18</span><span class=\"token operator\">:</span>NumberConstant<span class=\"token punctuation\">,</span> #<span class=\"token number\">3</span><span class=\"token operator\">:</span>HeapConstant<span class=\"token punctuation\">,</span> #<span class=\"token number\">16</span><span class=\"token operator\">:</span>JSStoreGlobal<span class=\"token punctuation\">,</span> #<span class=\"token number\">16</span><span class=\"token operator\">:</span>JSStoreGlobal<span class=\"token punctuation\">)</span>\n\n<span class=\"token punctuation\">(</span>gdb<span class=\"token punctuation\">)</span> p node<span class=\"token operator\">-></span>first_use_<span class=\"token operator\">-></span><span class=\"token function\">from</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token operator\">-></span><span class=\"token function\">op</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token operator\">-></span>mnemonic_\n$<span class=\"token number\">82</span> <span class=\"token operator\">=</span> <span class=\"token number\">0x7ffff4f887c9</span> <span class=\"token string\">\"Return\"</span>\n<span class=\"token punctuation\">(</span>gdb<span class=\"token punctuation\">)</span> p node<span class=\"token operator\">-></span>first_use_<span class=\"token operator\">-></span>next<span class=\"token operator\">-></span><span class=\"token function\">from</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token operator\">-></span><span class=\"token function\">op</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token operator\">-></span>mnemonic_\n$<span class=\"token number\">83</span> <span class=\"token operator\">=</span> <span class=\"token number\">0x7ffff4f887c9</span> <span class=\"token string\">\"Return\"</span>\n<span class=\"token punctuation\">(</span>gdb<span class=\"token punctuation\">)</span> p node<span class=\"token operator\">-></span>first_use_<span class=\"token operator\">-></span>next<span class=\"token operator\">-></span>next\n$<span class=\"token number\">84</span> <span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span>Node<span class=\"token double-colon punctuation\">::</span>ZoneUsePtr<span class=\"token punctuation\">)</span> <span class=\"token number\">0x0</span>\n<span class=\"token comment\">// ++++++++++++++++++++++++++++++++++++++++++++++++++++++++++</span>\n<span class=\"token comment\">// src/compiler/node.cc:64</span>\n<span class=\"token comment\">// node inputs</span>\n<span class=\"token punctuation\">(</span>gdb<span class=\"token punctuation\">)</span> <span class=\"token function\">p</span> <span class=\"token punctuation\">(</span>inputs<span class=\"token punctuation\">[</span><span class=\"token number\">0</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">.</span>op_<span class=\"token punctuation\">.</span>mnemonic_<span class=\"token punctuation\">)</span>\n$<span class=\"token number\">14</span> <span class=\"token operator\">=</span> <span class=\"token number\">0x7ffff4f41fb4</span> <span class=\"token string\">\"Parameter\"</span>\n<span class=\"token punctuation\">(</span>gdb<span class=\"token punctuation\">)</span> <span class=\"token function\">p</span> <span class=\"token punctuation\">(</span>inputs<span class=\"token punctuation\">[</span><span class=\"token number\">1</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">.</span>op_<span class=\"token punctuation\">.</span>mnemonic_<span class=\"token punctuation\">)</span>\n$<span class=\"token number\">15</span> <span class=\"token operator\">=</span> <span class=\"token number\">0x7ffff4e9ee26</span> <span class=\"token string\">\"HeapConstant\"</span>\n<span class=\"token punctuation\">(</span>gdb<span class=\"token punctuation\">)</span> <span class=\"token function\">p</span> <span class=\"token punctuation\">(</span>inputs<span class=\"token punctuation\">[</span><span class=\"token number\">2</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">.</span>op_<span class=\"token punctuation\">.</span>mnemonic_<span class=\"token punctuation\">)</span>\n$<span class=\"token number\">16</span> <span class=\"token operator\">=</span> <span class=\"token number\">0x7ffff4f41fb4</span> <span class=\"token string\">\"Parameter\"</span>\n<span class=\"token punctuation\">(</span>gdb<span class=\"token punctuation\">)</span> <span class=\"token function\">p</span> <span class=\"token punctuation\">(</span>inputs<span class=\"token punctuation\">[</span><span class=\"token number\">3</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">.</span>op_<span class=\"token punctuation\">.</span>mnemonic_<span class=\"token punctuation\">)</span>\n$<span class=\"token number\">17</span> <span class=\"token operator\">=</span> <span class=\"token number\">0x7ffff4eb885e</span> <span class=\"token string\">\"Dead\"</span>\n<span class=\"token punctuation\">(</span>gdb<span class=\"token punctuation\">)</span> <span class=\"token function\">p</span> <span class=\"token punctuation\">(</span>inputs<span class=\"token punctuation\">[</span><span class=\"token number\">4</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">.</span>op_<span class=\"token punctuation\">.</span>mnemonic_<span class=\"token punctuation\">)</span>\n$<span class=\"token number\">18</span> <span class=\"token operator\">=</span> <span class=\"token number\">0x7ffff4fa16b8</span> <span class=\"token string\">\"Checkpoint\"</span>\n<span class=\"token punctuation\">(</span>gdb<span class=\"token punctuation\">)</span> <span class=\"token function\">p</span> <span class=\"token punctuation\">(</span>inputs<span class=\"token punctuation\">[</span><span class=\"token number\">5</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">.</span>op_<span class=\"token punctuation\">.</span>mnemonic_<span class=\"token punctuation\">)</span>\n$<span class=\"token number\">19</span> <span class=\"token operator\">=</span> <span class=\"token number\">0x7ffff4f763e8</span> <span class=\"token string\">\"JSStackCheck\"</span>\n<span class=\"token punctuation\">(</span>gdb<span class=\"token punctuation\">)</span> p op<span class=\"token punctuation\">.</span>mnemonic_\n$<span class=\"token number\">20</span> <span class=\"token operator\">=</span> <span class=\"token number\">0x7ffff4f6591a</span> <span class=\"token string\">\"JSStoreGlobal\"</span>\n\n<span class=\"token punctuation\">.</span><span class=\"token operator\">/</span>d8  <span class=\"token operator\">--</span>allow<span class=\"token operator\">-</span>natives<span class=\"token operator\">-</span>syntax <span class=\"token operator\">--</span>trace<span class=\"token operator\">-</span>turbo<span class=\"token operator\">-</span>graph  js<span class=\"token operator\">-</span>code<span class=\"token operator\">/</span>debug<span class=\"token punctuation\">.</span>js <span class=\"token operator\">|</span> more\n<span class=\"token punctuation\">.</span><span class=\"token punctuation\">.</span><span class=\"token punctuation\">.</span>\n#<span class=\"token number\">16</span><span class=\"token operator\">:</span>JSStoreGlobal<span class=\"token punctuation\">[</span>sloppy<span class=\"token punctuation\">,</span> <span class=\"token number\">0x1c7208293235</span> <span class=\"token operator\">&lt;</span>String<span class=\"token punctuation\">[</span><span class=\"token number\">1</span><span class=\"token punctuation\">]</span><span class=\"token operator\">:</span> #x<span class=\"token operator\">></span><span class=\"token punctuation\">]</span>\n    <span class=\"token punctuation\">(</span>#<span class=\"token number\">2</span><span class=\"token operator\">:</span>Parameter<span class=\"token punctuation\">,</span> #<span class=\"token number\">5</span><span class=\"token operator\">:</span>HeapConstant<span class=\"token punctuation\">,</span> #<span class=\"token number\">4</span><span class=\"token operator\">:</span>Parameter<span class=\"token punctuation\">,</span> #<span class=\"token number\">17</span><span class=\"token operator\">:</span>FrameState<span class=\"token punctuation\">,</span> #<span class=\"token number\">14</span><span class=\"token operator\">:</span>Checkpoint<span class=\"token punctuation\">,</span> #<span class=\"token number\">8</span><span class=\"token operator\">:</span>JSStackCheck<span class=\"token punctuation\">)</span>\n\n<span class=\"token comment\">// ++++++++++++++++++++++++++++++++++++++++++++++++++++++++++</span>\n<span class=\"token comment\">// node use</span>\n<span class=\"token punctuation\">(</span>gdb<span class=\"token punctuation\">)</span> p node<span class=\"token operator\">-></span><span class=\"token function\">inputs</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">[</span><span class=\"token number\">5</span><span class=\"token punctuation\">]</span><span class=\"token operator\">-></span><span class=\"token function\">op</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token operator\">-></span>mnemonic_\n$<span class=\"token number\">112</span> <span class=\"token operator\">=</span> <span class=\"token number\">0x7ffff4f763e8</span> <span class=\"token string\">\"JSStackCheck\"</span>\n\n<span class=\"token punctuation\">(</span>gdb<span class=\"token punctuation\">)</span> p node<span class=\"token operator\">-></span><span class=\"token function\">inputs</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">[</span><span class=\"token number\">5</span><span class=\"token punctuation\">]</span><span class=\"token operator\">-></span>first_use_<span class=\"token operator\">-></span><span class=\"token function\">from</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token operator\">-></span><span class=\"token function\">op</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token operator\">-></span>mnemonic_\n$<span class=\"token number\">116</span> <span class=\"token operator\">=</span> <span class=\"token number\">0x7ffff4f285f4</span> <span class=\"token string\">\"StoreField\"</span>\n<span class=\"token punctuation\">(</span>gdb<span class=\"token punctuation\">)</span> p node<span class=\"token operator\">-></span><span class=\"token function\">inputs</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">[</span><span class=\"token number\">5</span><span class=\"token punctuation\">]</span><span class=\"token operator\">-></span>first_use_<span class=\"token operator\">-></span>next<span class=\"token operator\">-></span><span class=\"token function\">from</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token operator\">-></span><span class=\"token function\">op</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token operator\">-></span>mnemonic_\n$<span class=\"token number\">118</span> <span class=\"token operator\">=</span> <span class=\"token number\">0x7ffff4f99641</span> <span class=\"token string\">\"CheckMaps\"</span>\n<span class=\"token punctuation\">(</span>gdb<span class=\"token punctuation\">)</span> p node<span class=\"token operator\">-></span><span class=\"token function\">inputs</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">[</span><span class=\"token number\">5</span><span class=\"token punctuation\">]</span><span class=\"token operator\">-></span>first_use_<span class=\"token operator\">-></span>next<span class=\"token operator\">-></span>next<span class=\"token operator\">-></span><span class=\"token function\">from</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token operator\">-></span><span class=\"token function\">op</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token operator\">-></span>mnemonic_\n$<span class=\"token number\">120</span> <span class=\"token operator\">=</span> <span class=\"token number\">0x7ffff4f39205</span> <span class=\"token string\">\"CheckHeapObject\"</span>\n<span class=\"token punctuation\">(</span>gdb<span class=\"token punctuation\">)</span> p node<span class=\"token operator\">-></span><span class=\"token function\">inputs</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">[</span><span class=\"token number\">5</span><span class=\"token punctuation\">]</span><span class=\"token operator\">-></span>first_use_<span class=\"token operator\">-></span>next<span class=\"token operator\">-></span>next<span class=\"token operator\">-></span>next<span class=\"token operator\">-></span><span class=\"token function\">from</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token operator\">-></span><span class=\"token function\">op</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token operator\">-></span>mnemonic_\n$<span class=\"token number\">122</span> <span class=\"token operator\">=</span> <span class=\"token number\">0x7ffff4f6591a</span> <span class=\"token string\">\"JSStoreGlobal\"</span>\n<span class=\"token punctuation\">(</span>gdb<span class=\"token punctuation\">)</span> p node<span class=\"token operator\">-></span><span class=\"token function\">inputs</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">[</span><span class=\"token number\">5</span><span class=\"token punctuation\">]</span><span class=\"token operator\">-></span>first_use_<span class=\"token operator\">-></span>next<span class=\"token operator\">-></span>next<span class=\"token operator\">-></span>next<span class=\"token operator\">-></span>next<span class=\"token operator\">-></span><span class=\"token function\">from</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token operator\">-></span><span class=\"token function\">op</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token operator\">-></span>mnemonic_\n$<span class=\"token number\">124</span> <span class=\"token operator\">=</span> <span class=\"token number\">0x7ffff4fa16b8</span> <span class=\"token string\">\"Checkpoint\"</span>\n<span class=\"token punctuation\">(</span>gdb<span class=\"token punctuation\">)</span> p node<span class=\"token operator\">-></span><span class=\"token function\">inputs</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">[</span><span class=\"token number\">5</span><span class=\"token punctuation\">]</span><span class=\"token operator\">-></span>first_use_<span class=\"token operator\">-></span>next<span class=\"token operator\">-></span>next<span class=\"token operator\">-></span>next<span class=\"token operator\">-></span>next<span class=\"token operator\">-></span>next<span class=\"token operator\">-></span><span class=\"token function\">from</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token operator\">-></span><span class=\"token function\">op</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token operator\">-></span>mnemonic_\n$<span class=\"token number\">126</span> <span class=\"token operator\">=</span> <span class=\"token number\">0x7ffff4fa16b8</span> <span class=\"token string\">\"Checkpoint\"</span>\n<span class=\"token punctuation\">(</span>gdb<span class=\"token punctuation\">)</span> p node<span class=\"token operator\">-></span><span class=\"token function\">inputs</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">[</span><span class=\"token number\">5</span><span class=\"token punctuation\">]</span><span class=\"token operator\">-></span>first_use_<span class=\"token operator\">-></span>next<span class=\"token operator\">-></span>next<span class=\"token operator\">-></span>next<span class=\"token operator\">-></span>next<span class=\"token operator\">-></span>next<span class=\"token operator\">-></span>next\n$<span class=\"token number\">127</span> <span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span>Node<span class=\"token double-colon punctuation\">::</span>ZoneUsePtr<span class=\"token punctuation\">)</span> <span class=\"token number\">0x0</span>\n\n<span class=\"token operator\">--</span> Graph after V8<span class=\"token punctuation\">.</span>TFInlining <span class=\"token operator\">--</span>\n#<span class=\"token number\">8</span><span class=\"token operator\">:</span>JSStackCheck<span class=\"token punctuation\">[</span>JSFunctionEntry<span class=\"token punctuation\">]</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">.</span><span class=\"token punctuation\">.</span><span class=\"token punctuation\">)</span>\n#<span class=\"token number\">16</span><span class=\"token operator\">:</span>JSStoreGlobal<span class=\"token punctuation\">[</span>sloppy<span class=\"token punctuation\">,</span> <span class=\"token number\">0x1c7208293235</span> <span class=\"token operator\">&lt;</span>String<span class=\"token punctuation\">[</span><span class=\"token number\">1</span><span class=\"token punctuation\">]</span><span class=\"token operator\">:</span> #x<span class=\"token operator\">></span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">.</span><span class=\"token punctuation\">.</span><span class=\"token punctuation\">,</span> #<span class=\"token number\">8</span><span class=\"token operator\">:</span>JSStackCheck<span class=\"token punctuation\">)</span>\n#<span class=\"token number\">14</span><span class=\"token operator\">:</span><span class=\"token function\">Checkpoint</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">.</span><span class=\"token punctuation\">.</span><span class=\"token punctuation\">,</span> #<span class=\"token number\">8</span><span class=\"token operator\">:</span>JSStackCheck<span class=\"token punctuation\">,</span> #<span class=\"token number\">8</span><span class=\"token operator\">:</span>JSStackCheck<span class=\"token punctuation\">)</span>\n#<span class=\"token number\">24</span><span class=\"token operator\">:</span><span class=\"token function\">CheckHeapObject</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">.</span><span class=\"token punctuation\">.</span><span class=\"token punctuation\">,</span> #<span class=\"token number\">8</span><span class=\"token operator\">:</span>JSStackCheck<span class=\"token punctuation\">)</span>\n#<span class=\"token number\">25</span><span class=\"token operator\">:</span>CheckMaps<span class=\"token punctuation\">[</span><span class=\"token punctuation\">.</span><span class=\"token punctuation\">.</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">.</span><span class=\"token punctuation\">.</span><span class=\"token punctuation\">,</span> #<span class=\"token number\">8</span><span class=\"token operator\">:</span>JSStackCheck<span class=\"token punctuation\">)</span>\n#<span class=\"token number\">27</span><span class=\"token operator\">:</span>StoreField<span class=\"token punctuation\">[</span><span class=\"token punctuation\">.</span><span class=\"token punctuation\">.</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">.</span><span class=\"token punctuation\">.</span><span class=\"token punctuation\">,</span> #<span class=\"token number\">8</span><span class=\"token operator\">:</span>JSStackCheck<span class=\"token punctuation\">)</span>\n</code></pre>\n"}]},{"t":"heading","d":2,"p":{"lines":[150,151]},"v":"Node","c":[{"t":"list_item","d":4,"p":{"lines":[151,200]},"v":"<pre class=\"language-cpp\"><code class=\"language-cpp\"><span class=\"token comment\">// src/compiler/node.h</span>\n<span class=\"token number\">42</span> <span class=\"token keyword\">class</span> <span class=\"token class-name\">V8_EXPORT_PRIVATE</span> Node <span class=\"token keyword\">final</span> <span class=\"token punctuation\">{</span>\n<span class=\"token number\">43</span>  <span class=\"token keyword\">public</span><span class=\"token operator\">:</span>\n<span class=\"token number\">44</span>   <span class=\"token keyword\">static</span> Node<span class=\"token operator\">*</span> <span class=\"token function\">New</span><span class=\"token punctuation\">(</span>Zone<span class=\"token operator\">*</span> zone<span class=\"token punctuation\">,</span> NodeId id<span class=\"token punctuation\">,</span> <span class=\"token keyword\">const</span> Operator<span class=\"token operator\">*</span> op<span class=\"token punctuation\">,</span> <span class=\"token keyword\">int</span> input_count<span class=\"token punctuation\">,</span>\n<span class=\"token number\">45</span>                    Node<span class=\"token operator\">*</span> <span class=\"token keyword\">const</span><span class=\"token operator\">*</span> inputs<span class=\"token punctuation\">,</span> <span class=\"token keyword\">bool</span> has_extensible_inputs<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">.</span><span class=\"token punctuation\">.</span><span class=\"token punctuation\">.</span>\n<span class=\"token number\">51</span>   <span class=\"token keyword\">const</span> Operator<span class=\"token operator\">*</span> <span class=\"token function\">op</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token keyword\">const</span> <span class=\"token punctuation\">{</span> <span class=\"token keyword\">return</span> op_<span class=\"token punctuation\">;</span> <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">.</span><span class=\"token punctuation\">.</span><span class=\"token punctuation\">.</span>\n<span class=\"token number\">58</span>   NodeId <span class=\"token function\">id</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token keyword\">const</span> <span class=\"token punctuation\">{</span> <span class=\"token keyword\">return</span> <span class=\"token class-name\">IdField</span><span class=\"token double-colon punctuation\">::</span><span class=\"token function\">decode</span><span class=\"token punctuation\">(</span>bit_field_<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span> <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">.</span><span class=\"token punctuation\">.</span><span class=\"token punctuation\">.</span>\n<span class=\"token number\">71</span>   Node<span class=\"token operator\">*</span> <span class=\"token function\">InputAt</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">int</span> index<span class=\"token punctuation\">)</span> <span class=\"token keyword\">const</span> <span class=\"token punctuation\">{</span>\n<span class=\"token punctuation\">.</span><span class=\"token punctuation\">.</span><span class=\"token punctuation\">.</span>\n<span class=\"token number\">103</span>   <span class=\"token keyword\">class</span> <span class=\"token class-name\">InputEdges</span><span class=\"token punctuation\">;</span>\n<span class=\"token number\">104</span>   <span class=\"token keyword\">inline</span> InputEdges <span class=\"token function\">input_edges</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token number\">105</span>\n<span class=\"token number\">106</span>   <span class=\"token keyword\">class</span> <span class=\"token class-name\">Inputs</span><span class=\"token punctuation\">;</span>\n<span class=\"token number\">107</span>   <span class=\"token keyword\">inline</span> Inputs <span class=\"token function\">inputs</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token keyword\">const</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">.</span><span class=\"token punctuation\">.</span><span class=\"token punctuation\">.</span>\n<span class=\"token number\">109</span>   <span class=\"token keyword\">class</span> <span class=\"token class-name\">UseEdges</span> <span class=\"token keyword\">final</span> <span class=\"token punctuation\">{</span>\n<span class=\"token punctuation\">.</span><span class=\"token punctuation\">.</span><span class=\"token punctuation\">.</span>\n<span class=\"token number\">125</span>   UseEdges <span class=\"token function\">use_edges</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span> <span class=\"token keyword\">return</span> <span class=\"token function\">UseEdges</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">this</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span> <span class=\"token punctuation\">}</span>\n<span class=\"token number\">126</span>\n<span class=\"token number\">127</span>   <span class=\"token keyword\">class</span> <span class=\"token class-name\">V8_EXPORT_PRIVATE</span> Uses <span class=\"token keyword\">final</span> <span class=\"token punctuation\">{</span>\n<span class=\"token punctuation\">.</span><span class=\"token punctuation\">.</span><span class=\"token punctuation\">.</span>\n<span class=\"token number\">137</span>     <span class=\"token keyword\">explicit</span> <span class=\"token function\">Uses</span><span class=\"token punctuation\">(</span>Node<span class=\"token operator\">*</span> node<span class=\"token punctuation\">)</span> <span class=\"token operator\">:</span> <span class=\"token function\">node_</span><span class=\"token punctuation\">(</span>node<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span><span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">.</span><span class=\"token punctuation\">.</span><span class=\"token punctuation\">.</span>\n<span class=\"token number\">139</span>    <span class=\"token keyword\">private</span><span class=\"token operator\">:</span>\n<span class=\"token number\">140</span>     Node<span class=\"token operator\">*</span> node_<span class=\"token punctuation\">;</span>\n<span class=\"token number\">141</span>   <span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">.</span><span class=\"token punctuation\">.</span><span class=\"token punctuation\">.</span>\n<span class=\"token number\">143</span>   Uses <span class=\"token function\">uses</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span> <span class=\"token keyword\">return</span> <span class=\"token function\">Uses</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">this</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span> <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">.</span><span class=\"token punctuation\">.</span><span class=\"token punctuation\">.</span>\n<span class=\"token number\">181</span>   <span class=\"token keyword\">struct</span> <span class=\"token class-name\">Use</span> <span class=\"token punctuation\">{</span>\n<span class=\"token punctuation\">.</span><span class=\"token punctuation\">.</span><span class=\"token punctuation\">.</span>\n<span class=\"token number\">268</span>   <span class=\"token keyword\">void</span> <span class=\"token function\">AppendUse</span><span class=\"token punctuation\">(</span>Use<span class=\"token operator\">*</span> use<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token number\">269</span>   <span class=\"token keyword\">void</span> <span class=\"token function\">RemoveUse</span><span class=\"token punctuation\">(</span>Use<span class=\"token operator\">*</span> use<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">.</span><span class=\"token punctuation\">.</span><span class=\"token punctuation\">.</span>\n<span class=\"token number\">296</span>   <span class=\"token keyword\">const</span> Operator<span class=\"token operator\">*</span> op_<span class=\"token punctuation\">;</span>\n<span class=\"token number\">297</span>   Type type_<span class=\"token punctuation\">;</span>\n<span class=\"token number\">299</span>   <span class=\"token keyword\">uint32_t</span> bit_field_<span class=\"token punctuation\">;</span>\n<span class=\"token number\">300</span>   ZoneUsePtr first_use_<span class=\"token punctuation\">;</span>\n<span class=\"token number\">301</span>\n<span class=\"token number\">302</span>   <span class=\"token keyword\">friend</span> <span class=\"token keyword\">class</span> <span class=\"token class-name\">Edge</span><span class=\"token punctuation\">;</span>\n<span class=\"token number\">303</span>   <span class=\"token keyword\">friend</span> <span class=\"token keyword\">class</span> <span class=\"token class-name\">NodeMarkerBase</span><span class=\"token punctuation\">;</span>\n<span class=\"token number\">304</span>   <span class=\"token keyword\">friend</span> <span class=\"token keyword\">class</span> <span class=\"token class-name\">NodeProperties</span><span class=\"token punctuation\">;</span>\n<span class=\"token number\">305</span> <span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span>\n</code></pre>\n"},{"t":"list_item","d":4,"p":{"lines":[200,201]},"v":"Node::Node()","c":[{"t":"list_item","d":6,"p":{"lines":[201,212]},"v":"<pre class=\"language-cpp\"><code class=\"language-cpp\"><span class=\"token number\">385</span> <span class=\"token class-name\">Node</span><span class=\"token double-colon punctuation\">::</span><span class=\"token function\">Node</span><span class=\"token punctuation\">(</span>NodeId id<span class=\"token punctuation\">,</span> <span class=\"token keyword\">const</span> Operator<span class=\"token operator\">*</span> op<span class=\"token punctuation\">,</span> <span class=\"token keyword\">int</span> inline_count<span class=\"token punctuation\">,</span> <span class=\"token keyword\">int</span> inline_capacity<span class=\"token punctuation\">)</span>\n<span class=\"token number\">386</span>     <span class=\"token operator\">:</span> <span class=\"token function\">op_</span><span class=\"token punctuation\">(</span>op<span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>\n<span class=\"token number\">387</span>       <span class=\"token function\">mark_</span><span class=\"token punctuation\">(</span><span class=\"token number\">0</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>\n<span class=\"token number\">388</span>       <span class=\"token function\">bit_field_</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">IdField</span><span class=\"token double-colon punctuation\">::</span><span class=\"token function\">encode</span><span class=\"token punctuation\">(</span>id<span class=\"token punctuation\">)</span> <span class=\"token operator\">|</span> <span class=\"token class-name\">InlineCountField</span><span class=\"token double-colon punctuation\">::</span><span class=\"token function\">encode</span><span class=\"token punctuation\">(</span>inline_count<span class=\"token punctuation\">)</span> <span class=\"token operator\">|</span>\n<span class=\"token number\">389</span>                  <span class=\"token class-name\">InlineCapacityField</span><span class=\"token double-colon punctuation\">::</span><span class=\"token function\">encode</span><span class=\"token punctuation\">(</span>inline_capacity<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>\n<span class=\"token number\">390</span>       <span class=\"token function\">first_use_</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">nullptr</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n<span class=\"token punctuation\">.</span><span class=\"token punctuation\">.</span><span class=\"token punctuation\">.</span>\n<span class=\"token number\">398</span> <span class=\"token punctuation\">}</span>\n</code></pre>\n"}]},{"t":"list_item","d":4,"p":{"lines":[212,213]},"v":"Node::New","c":[{"t":"list_item","d":6,"p":{"lines":[213,245]},"v":"<pre class=\"language-cpp\"><code class=\"language-cpp\"><span class=\"token comment\">// src/compiler/node.cc</span>\n<span class=\"token comment\">// b ../../src/compiler/node.cc:58</span>\n<span class=\"token number\">58</span> Node<span class=\"token operator\">*</span> <span class=\"token class-name\">Node</span><span class=\"token double-colon punctuation\">::</span><span class=\"token function\">NewImpl</span><span class=\"token punctuation\">(</span>Zone<span class=\"token operator\">*</span> zone<span class=\"token punctuation\">,</span> NodeId id<span class=\"token punctuation\">,</span> <span class=\"token keyword\">const</span> Operator<span class=\"token operator\">*</span> op<span class=\"token punctuation\">,</span> <span class=\"token keyword\">int</span> input_count<span class=\"token punctuation\">,</span>\n<span class=\"token number\">59</span>                     NodePtrT <span class=\"token keyword\">const</span><span class=\"token operator\">*</span> inputs<span class=\"token punctuation\">,</span> <span class=\"token keyword\">bool</span> has_extensible_inputs<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n<span class=\"token punctuation\">.</span><span class=\"token punctuation\">.</span><span class=\"token punctuation\">.</span>\n<span class=\"token number\">98</span>     <span class=\"token keyword\">int</span> capacity <span class=\"token operator\">=</span> std<span class=\"token double-colon punctuation\">::</span><span class=\"token function\">max</span><span class=\"token punctuation\">(</span><span class=\"token number\">1</span><span class=\"token punctuation\">,</span> input_count<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">.</span><span class=\"token punctuation\">.</span><span class=\"token punctuation\">.</span>\n<span class=\"token number\">104</span>     size_t size <span class=\"token operator\">=</span> <span class=\"token keyword\">sizeof</span><span class=\"token punctuation\">(</span>Node<span class=\"token punctuation\">)</span> <span class=\"token operator\">+</span> capacity <span class=\"token operator\">*</span> <span class=\"token punctuation\">(</span><span class=\"token keyword\">sizeof</span><span class=\"token punctuation\">(</span>ZoneNodePtr<span class=\"token punctuation\">)</span> <span class=\"token operator\">+</span> <span class=\"token keyword\">sizeof</span><span class=\"token punctuation\">(</span>Use<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token number\">105</span>     intptr_t raw_buffer <span class=\"token operator\">=</span>\n<span class=\"token number\">106</span>         <span class=\"token generic-function\"><span class=\"token function\">reinterpret_cast</span><span class=\"token generic class-name\"><span class=\"token operator\">&lt;</span>intptr_t<span class=\"token operator\">></span></span></span><span class=\"token punctuation\">(</span>zone<span class=\"token operator\">-></span><span class=\"token generic-function\"><span class=\"token function\">Allocate</span><span class=\"token generic class-name\"><span class=\"token operator\">&lt;</span>NodeWithInLineInputs<span class=\"token operator\">></span></span></span><span class=\"token punctuation\">(</span>size<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token number\">107</span>     <span class=\"token keyword\">void</span><span class=\"token operator\">*</span> node_buffer <span class=\"token operator\">=</span>\n<span class=\"token number\">108</span>         <span class=\"token generic-function\"><span class=\"token function\">reinterpret_cast</span><span class=\"token generic class-name\"><span class=\"token operator\">&lt;</span><span class=\"token keyword\">void</span><span class=\"token operator\">*</span><span class=\"token operator\">></span></span></span><span class=\"token punctuation\">(</span>raw_buffer <span class=\"token operator\">+</span> capacity <span class=\"token operator\">*</span> <span class=\"token keyword\">sizeof</span><span class=\"token punctuation\">(</span>Use<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token number\">109</span>\n<span class=\"token number\">110</span>     node <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token punctuation\">(</span>node_buffer<span class=\"token punctuation\">)</span> <span class=\"token function\">Node</span><span class=\"token punctuation\">(</span>id<span class=\"token punctuation\">,</span> op<span class=\"token punctuation\">,</span> input_count<span class=\"token punctuation\">,</span> capacity<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token number\">111</span>     input_ptr <span class=\"token operator\">=</span> node<span class=\"token operator\">-></span><span class=\"token function\">inline_inputs</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token number\">112</span>     use_ptr <span class=\"token operator\">=</span> <span class=\"token generic-function\"><span class=\"token function\">reinterpret_cast</span><span class=\"token generic class-name\"><span class=\"token operator\">&lt;</span>Use<span class=\"token operator\">*</span><span class=\"token operator\">></span></span></span><span class=\"token punctuation\">(</span>node<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token number\">113</span>     is_inline <span class=\"token operator\">=</span> <span class=\"token boolean\">true</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">.</span><span class=\"token punctuation\">.</span><span class=\"token punctuation\">.</span>\n<span class=\"token number\">119</span>   <span class=\"token keyword\">for</span> <span class=\"token punctuation\">(</span><span class=\"token keyword\">int</span> current <span class=\"token operator\">=</span> <span class=\"token number\">0</span><span class=\"token punctuation\">;</span> current <span class=\"token operator\">&lt;</span> input_count<span class=\"token punctuation\">;</span> <span class=\"token operator\">++</span>current<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n<span class=\"token number\">120</span>     Node<span class=\"token operator\">*</span> to <span class=\"token operator\">=</span> <span class=\"token operator\">*</span>inputs<span class=\"token operator\">++</span><span class=\"token punctuation\">;</span>\n<span class=\"token number\">121</span>     input_ptr<span class=\"token punctuation\">[</span>current<span class=\"token punctuation\">]</span> <span class=\"token operator\">=</span> to<span class=\"token punctuation\">;</span>\n<span class=\"token number\">122</span>     Use<span class=\"token operator\">*</span> use <span class=\"token operator\">=</span> use_ptr <span class=\"token operator\">-</span> <span class=\"token number\">1</span> <span class=\"token operator\">-</span> current<span class=\"token punctuation\">;</span>\n<span class=\"token number\">123</span>     use<span class=\"token operator\">-></span>bit_field_ <span class=\"token operator\">=</span> Use<span class=\"token double-colon punctuation\">::</span><span class=\"token class-name\">InputIndexField</span><span class=\"token double-colon punctuation\">::</span><span class=\"token function\">encode</span><span class=\"token punctuation\">(</span>current<span class=\"token punctuation\">)</span> <span class=\"token operator\">|</span>\n<span class=\"token number\">124</span>                       Use<span class=\"token double-colon punctuation\">::</span><span class=\"token class-name\">InlineField</span><span class=\"token double-colon punctuation\">::</span><span class=\"token function\">encode</span><span class=\"token punctuation\">(</span>is_inline<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token number\">125</span>     to<span class=\"token operator\">-></span><span class=\"token function\">AppendUse</span><span class=\"token punctuation\">(</span>use<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>  <span class=\"token comment\">/*这里 node 的 use 是保存到 inputs node 的 use 链表中*/</span>\n<span class=\"token number\">126</span>   <span class=\"token punctuation\">}</span>\n<span class=\"token number\">127</span>   node<span class=\"token operator\">-></span><span class=\"token function\">Verify</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token number\">128</span>   <span class=\"token keyword\">return</span> node<span class=\"token punctuation\">;</span>\n<span class=\"token number\">129</span> <span class=\"token punctuation\">}</span>\n</code></pre>\n"}]},{"t":"list_item","d":4,"p":{"lines":[245,246]},"v":"Node::InputCount()","c":[{"t":"list_item","d":6,"p":{"lines":[246,287]},"v":"<pre class=\"language-cpp\"><code class=\"language-cpp\"><span class=\"token comment\">// src/compiler/node.h</span>\n<span class=\"token comment\">// 返回一个节点的 input 数(value_in + effect_in + control_in)</span>\n<span class=\"token number\">60</span>   <span class=\"token keyword\">int</span> <span class=\"token function\">InputCount</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token keyword\">const</span> <span class=\"token punctuation\">{</span>\n<span class=\"token number\">61</span>     <span class=\"token keyword\">return</span> <span class=\"token function\">has_inline_inputs</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">?</span> <span class=\"token class-name\">InlineCountField</span><span class=\"token double-colon punctuation\">::</span><span class=\"token function\">decode</span><span class=\"token punctuation\">(</span>bit_field_<span class=\"token punctuation\">)</span>\n<span class=\"token number\">62</span>                                <span class=\"token operator\">:</span> <span class=\"token function\">outline_inputs</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token operator\">-></span>count_<span class=\"token punctuation\">;</span>\n<span class=\"token number\">63</span>   <span class=\"token punctuation\">}</span>\n<span class=\"token comment\">// ++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++</span>\n<span class=\"token comment\">// 调试例子1</span>\n<span class=\"token punctuation\">(</span>gdb<span class=\"token punctuation\">)</span> bt\n#<span class=\"token number\">0</span>  <span class=\"token class-name\">Operator</span><span class=\"token double-colon punctuation\">::</span><span class=\"token function\">Operator</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">.</span><span class=\"token punctuation\">.</span><span class=\"token punctuation\">.</span><span class=\"token punctuation\">,</span> \n        mnemonic<span class=\"token operator\">=</span><span class=\"token number\">0x7ffff4f99641</span> <span class=\"token string\">\"CheckMaps\"</span><span class=\"token punctuation\">,</span> \n        value_in<span class=\"token operator\">=</span><span class=\"token number\">1</span><span class=\"token punctuation\">,</span> effect_in<span class=\"token operator\">=</span><span class=\"token number\">1</span><span class=\"token punctuation\">,</span> control_in<span class=\"token operator\">=</span><span class=\"token number\">1</span><span class=\"token punctuation\">,</span> \n        <span class=\"token punctuation\">.</span><span class=\"token punctuation\">.</span><span class=\"token punctuation\">.</span><span class=\"token punctuation\">)</span>\n    at <span class=\"token punctuation\">.</span><span class=\"token punctuation\">.</span><span class=\"token operator\">/</span><span class=\"token punctuation\">.</span><span class=\"token punctuation\">.</span><span class=\"token operator\">/</span>src<span class=\"token operator\">/</span>compiler<span class=\"token operator\">/</span><span class=\"token keyword\">operator</span><span class=\"token punctuation\">.</span>cc<span class=\"token operator\">:</span><span class=\"token number\">31</span>\n\n<span class=\"token punctuation\">(</span>gdb<span class=\"token punctuation\">)</span> frame <span class=\"token number\">4</span>\n#<span class=\"token number\">4</span>  ReduceGlobalAccess at <span class=\"token punctuation\">.</span><span class=\"token punctuation\">.</span><span class=\"token operator\">/</span><span class=\"token punctuation\">.</span><span class=\"token punctuation\">.</span><span class=\"token operator\">/</span>src<span class=\"token operator\">/</span>compiler<span class=\"token operator\">/</span>js<span class=\"token operator\">-</span>native<span class=\"token operator\">-</span>context<span class=\"token operator\">-</span>specialization<span class=\"token punctuation\">.</span>cc<span class=\"token operator\">:</span><span class=\"token number\">942</span>\n<span class=\"token number\">941</span>           effect <span class=\"token operator\">=</span> <span class=\"token function\">graph</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token operator\">-></span><span class=\"token function\">NewNode</span><span class=\"token punctuation\">(</span>\n<span class=\"token number\">942</span>               <span class=\"token function\">simplified</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token operator\">-></span><span class=\"token function\">CheckMaps</span><span class=\"token punctuation\">(</span>\n\n<span class=\"token punctuation\">(</span>gdb<span class=\"token punctuation\">)</span> p effect<span class=\"token operator\">-></span><span class=\"token function\">InputCount</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n$<span class=\"token number\">27</span> <span class=\"token operator\">=</span> <span class=\"token number\">3</span>\n\n<span class=\"token comment\">// ++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++</span>\n<span class=\"token comment\">// 调试例子2</span>\n#<span class=\"token number\">0</span>  <span class=\"token function\">Operator</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">.</span><span class=\"token punctuation\">.</span><span class=\"token punctuation\">,</span> \n        mnemonic<span class=\"token operator\">=</span><span class=\"token number\">0x7ffff4f285f4</span> <span class=\"token string\">\"StoreField\"</span><span class=\"token punctuation\">,</span> \n        value_in<span class=\"token operator\">=</span><span class=\"token number\">2</span><span class=\"token punctuation\">,</span> effect_in<span class=\"token operator\">=</span><span class=\"token number\">1</span><span class=\"token punctuation\">,</span> control_in<span class=\"token operator\">=</span><span class=\"token number\">1</span><span class=\"token punctuation\">,</span> \n        <span class=\"token punctuation\">.</span><span class=\"token punctuation\">.</span><span class=\"token punctuation\">.</span><span class=\"token punctuation\">)</span>\n    at <span class=\"token punctuation\">.</span><span class=\"token punctuation\">.</span><span class=\"token operator\">/</span><span class=\"token punctuation\">.</span><span class=\"token punctuation\">.</span><span class=\"token operator\">/</span>src<span class=\"token operator\">/</span>compiler<span class=\"token operator\">/</span><span class=\"token keyword\">operator</span><span class=\"token punctuation\">.</span>cc<span class=\"token operator\">:</span><span class=\"token number\">31</span>\n\n<span class=\"token punctuation\">(</span>gdb<span class=\"token punctuation\">)</span> p effect<span class=\"token operator\">-></span><span class=\"token function\">InputCount</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n$<span class=\"token number\">29</span> <span class=\"token operator\">=</span> <span class=\"token number\">4</span>\n<span class=\"token punctuation\">(</span>gdb<span class=\"token punctuation\">)</span> p <span class=\"token operator\">*</span><span class=\"token punctuation\">(</span>effect<span class=\"token operator\">-></span><span class=\"token function\">op</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span>\n$<span class=\"token number\">32</span> <span class=\"token operator\">=</span> <span class=\"token punctuation\">{</span>\n<span class=\"token punctuation\">.</span><span class=\"token punctuation\">.</span><span class=\"token punctuation\">.</span>\nmnemonic_ <span class=\"token operator\">=</span> <span class=\"token number\">0x7ffff4f285f4</span> <span class=\"token string\">\"StoreField\"</span><span class=\"token punctuation\">,</span>\n<span class=\"token comment\">// ++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++</span>\n</code></pre>\n"}]},{"t":"list_item","d":4,"p":{"lines":[287,288]},"v":"Node::inline_inputs()","c":[{"t":"list_item","d":6,"p":{"lines":[288,300]},"v":"<pre class=\"language-cpp\"><code class=\"language-cpp\"><span class=\"token comment\">// src/compiler/node.h:244</span>\n<span class=\"token comment\">// 获取 input 数组起始地址</span>\n<span class=\"token number\">244</span>   ZoneNodePtr<span class=\"token operator\">*</span> <span class=\"token function\">inline_inputs</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token keyword\">const</span> <span class=\"token punctuation\">{</span>\n<span class=\"token number\">245</span>     <span class=\"token keyword\">return</span> <span class=\"token generic-function\"><span class=\"token function\">reinterpret_cast</span><span class=\"token generic class-name\"><span class=\"token operator\">&lt;</span>ZoneNodePtr<span class=\"token operator\">*</span><span class=\"token operator\">></span></span></span><span class=\"token punctuation\">(</span><span class=\"token function\">inputs_location</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token number\">246</span>   <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">.</span><span class=\"token punctuation\">.</span><span class=\"token punctuation\">.</span>\n<span class=\"token number\">307</span> Address <span class=\"token class-name\">Node</span><span class=\"token double-colon punctuation\">::</span><span class=\"token function\">inputs_location</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token keyword\">const</span> <span class=\"token punctuation\">{</span>\n<span class=\"token number\">308</span>   <span class=\"token keyword\">return</span> <span class=\"token generic-function\"><span class=\"token function\">reinterpret_cast</span><span class=\"token generic class-name\"><span class=\"token operator\">&lt;</span>Address<span class=\"token operator\">></span></span></span><span class=\"token punctuation\">(</span><span class=\"token keyword\">this</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">+</span> <span class=\"token keyword\">sizeof</span><span class=\"token punctuation\">(</span>Node<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token number\">309</span> <span class=\"token punctuation\">}</span>\n</code></pre>\n"}]},{"t":"list_item","d":4,"p":{"lines":[300,301]},"v":"Node::InputAt()","c":[{"t":"list_item","d":6,"p":{"lines":[301,317]},"v":"<pre class=\"language-cpp\"><code class=\"language-cpp\"><span class=\"token comment\">// src/compiler/node.h</span>\n<span class=\"token comment\">// 获取 inputs 数组中第 i 个 node *</span>\n<span class=\"token number\">71</span>   Node<span class=\"token operator\">*</span> <span class=\"token function\">InputAt</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">int</span> index<span class=\"token punctuation\">)</span> <span class=\"token keyword\">const</span> <span class=\"token punctuation\">{</span>\n<span class=\"token punctuation\">.</span><span class=\"token punctuation\">.</span><span class=\"token punctuation\">.</span>\n<span class=\"token number\">74</span>     <span class=\"token keyword\">return</span> <span class=\"token operator\">*</span><span class=\"token function\">GetInputPtrConst</span><span class=\"token punctuation\">(</span>index<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token number\">75</span>   <span class=\"token punctuation\">}</span>\n</code></pre>\n","c":[{"t":"list_item","d":8,"p":{"lines":[310,317]},"v":"<pre class=\"language-cpp\"><code class=\"language-cpp\"><span class=\"token number\">254</span>   ZoneNodePtr <span class=\"token keyword\">const</span><span class=\"token operator\">*</span> <span class=\"token function\">GetInputPtrConst</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">int</span> input_index<span class=\"token punctuation\">)</span> <span class=\"token keyword\">const</span> <span class=\"token punctuation\">{</span>\n<span class=\"token number\">255</span>     <span class=\"token keyword\">return</span> <span class=\"token function\">has_inline_inputs</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">?</span> <span class=\"token operator\">&amp;</span><span class=\"token punctuation\">(</span><span class=\"token function\">inline_inputs</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">[</span>input_index<span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span>\n<span class=\"token number\">256</span>                                <span class=\"token operator\">:</span> <span class=\"token operator\">&amp;</span><span class=\"token punctuation\">(</span><span class=\"token function\">outline_inputs</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token operator\">-></span><span class=\"token function\">inputs</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">[</span>input_index<span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token number\">257</span>   <span class=\"token punctuation\">}</span>\n</code></pre>\n"}]}]},{"t":"list_item","d":4,"p":{"lines":[317,318]},"v":"Node::first_use_","c":[{"t":"list_item","d":6,"p":{"lines":[318,319]},"v":"一个 后进先出的链表，first_use_ 指向最后添加的 Node::Use 对象"}]},{"t":"list_item","d":4,"p":{"lines":[319,320]},"v":"Node::RemoveUse() &amp; Node::AppendUse()","c":[{"t":"list_item","d":6,"p":{"lines":[320,321]},"v":"对 node-&gt;first_use_ 链表做操作"},{"t":"list_item","d":6,"p":{"lines":[321,335]},"v":"<pre class=\"language-cpp\"><code class=\"language-cpp\"><span class=\"token comment\">// src/compiler/node.cc:411</span>\n<span class=\"token number\">411</span> <span class=\"token keyword\">void</span> <span class=\"token class-name\">Node</span><span class=\"token double-colon punctuation\">::</span><span class=\"token function\">RemoveUse</span><span class=\"token punctuation\">(</span>Use<span class=\"token operator\">*</span> use<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n<span class=\"token number\">413</span>   <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>use<span class=\"token operator\">-></span>prev<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n<span class=\"token number\">415</span>     use<span class=\"token operator\">-></span>prev<span class=\"token operator\">-></span>next <span class=\"token operator\">=</span> use<span class=\"token operator\">-></span>next<span class=\"token punctuation\">;</span>\n<span class=\"token number\">416</span>   <span class=\"token punctuation\">}</span> <span class=\"token keyword\">else</span> <span class=\"token punctuation\">{</span>\n<span class=\"token number\">418</span>     first_use_ <span class=\"token operator\">=</span> use<span class=\"token operator\">-></span>next<span class=\"token punctuation\">;</span>\n<span class=\"token number\">419</span>   <span class=\"token punctuation\">}</span>\n<span class=\"token number\">420</span>   <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>use<span class=\"token operator\">-></span>next<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n<span class=\"token number\">421</span>     use<span class=\"token operator\">-></span>next<span class=\"token operator\">-></span>prev <span class=\"token operator\">=</span> use<span class=\"token operator\">-></span>prev<span class=\"token punctuation\">;</span>\n<span class=\"token number\">422</span>   <span class=\"token punctuation\">}</span>\n<span class=\"token number\">423</span> <span class=\"token punctuation\">}</span>\n</code></pre>\n"},{"t":"list_item","d":6,"p":{"lines":[335,345]},"v":"<pre class=\"language-cpp\"><code class=\"language-cpp\"><span class=\"token comment\">// src/compiler/node.cc</span>\n<span class=\"token number\">401</span> <span class=\"token keyword\">void</span> <span class=\"token class-name\">Node</span><span class=\"token double-colon punctuation\">::</span><span class=\"token function\">AppendUse</span><span class=\"token punctuation\">(</span>Use<span class=\"token operator\">*</span> use<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n<span class=\"token number\">404</span>   use<span class=\"token operator\">-></span>next <span class=\"token operator\">=</span> first_use_<span class=\"token punctuation\">;</span>\n<span class=\"token number\">405</span>   use<span class=\"token operator\">-></span>prev <span class=\"token operator\">=</span> <span class=\"token keyword\">nullptr</span><span class=\"token punctuation\">;</span>\n<span class=\"token number\">406</span>   <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>first_use_<span class=\"token punctuation\">)</span> first_use_<span class=\"token operator\">-></span>prev <span class=\"token operator\">=</span> use<span class=\"token punctuation\">;</span>\n<span class=\"token number\">407</span>   first_use_ <span class=\"token operator\">=</span> use<span class=\"token punctuation\">;</span>\n<span class=\"token number\">408</span> <span class=\"token punctuation\">}</span>\n</code></pre>\n"}]}]},{"t":"heading","d":2,"p":{"lines":[345,346]},"v":"Node::Inputs","c":[{"t":"list_item","d":4,"p":{"lines":[346,347]},"v":"一个 iterator , 起始地址是 input_root_ 长度是 count_, 移动方式就是 input_root_++"},{"t":"list_item","d":4,"p":{"lines":[347,348]},"v":"用于遍历 inputs 数组"},{"t":"list_item","d":4,"p":{"lines":[348,372]},"v":"<pre class=\"language-cpp\"><code class=\"language-cpp\"><span class=\"token comment\">// src/compiler/node.h</span>\n<span class=\"token number\">398</span> <span class=\"token keyword\">class</span> <span class=\"token class-name\">V8_EXPORT_PRIVATE</span> Node<span class=\"token double-colon punctuation\">::</span>Inputs <span class=\"token keyword\">final</span> <span class=\"token punctuation\">{</span>\n<span class=\"token number\">399</span>  <span class=\"token keyword\">public</span><span class=\"token operator\">:</span>\n<span class=\"token number\">400</span>   <span class=\"token keyword\">using</span> value_type <span class=\"token operator\">=</span> Node<span class=\"token operator\">*</span><span class=\"token punctuation\">;</span>\n<span class=\"token number\">401</span>   \n<span class=\"token number\">402</span>   <span class=\"token keyword\">class</span> <span class=\"token class-name\">const_iterator</span><span class=\"token punctuation\">;</span>\n<span class=\"token number\">403</span>   <span class=\"token keyword\">inline</span> const_iterator <span class=\"token function\">begin</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token keyword\">const</span><span class=\"token punctuation\">;</span>\n<span class=\"token number\">404</span>   <span class=\"token keyword\">inline</span> const_iterator <span class=\"token function\">end</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token keyword\">const</span><span class=\"token punctuation\">;</span>\n<span class=\"token number\">405</span>\n<span class=\"token number\">406</span>   <span class=\"token keyword\">bool</span> <span class=\"token function\">empty</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token keyword\">const</span> <span class=\"token punctuation\">{</span> <span class=\"token keyword\">return</span> count_ <span class=\"token operator\">==</span> <span class=\"token number\">0</span><span class=\"token punctuation\">;</span> <span class=\"token punctuation\">}</span>\n<span class=\"token number\">407</span>   <span class=\"token keyword\">int</span> <span class=\"token function\">count</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token keyword\">const</span> <span class=\"token punctuation\">{</span> <span class=\"token keyword\">return</span> count_<span class=\"token punctuation\">;</span> <span class=\"token punctuation\">}</span>\n<span class=\"token number\">408</span>\n<span class=\"token number\">409</span>   <span class=\"token keyword\">inline</span> value_type <span class=\"token keyword\">operator</span><span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">int</span> index<span class=\"token punctuation\">)</span> <span class=\"token keyword\">const</span><span class=\"token punctuation\">;</span>\n<span class=\"token number\">410</span>\n<span class=\"token number\">411</span>   <span class=\"token keyword\">explicit</span> <span class=\"token function\">Inputs</span><span class=\"token punctuation\">(</span>ZoneNodePtr <span class=\"token keyword\">const</span><span class=\"token operator\">*</span> input_root<span class=\"token punctuation\">,</span> <span class=\"token keyword\">int</span> count<span class=\"token punctuation\">)</span>\n<span class=\"token number\">412</span>       <span class=\"token operator\">:</span> <span class=\"token function\">input_root_</span><span class=\"token punctuation\">(</span>input_root<span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span> <span class=\"token function\">count_</span><span class=\"token punctuation\">(</span>count<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span><span class=\"token punctuation\">}</span>\n<span class=\"token number\">413</span>\n<span class=\"token number\">414</span>  <span class=\"token keyword\">private</span><span class=\"token operator\">:</span>\n<span class=\"token number\">415</span>   ZoneNodePtr <span class=\"token keyword\">const</span><span class=\"token operator\">*</span> input_root_<span class=\"token punctuation\">;</span> <span class=\"token comment\">/* &amp;数组[0] */</span>\n<span class=\"token number\">416</span>   <span class=\"token keyword\">int</span> count_<span class=\"token punctuation\">;</span>  <span class=\"token comment\">/* 数组长度 n */</span>\n<span class=\"token number\">417</span> <span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span>\n</code></pre>\n"},{"t":"list_item","d":4,"p":{"lines":[372,394]},"v":"<pre class=\"language-cpp\"><code class=\"language-cpp\"><span class=\"token number\">589</span> Node<span class=\"token double-colon punctuation\">::</span>Inputs<span class=\"token double-colon punctuation\">::</span>const_iterator Node<span class=\"token double-colon punctuation\">::</span><span class=\"token class-name\">Inputs</span><span class=\"token double-colon punctuation\">::</span><span class=\"token function\">begin</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token keyword\">const</span> <span class=\"token punctuation\">{</span>\n<span class=\"token number\">590</span>   <span class=\"token keyword\">return</span> <span class=\"token function\">const_iterator</span><span class=\"token punctuation\">(</span>input_root_<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token number\">591</span> <span class=\"token punctuation\">}</span>\n<span class=\"token number\">592</span>\n<span class=\"token number\">593</span>\n<span class=\"token number\">594</span> Node<span class=\"token double-colon punctuation\">::</span>Inputs<span class=\"token double-colon punctuation\">::</span>const_iterator Node<span class=\"token double-colon punctuation\">::</span><span class=\"token class-name\">Inputs</span><span class=\"token double-colon punctuation\">::</span><span class=\"token function\">end</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token keyword\">const</span> <span class=\"token punctuation\">{</span>\n<span class=\"token number\">595</span>   <span class=\"token keyword\">return</span> <span class=\"token function\">const_iterator</span><span class=\"token punctuation\">(</span>input_root_ <span class=\"token operator\">+</span> count_<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token number\">596</span> <span class=\"token punctuation\">}</span>\n\n<span class=\"token number\">546</span> <span class=\"token keyword\">class</span> <span class=\"token class-name\">Node</span><span class=\"token operator\">:</span><span class=\"token base-clause\"><span class=\"token operator\">:</span>Inputs<span class=\"token double-colon punctuation\">::</span><span class=\"token class-name\">const_iterator</span> <span class=\"token keyword\">final</span></span> <span class=\"token punctuation\">{</span>\n<span class=\"token number\">556</span>   Node<span class=\"token operator\">*</span> <span class=\"token keyword\">operator</span><span class=\"token operator\">*</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token keyword\">const</span> <span class=\"token punctuation\">{</span> <span class=\"token keyword\">return</span> <span class=\"token operator\">*</span>input_ptr_<span class=\"token punctuation\">;</span> <span class=\"token punctuation\">}</span>\n\n<span class=\"token comment\">// 遍历的方式就是指针 +1 相当于一个连续内存上的 ZoneNodePtr const* 指针数组</span>\n<span class=\"token number\">563</span>   const_iterator<span class=\"token operator\">&amp;</span> <span class=\"token keyword\">operator</span><span class=\"token operator\">++</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n<span class=\"token number\">564</span>     <span class=\"token operator\">++</span>input_ptr_<span class=\"token punctuation\">;</span>\n<span class=\"token number\">565</span>     <span class=\"token keyword\">return</span> <span class=\"token operator\">*</span><span class=\"token keyword\">this</span><span class=\"token punctuation\">;</span>\n<span class=\"token number\">566</span>   <span class=\"token punctuation\">}</span>\n<span class=\"token comment\">//  ptype this</span>\n<span class=\"token comment\">// class const_iterator*</span>\n</code></pre>\n"},{"t":"list_item","d":4,"p":{"lines":[394,413]},"v":"<pre class=\"language-cpp\"><code class=\"language-cpp\"><span class=\"token number\">477</span> Node<span class=\"token double-colon punctuation\">::</span>Inputs <span class=\"token class-name\">Node</span><span class=\"token double-colon punctuation\">::</span><span class=\"token function\">inputs</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token keyword\">const</span> <span class=\"token punctuation\">{</span>\n<span class=\"token number\">478</span>   <span class=\"token keyword\">int</span> inline_count <span class=\"token operator\">=</span> <span class=\"token class-name\">InlineCountField</span><span class=\"token double-colon punctuation\">::</span><span class=\"token function\">decode</span><span class=\"token punctuation\">(</span>bit_field_<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>  <span class=\"token comment\">// (bit_field_ &amp; 0xf000000) >> 24</span>\n<span class=\"token number\">479</span>   <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>inline_count <span class=\"token operator\">!=</span> kOutlineMarker<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span> \n<span class=\"token number\">480</span>     <span class=\"token keyword\">return</span> <span class=\"token function\">Inputs</span><span class=\"token punctuation\">(</span><span class=\"token function\">inline_inputs</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span> inline_count<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">.</span><span class=\"token punctuation\">.</span><span class=\"token punctuation\">.</span>\n\n<span class=\"token number\">244</span>   ZoneNodePtr<span class=\"token operator\">*</span> <span class=\"token function\">inline_inputs</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token keyword\">const</span> <span class=\"token punctuation\">{</span>\n<span class=\"token number\">245</span>     <span class=\"token punctuation\">.</span><span class=\"token punctuation\">.</span><span class=\"token punctuation\">.</span>\n        <span class=\"token keyword\">return</span> <span class=\"token punctuation\">(</span><span class=\"token keyword\">void</span> <span class=\"token operator\">*</span><span class=\"token punctuation\">)</span><span class=\"token keyword\">this</span> <span class=\"token operator\">+</span> <span class=\"token keyword\">sizeof</span><span class=\"token punctuation\">(</span>Node<span class=\"token punctuation\">)</span> \n\n<span class=\"token punctuation\">(</span>gdb<span class=\"token punctuation\">)</span> p node_inputs\n$<span class=\"token number\">37</span> <span class=\"token operator\">=</span> <span class=\"token punctuation\">{</span>input_root_ <span class=\"token operator\">=</span> <span class=\"token number\">0x555555778358</span><span class=\"token punctuation\">,</span> count_ <span class=\"token operator\">=</span> <span class=\"token number\">3</span><span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">(</span>gdb<span class=\"token punctuation\">)</span> <span class=\"token function\">p</span> <span class=\"token punctuation\">(</span>node<span class=\"token operator\">-></span>bit_field_ <span class=\"token operator\">&amp;</span> <span class=\"token number\">0xf000000</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">>></span> <span class=\"token number\">24</span>\n$<span class=\"token number\">38</span> <span class=\"token operator\">=</span> <span class=\"token number\">3</span>\n<span class=\"token punctuation\">(</span>gdb<span class=\"token punctuation\">)</span> p node <span class=\"token operator\">+</span> <span class=\"token number\">1</span>\n$<span class=\"token number\">39</span> <span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span>Node <span class=\"token operator\">*</span><span class=\"token punctuation\">)</span> <span class=\"token number\">0x555555778358</span>\n</code></pre>\n"}]},{"t":"heading","d":2,"p":{"lines":[413,414]},"v":"Node::Use","c":[{"t":"list_item","d":4,"p":{"lines":[414,415]},"v":"Takeaway","c":[{"t":"list_item","d":6,"p":{"lines":[415,416]},"v":"由 Node.first_use_ 构建的 Node::Use 链表中的一个节点"},{"t":"list_item","d":6,"p":{"lines":[416,417]},"v":"每个 Node::Use 与一个 input node(见 Node::New() ) 一一对应"},{"t":"list_item","d":6,"p":{"lines":[417,418]},"v":"通过 Node::Use.input_ptr() 找到 input node (实际上就是算出偏移)"},{"t":"list_item","d":6,"p":{"lines":[418,419]},"v":"Node::Use.from() 对应的是当前的 Node(见 Node::New() )"},{"t":"list_item","d":6,"p":{"lines":[419,420]},"v":"相当于对 input node 的封装，方便通过 Node 管理"},{"t":"list_item","d":6,"p":{"lines":[420,421]},"v":"Node::UseEdges 中的 current_ 和 next_ 就是 Node::Use 类型的指针"}]},{"t":"list_item","d":4,"p":{"lines":[421,536]},"v":"<pre class=\"language-cpp\"><code class=\"language-cpp\"><span class=\"token comment\">// src/compiler/node.h:181</span>\n<span class=\"token punctuation\">(</span>gdb<span class=\"token punctuation\">)</span> ptype Node<span class=\"token double-colon punctuation\">::</span>Use\ntype <span class=\"token operator\">=</span> <span class=\"token keyword\">struct</span> <span class=\"token class-name\">Node</span><span class=\"token operator\">:</span><span class=\"token base-clause\"><span class=\"token operator\">:</span><span class=\"token class-name\">Use</span></span> <span class=\"token punctuation\">{</span>\n    Node<span class=\"token double-colon punctuation\">::</span>ZoneUsePtr next<span class=\"token punctuation\">;</span>\n    Node<span class=\"token double-colon punctuation\">::</span>ZoneUsePtr prev<span class=\"token punctuation\">;</span>\n    <span class=\"token keyword\">uint32_t</span> bit_field_<span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">public</span><span class=\"token operator\">:</span>\n    <span class=\"token keyword\">int</span> <span class=\"token function\">input_index</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">void</span><span class=\"token punctuation\">)</span> <span class=\"token keyword\">const</span><span class=\"token punctuation\">;</span>\n    <span class=\"token keyword\">bool</span> <span class=\"token function\">is_inline_use</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">void</span><span class=\"token punctuation\">)</span> <span class=\"token keyword\">const</span><span class=\"token punctuation\">;</span>\n    ZoneNodePtr <span class=\"token operator\">*</span> <span class=\"token function\">input_ptr</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">void</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    Node <span class=\"token operator\">*</span> <span class=\"token function\">from</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">void</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span>\n\n<span class=\"token comment\">// (gdb) ptype this</span>\n<span class=\"token comment\">// type = struct Node::Use </span>\n<span class=\"token comment\">// (gdb) p (void *)(this + 1) - (void *)this</span>\n<span class=\"token comment\">// $4 = 24</span>\n</code></pre>\n","c":[{"t":"list_item","d":6,"p":{"lines":[441,442]},"v":"Node::Use::bit_field_","c":[{"t":"list_item","d":8,"p":{"lines":[442,443]},"v":"和 Node::bit_field_ 不是同一个"}]},{"t":"list_item","d":6,"p":{"lines":[443,444]},"v":"Node::Use::input_index()","c":[{"t":"list_item","d":8,"p":{"lines":[444,445]},"v":"就是👉 : <code>p/x (this-&gt;bit_field_ &amp; 0xfffffffe) &gt;&gt; 1</code>"},{"t":"list_item","d":8,"p":{"lines":[445,475]},"v":"<pre class=\"language-cpp\"><code class=\"language-cpp\"><span class=\"token comment\">// #0  0x00007ffff74d4784 in v8::base::BitField&lt;unsigned int, 1, 31, unsigned int>::</span>\n<span class=\"token comment\">//         decode (value=7) at ../../src/base/bit-field.h:66</span>\n<span class=\"token comment\">// #1  compiler::Node::Use::input_index (this=0x5555557780f0) </span>\n<span class=\"token comment\">//         at ../../src/compiler/node.h:186</span>\n\n<span class=\"token number\">186</span>     <span class=\"token keyword\">int</span> <span class=\"token function\">input_index</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token keyword\">const</span> <span class=\"token punctuation\">{</span> <span class=\"token keyword\">return</span> <span class=\"token class-name\">InputIndexField</span><span class=\"token double-colon punctuation\">::</span><span class=\"token function\">decode</span><span class=\"token punctuation\">(</span>bit_field_<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span> <span class=\"token punctuation\">}</span>\n\n<span class=\"token number\">22</span> <span class=\"token keyword\">template</span> <span class=\"token operator\">&lt;</span><span class=\"token keyword\">class</span> <span class=\"token class-name\">T</span><span class=\"token punctuation\">,</span> <span class=\"token keyword\">int</span> shift<span class=\"token punctuation\">,</span> <span class=\"token keyword\">int</span> size<span class=\"token punctuation\">,</span> <span class=\"token keyword\">class</span> <span class=\"token class-name\">U</span> <span class=\"token operator\">=</span> <span class=\"token keyword\">uint32_t</span><span class=\"token operator\">></span>\n<span class=\"token number\">23</span> <span class=\"token keyword\">class</span> <span class=\"token class-name\">BitField</span> <span class=\"token keyword\">final</span> <span class=\"token punctuation\">{</span>\n<span class=\"token number\">64</span>   <span class=\"token comment\">// Extracts the bit field from the value.</span>\n<span class=\"token number\">65</span>   <span class=\"token keyword\">static</span> <span class=\"token keyword\">constexpr</span> T <span class=\"token function\">decode</span><span class=\"token punctuation\">(</span>U value<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n<span class=\"token number\">66</span>     <span class=\"token keyword\">return</span> <span class=\"token generic-function\"><span class=\"token function\">static_cast</span><span class=\"token generic class-name\"><span class=\"token operator\">&lt;</span>T<span class=\"token operator\">></span></span></span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span>value <span class=\"token operator\">&amp;</span> kMask<span class=\"token punctuation\">)</span> <span class=\"token operator\">>></span> kShift<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token number\">67</span>   <span class=\"token punctuation\">}</span>\n<span class=\"token number\">68</span> <span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span>\n<span class=\"token comment\">// +++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++</span>\n<span class=\"token punctuation\">(</span>gdb<span class=\"token punctuation\">)</span> p kShift\n$<span class=\"token number\">16</span> <span class=\"token operator\">=</span> <span class=\"token number\">1</span>\n<span class=\"token punctuation\">(</span>gdb<span class=\"token punctuation\">)</span> p<span class=\"token operator\">/</span>x kMask\n$<span class=\"token number\">18</span> <span class=\"token operator\">=</span> <span class=\"token number\">0xfffffffe</span>\n\n<span class=\"token punctuation\">(</span>gdb<span class=\"token punctuation\">)</span> i reg eax\neax            <span class=\"token number\">0x3</span>     \n<span class=\"token punctuation\">(</span>gdb<span class=\"token punctuation\">)</span> p<span class=\"token operator\">/</span>x value\n$<span class=\"token number\">20</span> <span class=\"token operator\">=</span> <span class=\"token number\">0x7</span>\n<span class=\"token punctuation\">(</span>gdb<span class=\"token punctuation\">)</span> p<span class=\"token operator\">/</span><span class=\"token function\">x</span> <span class=\"token punctuation\">(</span>value <span class=\"token operator\">&amp;</span> <span class=\"token number\">0xfffffffe</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">>></span> <span class=\"token number\">1</span>\n$<span class=\"token number\">21</span> <span class=\"token operator\">=</span> <span class=\"token number\">0x3</span>\n\n</code></pre>\n"}]},{"t":"list_item","d":6,"p":{"lines":[475,476]},"v":"Node::Use::is_inline_use()","c":[{"t":"list_item","d":8,"p":{"lines":[476,477]},"v":"就是👉 : <code>p/x (this-&gt;bit_field_ &amp; 1) &gt;&gt; 0</code>"},{"t":"list_item","d":8,"p":{"lines":[477,497]},"v":"<pre class=\"language-cpp\"><code class=\"language-cpp\"><span class=\"token comment\">// #0  v8::base::BitField&lt;bool, 0, 1, unsigned int>::decode (value=7) </span>\n<span class=\"token comment\">//        at ../../src/base/bit-field.h:66</span>\n<span class=\"token comment\">// #1  Node::Use::is_inline_use (this=0x5555557780f0) </span>\n<span class=\"token comment\">//    at ../../src/compiler/node.h:187</span>\n<span class=\"token number\">66</span>     <span class=\"token keyword\">return</span> <span class=\"token generic-function\"><span class=\"token function\">static_cast</span><span class=\"token generic class-name\"><span class=\"token operator\">&lt;</span>T<span class=\"token operator\">></span></span></span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span>value <span class=\"token operator\">&amp;</span> kMask<span class=\"token punctuation\">)</span> <span class=\"token operator\">>></span> kShift<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token punctuation\">(</span>gdb<span class=\"token punctuation\">)</span> p<span class=\"token operator\">/</span>x kMask\n$<span class=\"token number\">22</span> <span class=\"token operator\">=</span> <span class=\"token number\">0x1</span>\n<span class=\"token punctuation\">(</span>gdb<span class=\"token punctuation\">)</span> p<span class=\"token operator\">/</span>x kShift\n$<span class=\"token number\">23</span> <span class=\"token operator\">=</span> <span class=\"token number\">0x0</span>\n\n<span class=\"token punctuation\">(</span>gdb<span class=\"token punctuation\">)</span> i reg eax\neax            <span class=\"token number\">0x1</span>                 <span class=\"token number\">1</span>\n<span class=\"token punctuation\">(</span>gdb<span class=\"token punctuation\">)</span> p<span class=\"token operator\">/</span><span class=\"token function\">x</span> <span class=\"token punctuation\">(</span>value <span class=\"token operator\">&amp;</span> <span class=\"token number\">1</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">>></span> <span class=\"token number\">0</span>\n$<span class=\"token number\">25</span> <span class=\"token operator\">=</span> <span class=\"token number\">0x1</span>\n<span class=\"token punctuation\">(</span>gdb<span class=\"token punctuation\">)</span> p<span class=\"token operator\">/</span>x value\n$<span class=\"token number\">26</span> <span class=\"token operator\">=</span> <span class=\"token number\">0x7</span>\n</code></pre>\n"}]},{"t":"list_item","d":6,"p":{"lines":[497,498]},"v":"Node::Use::from()","c":[{"t":"list_item","d":8,"p":{"lines":[498,515]},"v":"<pre class=\"language-cpp\"><code class=\"language-cpp\"><span class=\"token comment\">// src/compiler/node.h</span>\n<span class=\"token comment\">// 根据index 计算偏移，找到位于连续内存的那个node</span>\n<span class=\"token comment\">// use 和 use.from() 的关系：</span>\n<span class=\"token comment\">//  通过 use.input_ptr() 可以找到 使用 use.from() 的 node</span>\n<span class=\"token comment\">//  即 use.input_ptr() 位于 use.from() 上方(Turbolizer 图)</span>\n<span class=\"token comment\">//  use 本身位于 use.from() 内存的前面</span>\n<span class=\"token comment\">//  指向 use.input_ptr 的指针保存在 use.from() 内存的后面</span>\n\n<span class=\"token number\">197</span>     Node<span class=\"token operator\">*</span> <span class=\"token function\">from</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n<span class=\"token number\">198</span>       Use<span class=\"token operator\">*</span> start <span class=\"token operator\">=</span> <span class=\"token keyword\">this</span> <span class=\"token operator\">+</span> <span class=\"token number\">1</span> <span class=\"token operator\">+</span> <span class=\"token function\">input_index</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token number\">199</span>       <span class=\"token keyword\">return</span> <span class=\"token function\">is_inline_use</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">?</span> <span class=\"token generic-function\"><span class=\"token function\">reinterpret_cast</span><span class=\"token generic class-name\"><span class=\"token operator\">&lt;</span>Node<span class=\"token operator\">*</span><span class=\"token operator\">></span></span></span><span class=\"token punctuation\">(</span>start<span class=\"token punctuation\">)</span>\n<span class=\"token number\">200</span>                              <span class=\"token operator\">:</span> <span class=\"token generic-function\"><span class=\"token function\">reinterpret_cast</span><span class=\"token generic class-name\"><span class=\"token operator\">&lt;</span>OutOfLineInputs<span class=\"token operator\">*</span><span class=\"token operator\">></span></span></span><span class=\"token punctuation\">(</span>start<span class=\"token punctuation\">)</span><span class=\"token operator\">-></span>node_<span class=\"token punctuation\">;</span>\n<span class=\"token number\">201</span>     <span class=\"token punctuation\">}</span>\n<span class=\"token number\">205</span>   <span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span>\n</code></pre>\n"}]},{"t":"list_item","d":6,"p":{"lines":[515,516]},"v":"Node::Use::input_ptr()","c":[{"t":"list_item","d":8,"p":{"lines":[516,536]},"v":"<pre class=\"language-cpp\"><code class=\"language-cpp\"><span class=\"token comment\">// src/compiler/node.h</span>\n<span class=\"token comment\">// 见 Node::Use::from()</span>\n<span class=\"token number\">188</span>     ZoneNodePtr<span class=\"token operator\">*</span> <span class=\"token function\">input_ptr</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n          <span class=\"token comment\">// (this->bit_field_ &amp; 0xfffffffe) >> 1</span>\n<span class=\"token number\">189</span>       <span class=\"token keyword\">int</span> index <span class=\"token operator\">=</span> <span class=\"token function\">input_index</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token number\">190</span>       Use<span class=\"token operator\">*</span> start <span class=\"token operator\">=</span> <span class=\"token keyword\">this</span> <span class=\"token operator\">+</span> <span class=\"token number\">1</span> <span class=\"token operator\">+</span> index<span class=\"token punctuation\">;</span>\n            <span class=\"token comment\">//  `inline_inputs: return (void *)start + sizeof(Node) `</span>\n<span class=\"token number\">191</span>       ZoneNodePtr<span class=\"token operator\">*</span> inputs <span class=\"token operator\">=</span>\n<span class=\"token number\">192</span>           <span class=\"token function\">is_inline_use</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">?</span> <span class=\"token generic-function\"><span class=\"token function\">reinterpret_cast</span><span class=\"token generic class-name\"><span class=\"token operator\">&lt;</span>Node<span class=\"token operator\">*</span><span class=\"token operator\">></span></span></span><span class=\"token punctuation\">(</span>start<span class=\"token punctuation\">)</span><span class=\"token operator\">-></span><span class=\"token function\">inline_inputs</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n<span class=\"token number\">193</span>                           <span class=\"token operator\">:</span> <span class=\"token generic-function\"><span class=\"token function\">reinterpret_cast</span><span class=\"token generic class-name\"><span class=\"token operator\">&lt;</span>OutOfLineInputs<span class=\"token operator\">*</span><span class=\"token operator\">></span></span></span><span class=\"token punctuation\">(</span>start<span class=\"token punctuation\">)</span><span class=\"token operator\">-></span><span class=\"token function\">inputs</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token number\">194</span>       <span class=\"token keyword\">return</span> <span class=\"token operator\">&amp;</span>inputs<span class=\"token punctuation\">[</span>index<span class=\"token punctuation\">]</span><span class=\"token punctuation\">;</span>\n<span class=\"token number\">195</span>     <span class=\"token punctuation\">}</span>\n\n<span class=\"token comment\">// (gdb) p inputs</span>\n<span class=\"token comment\">// $94 = (ZoneNodePtr *) 0x555555778170</span>\n<span class=\"token comment\">// (gdb) p (void *)start + 32</span>\n<span class=\"token comment\">// $97 = (void *) 0x555555778170</span>\n</code></pre>\n"}]}]}]},{"t":"heading","d":2,"p":{"lines":[536,537]},"v":"Node::UseEdges","c":[{"t":"list_item","d":4,"p":{"lines":[537,538]},"v":"对 Node 的封装，为它添加了 iterator 用于遍历 Node::firtst_use_ 链表"},{"t":"list_item","d":4,"p":{"lines":[538,570]},"v":"<pre class=\"language-cpp\"><code class=\"language-cpp\"><span class=\"token comment\">// src/compiler/node.h</span>\n<span class=\"token punctuation\">(</span>gdb<span class=\"token punctuation\">)</span> ptype Node<span class=\"token double-colon punctuation\">::</span>UseEdges\ntype <span class=\"token operator\">=</span> <span class=\"token keyword\">class</span> <span class=\"token class-name\">Node</span><span class=\"token operator\">:</span><span class=\"token base-clause\"><span class=\"token operator\">:</span><span class=\"token class-name\">UseEdges</span></span> <span class=\"token punctuation\">{</span>\n<span class=\"token keyword\">private</span><span class=\"token operator\">:</span>\n    Node <span class=\"token operator\">*</span>node_<span class=\"token punctuation\">;</span>\n\n<span class=\"token keyword\">public</span><span class=\"token operator\">:</span>\n    Node<span class=\"token double-colon punctuation\">::</span>UseEdges<span class=\"token double-colon punctuation\">::</span>iterator <span class=\"token function\">begin</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">void</span><span class=\"token punctuation\">)</span> <span class=\"token keyword\">const</span><span class=\"token punctuation\">;</span>\n    Node<span class=\"token double-colon punctuation\">::</span>UseEdges<span class=\"token double-colon punctuation\">::</span>iterator <span class=\"token function\">end</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">void</span><span class=\"token punctuation\">)</span> <span class=\"token keyword\">const</span><span class=\"token punctuation\">;</span>\n    <span class=\"token keyword\">bool</span> <span class=\"token function\">empty</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">void</span><span class=\"token punctuation\">)</span> <span class=\"token keyword\">const</span><span class=\"token punctuation\">;</span>\n    <span class=\"token function\">UseEdges</span><span class=\"token punctuation\">(</span>Node <span class=\"token operator\">*</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span>\n\n<span class=\"token number\">119</span> <span class=\"token function\">UseEdges</span><span class=\"token punctuation\">(</span>Node<span class=\"token operator\">*</span> node<span class=\"token punctuation\">)</span> <span class=\"token operator\">:</span> <span class=\"token function\">node_</span><span class=\"token punctuation\">(</span>node<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span><span class=\"token punctuation\">}</span>\n</code></pre>\n","c":[{"t":"list_item","d":6,"p":{"lines":[555,570]},"v":"<pre class=\"language-cpp\"><code class=\"language-cpp\"><span class=\"token comment\">// Node::UseEdges::iterator</span>\n<span class=\"token comment\">// src/compiler/node.h</span>\n<span class=\"token number\">601</span> <span class=\"token keyword\">class</span> <span class=\"token class-name\">Node</span><span class=\"token operator\">:</span><span class=\"token base-clause\"><span class=\"token operator\">:</span>UseEdges<span class=\"token double-colon punctuation\">::</span><span class=\"token class-name\">iterator</span> <span class=\"token keyword\">final</span></span> <span class=\"token punctuation\">{</span>\n<span class=\"token punctuation\">.</span><span class=\"token punctuation\">.</span><span class=\"token punctuation\">.</span>\n<span class=\"token number\">605</span>   Edge <span class=\"token keyword\">operator</span><span class=\"token operator\">*</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token keyword\">const</span> <span class=\"token punctuation\">{</span> <span class=\"token keyword\">return</span> <span class=\"token function\">Edge</span><span class=\"token punctuation\">(</span>current_<span class=\"token punctuation\">,</span> current_<span class=\"token operator\">-></span><span class=\"token function\">input_ptr</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span> <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">.</span><span class=\"token punctuation\">.</span><span class=\"token punctuation\">.</span>\n<span class=\"token number\">622</span>   <span class=\"token keyword\">explicit</span> <span class=\"token function\">iterator</span><span class=\"token punctuation\">(</span>Node<span class=\"token operator\">*</span> node<span class=\"token punctuation\">)</span>\n<span class=\"token number\">623</span>       <span class=\"token operator\">:</span> <span class=\"token function\">current_</span><span class=\"token punctuation\">(</span>node<span class=\"token operator\">-></span>first_use_<span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>\n<span class=\"token number\">624</span>         <span class=\"token function\">next_</span><span class=\"token punctuation\">(</span>current_ <span class=\"token operator\">?</span> <span class=\"token generic-function\"><span class=\"token function\">static_cast</span><span class=\"token generic class-name\"><span class=\"token operator\">&lt;</span>Node<span class=\"token double-colon punctuation\">::</span>Use<span class=\"token operator\">*</span><span class=\"token operator\">></span></span></span><span class=\"token punctuation\">(</span>current_<span class=\"token operator\">-></span>next<span class=\"token punctuation\">)</span> <span class=\"token operator\">:</span> <span class=\"token keyword\">nullptr</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span><span class=\"token punctuation\">}</span>\n<span class=\"token number\">626</span>   Node<span class=\"token double-colon punctuation\">::</span>Use<span class=\"token operator\">*</span> current_<span class=\"token punctuation\">;</span>\n<span class=\"token number\">627</span>   Node<span class=\"token double-colon punctuation\">::</span>Use<span class=\"token operator\">*</span> next_<span class=\"token punctuation\">;</span>\n<span class=\"token number\">628</span> <span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span>\n</code></pre>\n"}]},{"t":"list_item","d":4,"p":{"lines":[570,571]},"v":"Node::use_edges()","c":[{"t":"list_item","d":6,"p":{"lines":[571,572]},"v":"创建一个 Node::UseEdges 对象"},{"t":"list_item","d":6,"p":{"lines":[572,592]},"v":"<pre class=\"language-cpp\"><code class=\"language-cpp\"><span class=\"token comment\">// src/compiler/node.h:125</span>\n<span class=\"token number\">125</span>   UseEdges <span class=\"token function\">use_edges</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span> <span class=\"token keyword\">return</span> <span class=\"token function\">UseEdges</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">this</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span> <span class=\"token punctuation\">}</span>\n\n<span class=\"token number\">119</span>     <span class=\"token keyword\">explicit</span> <span class=\"token function\">UseEdges</span><span class=\"token punctuation\">(</span>Node<span class=\"token operator\">*</span> node<span class=\"token punctuation\">)</span> <span class=\"token operator\">:</span> <span class=\"token function\">node_</span><span class=\"token punctuation\">(</span>node<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span><span class=\"token punctuation\">}</span>\n<span class=\"token comment\">// ++++++++++++++++++++++++++++++++++++++++++++++++++++++</span>\n<span class=\"token comment\">// 遍历的时候会调用 Node::UseEdges::iterator 和 Node::UseEdges::operator*</span>\n<span class=\"token comment\">// b ../../src/compiler/graph-reducer.cc:262</span>\n<span class=\"token number\">261</span>   <span class=\"token keyword\">for</span> <span class=\"token punctuation\">(</span>Edge edge <span class=\"token operator\">:</span> node<span class=\"token operator\">-></span><span class=\"token function\">use_edges</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n<span class=\"token punctuation\">.</span><span class=\"token punctuation\">.</span><span class=\"token punctuation\">.</span>\n<span class=\"token punctuation\">(</span>gdb<span class=\"token punctuation\">)</span> p edge\n$<span class=\"token number\">6</span> <span class=\"token operator\">=</span> <span class=\"token punctuation\">{</span>use_ <span class=\"token operator\">=</span> <span class=\"token number\">0x5555557780f0</span><span class=\"token punctuation\">,</span> input_ptr_ <span class=\"token operator\">=</span> <span class=\"token number\">0x555555778188</span><span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">(</span>gdb<span class=\"token punctuation\">)</span> p<span class=\"token operator\">/</span>x node<span class=\"token operator\">-></span>first_use_\n$<span class=\"token number\">7</span> <span class=\"token operator\">=</span> <span class=\"token number\">0x5555557780f0</span>\n<span class=\"token punctuation\">(</span>gdb<span class=\"token punctuation\">)</span> p<span class=\"token operator\">/</span>x node<span class=\"token operator\">-></span>first_use_<span class=\"token operator\">-></span><span class=\"token function\">input_ptr</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n$<span class=\"token number\">8</span> <span class=\"token operator\">=</span> <span class=\"token number\">0x555555778188</span>\n<span class=\"token punctuation\">(</span>gdb<span class=\"token punctuation\">)</span> p node\n$<span class=\"token number\">70</span> <span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span>Node <span class=\"token operator\">*</span><span class=\"token punctuation\">)</span> <span class=\"token number\">0x555555777dd0</span>\n</code></pre>\n"}]}]},{"t":"heading","d":2,"p":{"lines":[592,593]},"v":"Edge","c":[{"t":"list_item","d":4,"p":{"lines":[593,594]},"v":"Edge 代表了连接两个 node 的线"},{"t":"list_item","d":4,"p":{"lines":[594,595]},"v":"Edge.from() 指向 Edge.to() 在 Turbolizer 图中表现为从下面的节点指向上面的节点"},{"t":"list_item","d":4,"p":{"lines":[595,596]},"v":"(Turbolizer 中 end 到 start 方向)"},{"t":"list_item","d":4,"p":{"lines":[596,597]},"v":"在 Node::UseEdges::iterator 中有创建","c":[{"t":"list_item","d":6,"p":{"lines":[597,601]},"v":"<pre class=\"language-cpp\"><code class=\"language-cpp\"><span class=\"token number\">605</span>   Edge <span class=\"token keyword\">operator</span><span class=\"token operator\">*</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token keyword\">const</span> <span class=\"token punctuation\">{</span> <span class=\"token keyword\">return</span> <span class=\"token function\">Edge</span><span class=\"token punctuation\">(</span>current_<span class=\"token punctuation\">,</span> current_<span class=\"token operator\">-></span><span class=\"token function\">input_ptr</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span> <span class=\"token punctuation\">}</span>\n</code></pre>\n"}]},{"t":"list_item","d":4,"p":{"lines":[601,655]},"v":"<pre class=\"language-cpp\"><code class=\"language-cpp\"><span class=\"token punctuation\">(</span>gdb<span class=\"token punctuation\">)</span> ptype Edge\ntype <span class=\"token operator\">=</span> <span class=\"token keyword\">class</span> <span class=\"token class-name\">Edge</span> <span class=\"token punctuation\">{</span>\n<span class=\"token keyword\">private</span><span class=\"token operator\">:</span>\n    Node<span class=\"token double-colon punctuation\">::</span>Use <span class=\"token operator\">*</span>use_<span class=\"token punctuation\">;</span>\n    ZoneNodePtr <span class=\"token operator\">*</span>input_ptr_<span class=\"token punctuation\">;</span>\n\n<span class=\"token keyword\">public</span><span class=\"token operator\">:</span>\n    Node <span class=\"token operator\">*</span> <span class=\"token function\">from</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">void</span><span class=\"token punctuation\">)</span> <span class=\"token keyword\">const</span><span class=\"token punctuation\">;</span>\n    Node <span class=\"token operator\">*</span> <span class=\"token function\">to</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">void</span><span class=\"token punctuation\">)</span> <span class=\"token keyword\">const</span><span class=\"token punctuation\">;</span>\n    <span class=\"token keyword\">int</span> <span class=\"token function\">index</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">void</span><span class=\"token punctuation\">)</span> <span class=\"token keyword\">const</span><span class=\"token punctuation\">;</span>\n    <span class=\"token keyword\">bool</span> <span class=\"token keyword\">operator</span><span class=\"token operator\">==</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">const</span> Edge <span class=\"token operator\">&amp;</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token keyword\">bool</span> <span class=\"token keyword\">operator</span><span class=\"token operator\">!=</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">const</span> Edge <span class=\"token operator\">&amp;</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token keyword\">void</span> <span class=\"token function\">UpdateTo</span><span class=\"token punctuation\">(</span>Node <span class=\"token operator\">*</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">private</span><span class=\"token operator\">:</span>\n    <span class=\"token function\">Edge</span><span class=\"token punctuation\">(</span>Node<span class=\"token double-colon punctuation\">::</span>Use <span class=\"token operator\">*</span><span class=\"token punctuation\">,</span> ZoneNodePtr <span class=\"token operator\">*</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span>\n\n<span class=\"token number\">449</span>   <span class=\"token function\">Edge</span><span class=\"token punctuation\">(</span>Node<span class=\"token double-colon punctuation\">::</span>Use<span class=\"token operator\">*</span> use<span class=\"token punctuation\">,</span> ZoneNodePtr<span class=\"token operator\">*</span> input_ptr<span class=\"token punctuation\">)</span>\n<span class=\"token number\">450</span>       <span class=\"token operator\">:</span> <span class=\"token function\">use_</span><span class=\"token punctuation\">(</span>use<span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span> <span class=\"token function\">input_ptr_</span><span class=\"token punctuation\">(</span>input_ptr<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n</code></pre>\n","c":[{"t":"list_item","d":6,"p":{"lines":[623,624]},"v":"Edge::from() &amp; Edge::to()","c":[{"t":"list_item","d":8,"p":{"lines":[624,632]},"v":"<pre class=\"language-cpp\"><code class=\"language-cpp\"><span class=\"token comment\">// 同 Node::Use::from 和 to</span>\n<span class=\"token comment\">// #0  Node::Use::from (this=0x7fffffffa838) at ../../src/compiler/node.h:197</span>\n<span class=\"token comment\">// #1  compiler::Edge::from (this=0x7fffffffa838) at ../../src/compiler/node.h:424</span>\n<span class=\"token number\">424</span>   Node<span class=\"token operator\">*</span> <span class=\"token function\">from</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token keyword\">const</span> <span class=\"token punctuation\">{</span> <span class=\"token keyword\">return</span> use_<span class=\"token operator\">-></span><span class=\"token function\">from</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span> <span class=\"token punctuation\">}</span>\n<span class=\"token number\">425</span>   Node<span class=\"token operator\">*</span> <span class=\"token function\">to</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token keyword\">const</span> <span class=\"token punctuation\">{</span> <span class=\"token keyword\">return</span> <span class=\"token operator\">*</span>input_ptr_<span class=\"token punctuation\">;</span> <span class=\"token punctuation\">}</span>\n</code></pre>\n"}]},{"t":"list_item","d":6,"p":{"lines":[632,633]},"v":"Edge::UpdateTo()","c":[{"t":"list_item","d":8,"p":{"lines":[633,634]},"v":"把use.input_ptr() 修改为 new_to"},{"t":"list_item","d":8,"p":{"lines":[634,635]},"v":"也就是把 use.from() 的输入节点修改成了 new_to"},{"t":"list_item","d":8,"p":{"lines":[635,655]},"v":"<pre class=\"language-cpp\"><code class=\"language-cpp\"><span class=\"token comment\">// src/compiler/node.h:435</span>\n<span class=\"token number\">422</span> <span class=\"token keyword\">class</span> <span class=\"token class-name\">Edge</span> <span class=\"token keyword\">final</span> <span class=\"token punctuation\">{</span>\n<span class=\"token number\">435</span>   <span class=\"token keyword\">void</span> <span class=\"token function\">UpdateTo</span><span class=\"token punctuation\">(</span>Node<span class=\"token operator\">*</span> new_to<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n<span class=\"token number\">436</span>     Node<span class=\"token operator\">*</span> old_to <span class=\"token operator\">=</span> <span class=\"token operator\">*</span>input_ptr_<span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">.</span><span class=\"token punctuation\">.</span><span class=\"token punctuation\">.</span>\n<span class=\"token number\">438</span>       <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>old_to<span class=\"token punctuation\">)</span> old_to<span class=\"token operator\">-></span><span class=\"token function\">RemoveUse</span><span class=\"token punctuation\">(</span>use_<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token number\">439</span>       <span class=\"token operator\">*</span>input_ptr_ <span class=\"token operator\">=</span> new_to<span class=\"token punctuation\">;</span>\n<span class=\"token number\">440</span>       <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>new_to<span class=\"token punctuation\">)</span> new_to<span class=\"token operator\">-></span><span class=\"token function\">AppendUse</span><span class=\"token punctuation\">(</span>use_<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">.</span><span class=\"token punctuation\">.</span><span class=\"token punctuation\">.</span>\n<span class=\"token number\">442</span>   <span class=\"token punctuation\">}</span>\n\n<span class=\"token comment\">// #1  Edge::UpdateTo (...) at ../../src/compiler/node.h:438</span>\n<span class=\"token comment\">// #2  GraphReducer::ReplaceWithValue (...) at ../../src/compiler/graph-reducer.cc:273</span>\n<span class=\"token punctuation\">(</span>gdb<span class=\"token punctuation\">)</span> <span class=\"token function\">p</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span>Node <span class=\"token operator\">*</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">(</span><span class=\"token operator\">*</span>input_ptr_<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token operator\">-></span>first_use_\n$<span class=\"token number\">39</span> <span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span>Node<span class=\"token double-colon punctuation\">::</span>ZoneUsePtr<span class=\"token punctuation\">)</span> <span class=\"token number\">0x5555557780f0</span>\n<span class=\"token punctuation\">(</span>gdb<span class=\"token punctuation\">)</span> p use_\n$<span class=\"token number\">40</span> <span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span>Node<span class=\"token double-colon punctuation\">::</span>Use <span class=\"token operator\">*</span><span class=\"token punctuation\">)</span> <span class=\"token number\">0x5555557780f0</span>\n</code></pre>\n"}]}]}]},{"t":"heading","d":2,"p":{"lines":[655,656]},"v":"Node::InputEdges","c":[{"t":"list_item","d":4,"p":{"lines":[656,682]},"v":"<pre class=\"language-cpp\"><code class=\"language-cpp\"><span class=\"token comment\">// src/compiler/node.h</span>\n<span class=\"token comment\">// inputs 数组的迭代器</span>\n<span class=\"token number\">376</span> <span class=\"token keyword\">class</span> <span class=\"token class-name\">Node</span><span class=\"token operator\">:</span><span class=\"token base-clause\"><span class=\"token operator\">:</span><span class=\"token class-name\">InputEdges</span> <span class=\"token keyword\">final</span></span> <span class=\"token punctuation\">{</span>\n<span class=\"token number\">377</span>  <span class=\"token keyword\">public</span><span class=\"token operator\">:</span>\n<span class=\"token number\">378</span>   <span class=\"token keyword\">using</span> value_type <span class=\"token operator\">=</span> Edge<span class=\"token punctuation\">;</span>\n<span class=\"token number\">379</span>\n<span class=\"token number\">380</span>   <span class=\"token keyword\">class</span> <span class=\"token class-name\">iterator</span><span class=\"token punctuation\">;</span>\n<span class=\"token number\">381</span>   <span class=\"token keyword\">inline</span> iterator <span class=\"token function\">begin</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token keyword\">const</span><span class=\"token punctuation\">;</span>\n<span class=\"token number\">382</span>   <span class=\"token keyword\">inline</span> iterator <span class=\"token function\">end</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token keyword\">const</span><span class=\"token punctuation\">;</span>\n<span class=\"token number\">383</span>\n<span class=\"token number\">384</span>   <span class=\"token keyword\">bool</span> <span class=\"token function\">empty</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token keyword\">const</span> <span class=\"token punctuation\">{</span> <span class=\"token keyword\">return</span> count_ <span class=\"token operator\">==</span> <span class=\"token number\">0</span><span class=\"token punctuation\">;</span> <span class=\"token punctuation\">}</span>\n<span class=\"token number\">385</span>   <span class=\"token keyword\">int</span> <span class=\"token function\">count</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token keyword\">const</span> <span class=\"token punctuation\">{</span> <span class=\"token keyword\">return</span> count_<span class=\"token punctuation\">;</span> <span class=\"token punctuation\">}</span>\n<span class=\"token number\">386</span>\n<span class=\"token number\">387</span>   <span class=\"token keyword\">inline</span> value_type <span class=\"token keyword\">operator</span><span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">int</span> index<span class=\"token punctuation\">)</span> <span class=\"token keyword\">const</span><span class=\"token punctuation\">;</span>\n<span class=\"token number\">388</span>\n<span class=\"token number\">389</span>   <span class=\"token function\">InputEdges</span><span class=\"token punctuation\">(</span>ZoneNodePtr<span class=\"token operator\">*</span> input_root<span class=\"token punctuation\">,</span> Use<span class=\"token operator\">*</span> use_root<span class=\"token punctuation\">,</span> <span class=\"token keyword\">int</span> count<span class=\"token punctuation\">)</span>\n<span class=\"token number\">390</span>       <span class=\"token operator\">:</span> <span class=\"token function\">input_root_</span><span class=\"token punctuation\">(</span>input_root<span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span> <span class=\"token function\">use_root_</span><span class=\"token punctuation\">(</span>use_root<span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span> <span class=\"token function\">count_</span><span class=\"token punctuation\">(</span>count<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span><span class=\"token punctuation\">}</span>\n<span class=\"token number\">391</span>\n<span class=\"token number\">392</span>  <span class=\"token keyword\">private</span><span class=\"token operator\">:</span>\n<span class=\"token number\">393</span>   ZoneNodePtr<span class=\"token operator\">*</span> input_root_<span class=\"token punctuation\">;</span>\n<span class=\"token number\">394</span>   Use<span class=\"token operator\">*</span> use_root_<span class=\"token punctuation\">;</span>\n<span class=\"token number\">395</span>   <span class=\"token keyword\">int</span> count_<span class=\"token punctuation\">;</span>\n<span class=\"token number\">396</span> <span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span>\n</code></pre>\n"}]},{"t":"heading","d":2,"p":{"lines":[682,683]},"v":"ZoneNodePtr","c":[{"t":"list_item","d":4,"p":{"lines":[683,684]},"v":"相当于 typedef Node * ZoneNodePtr"},{"t":"list_item","d":4,"p":{"lines":[684,702]},"v":"<pre class=\"language-cpp\"><code class=\"language-cpp\"><span class=\"token punctuation\">(</span>gdb<span class=\"token punctuation\">)</span> p edge<span class=\"token punctuation\">.</span>input_ptr_\n$<span class=\"token number\">12</span> <span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span>ZoneNodePtr <span class=\"token operator\">*</span><span class=\"token punctuation\">)</span> <span class=\"token number\">0x555555778188</span>\n<span class=\"token punctuation\">(</span>gdb<span class=\"token punctuation\">)</span> p node\n$<span class=\"token number\">13</span> <span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span>Node <span class=\"token operator\">*</span><span class=\"token punctuation\">)</span> <span class=\"token number\">0x555555777dd0</span>\n<span class=\"token punctuation\">(</span>gdb<span class=\"token punctuation\">)</span> p <span class=\"token operator\">*</span><span class=\"token punctuation\">(</span>edge<span class=\"token punctuation\">.</span>input_ptr_<span class=\"token punctuation\">)</span>\n$<span class=\"token number\">14</span> <span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span>ZoneNodePtr<span class=\"token punctuation\">)</span> <span class=\"token number\">0x555555777dd0</span>\n<span class=\"token comment\">// 这里 ZoneNodePtr 等同于 Node *</span>\n\n<span class=\"token comment\">// +++++++++++++++++++++++++++++++++++++++++++++++++++</span>\n<span class=\"token punctuation\">(</span>gdb<span class=\"token punctuation\">)</span> ptype Node<span class=\"token double-colon punctuation\">::</span>ZoneUsePtr\ntype <span class=\"token operator\">=</span> <span class=\"token keyword\">struct</span> <span class=\"token class-name\">Node</span><span class=\"token double-colon punctuation\">::</span><span class=\"token function\">Use</span>\n\n<span class=\"token punctuation\">(</span>gdb<span class=\"token punctuation\">)</span> ptype ZoneNodePtr\ntype <span class=\"token operator\">=</span> <span class=\"token keyword\">class</span> <span class=\"token class-name\">Node</span> \n<span class=\"token comment\">// +++++++++++++++++++++++++++++++++++++++++++++++++++</span>\n</code></pre>\n"},{"t":"list_item","d":4,"p":{"lines":[702,721]},"v":"<pre class=\"language-cpp\"><code class=\"language-cpp\"><span class=\"token comment\">// CompressedZonePtr(Node *node)</span>\n<span class=\"token number\">23</span> <span class=\"token keyword\">using</span> ZoneNodePtr <span class=\"token operator\">=</span> GraphZoneTraits<span class=\"token double-colon punctuation\">::</span>Ptr<span class=\"token operator\">&lt;</span>Node<span class=\"token operator\">></span><span class=\"token punctuation\">;</span>\n\n<span class=\"token number\">19</span> <span class=\"token keyword\">using</span> GraphZoneTraits <span class=\"token operator\">=</span> ZoneTypeTraits<span class=\"token operator\">&lt;</span>kCompressGraphZone<span class=\"token operator\">></span><span class=\"token punctuation\">;</span>\n\n<span class=\"token number\">52</span> <span class=\"token keyword\">template</span> <span class=\"token operator\">&lt;</span><span class=\"token operator\">></span>\n<span class=\"token number\">53</span> <span class=\"token keyword\">struct</span> <span class=\"token class-name\">ZoneTypeTraits</span><span class=\"token operator\">&lt;</span><span class=\"token boolean\">true</span><span class=\"token operator\">></span> <span class=\"token punctuation\">{</span>\n<span class=\"token number\">54</span>   <span class=\"token keyword\">template</span> <span class=\"token operator\">&lt;</span><span class=\"token keyword\">typename</span> <span class=\"token class-name\">T</span><span class=\"token operator\">></span>\n<span class=\"token number\">55</span>   <span class=\"token keyword\">using</span> Ptr <span class=\"token operator\">=</span> CompressedZonePtr<span class=\"token operator\">&lt;</span>T<span class=\"token operator\">></span><span class=\"token punctuation\">;</span>\n<span class=\"token number\">56</span> <span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token number\">26</span> <span class=\"token comment\">// instead.</span>\n<span class=\"token number\">27</span> <span class=\"token keyword\">template</span> <span class=\"token operator\">&lt;</span><span class=\"token keyword\">typename</span> <span class=\"token class-name\">T</span><span class=\"token operator\">></span>\n<span class=\"token number\">28</span> <span class=\"token keyword\">class</span> <span class=\"token class-name\">CompressedZonePtr</span> <span class=\"token punctuation\">{</span>\n<span class=\"token number\">32</span>   <span class=\"token keyword\">explicit</span> <span class=\"token function\">CompressedZonePtr</span><span class=\"token punctuation\">(</span>T<span class=\"token operator\">*</span> value<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span> <span class=\"token operator\">*</span><span class=\"token keyword\">this</span> <span class=\"token operator\">=</span> value<span class=\"token punctuation\">;</span> <span class=\"token punctuation\">}</span>\n<span class=\"token number\">50</span>   <span class=\"token punctuation\">}</span>\n</code></pre>\n"}]},{"t":"heading","d":2,"p":{"lines":[721,722]},"v":"NodeProperties","c":[{"t":"list_item","d":4,"p":{"lines":[722,778]},"v":"<pre class=\"language-cpp\"><code class=\"language-cpp\"><span class=\"token comment\">// src/compiler/node-properties.h</span>\n<span class=\"token number\">25</span> <span class=\"token keyword\">class</span> <span class=\"token class-name\">V8_EXPORT_PRIVATE</span> NodeProperties <span class=\"token punctuation\">{</span>\n<span class=\"token number\">26</span>  <span class=\"token keyword\">public</span><span class=\"token operator\">:</span>\n<span class=\"token number\">27</span>   <span class=\"token comment\">// ---------------------------------------------------------------------------</span>\n<span class=\"token number\">28</span>   <span class=\"token comment\">// Input layout.</span>\n<span class=\"token number\">29</span>   <span class=\"token comment\">// Inputs are always arranged in order as follows:</span>\n<span class=\"token number\">30</span>   <span class=\"token comment\">//     0 [ values, context, frame state, effects, control ] node->InputCount()</span>\n    <span class=\"token comment\">// 这段注释的意思是，一个 node 有 values, context, frame state, effects, control 这些种类的 Input</span>\n    <span class=\"token comment\">// 它们的总共有 node->InputCount() 个</span>\n    <span class=\"token comment\">// values effects control 的数量都是在 node->op() 实例化的时候定义的(见 Operator.md)</span>\n    <span class=\"token comment\">// context 和 frame state 只有 1 和 0 ，部分 operator 才有</span>\n<span class=\"token number\">31</span>\n<span class=\"token number\">32</span>   <span class=\"token keyword\">static</span> <span class=\"token keyword\">int</span> <span class=\"token function\">FirstValueIndex</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">const</span> Node<span class=\"token operator\">*</span> node<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span> <span class=\"token keyword\">return</span> <span class=\"token number\">0</span><span class=\"token punctuation\">;</span> <span class=\"token punctuation\">}</span>\n<span class=\"token number\">33</span>   <span class=\"token keyword\">static</span> <span class=\"token keyword\">int</span> <span class=\"token function\">FirstContextIndex</span><span class=\"token punctuation\">(</span>Node<span class=\"token operator\">*</span> node<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span> <span class=\"token keyword\">return</span> <span class=\"token function\">PastValueIndex</span><span class=\"token punctuation\">(</span>node<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span> <span class=\"token punctuation\">}</span>\n<span class=\"token number\">34</span>   <span class=\"token keyword\">static</span> <span class=\"token keyword\">int</span> <span class=\"token function\">FirstFrameStateIndex</span><span class=\"token punctuation\">(</span>Node<span class=\"token operator\">*</span> node<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span> <span class=\"token keyword\">return</span> <span class=\"token function\">PastContextIndex</span><span class=\"token punctuation\">(</span>node<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span> <span class=\"token punctuation\">}</span>\n<span class=\"token number\">35</span>   <span class=\"token keyword\">static</span> <span class=\"token keyword\">int</span> <span class=\"token function\">FirstEffectIndex</span><span class=\"token punctuation\">(</span>Node<span class=\"token operator\">*</span> node<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span> <span class=\"token keyword\">return</span> <span class=\"token function\">PastFrameStateIndex</span><span class=\"token punctuation\">(</span>node<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span> <span class=\"token punctuation\">}</span>\n<span class=\"token number\">36</span>   <span class=\"token keyword\">static</span> <span class=\"token keyword\">int</span> <span class=\"token function\">FirstControlIndex</span><span class=\"token punctuation\">(</span>Node<span class=\"token operator\">*</span> node<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span> <span class=\"token keyword\">return</span> <span class=\"token function\">PastEffectIndex</span><span class=\"token punctuation\">(</span>node<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span> <span class=\"token punctuation\">}</span>\n<span class=\"token number\">37</span>\n<span class=\"token number\">38</span>   <span class=\"token keyword\">static</span> <span class=\"token keyword\">int</span> <span class=\"token function\">PastValueIndex</span><span class=\"token punctuation\">(</span>Node<span class=\"token operator\">*</span> node<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n<span class=\"token number\">39</span>     <span class=\"token keyword\">return</span> <span class=\"token function\">FirstValueIndex</span><span class=\"token punctuation\">(</span>node<span class=\"token punctuation\">)</span> <span class=\"token operator\">+</span> node<span class=\"token operator\">-></span><span class=\"token function\">op</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token operator\">-></span><span class=\"token function\">ValueInputCount</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token number\">40</span>   <span class=\"token punctuation\">}</span>\n<span class=\"token number\">41</span>\n<span class=\"token number\">42</span>   <span class=\"token keyword\">static</span> <span class=\"token keyword\">int</span> <span class=\"token function\">PastContextIndex</span><span class=\"token punctuation\">(</span>Node<span class=\"token operator\">*</span> node<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n<span class=\"token number\">43</span>     <span class=\"token keyword\">return</span> <span class=\"token function\">FirstContextIndex</span><span class=\"token punctuation\">(</span>node<span class=\"token punctuation\">)</span> <span class=\"token operator\">+</span>\n<span class=\"token number\">44</span>            <span class=\"token class-name\">OperatorProperties</span><span class=\"token double-colon punctuation\">::</span><span class=\"token function\">GetContextInputCount</span><span class=\"token punctuation\">(</span>node<span class=\"token operator\">-></span><span class=\"token function\">op</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token number\">45</span>   <span class=\"token punctuation\">}</span>\n<span class=\"token number\">46</span>\n<span class=\"token number\">47</span>   <span class=\"token keyword\">static</span> <span class=\"token keyword\">int</span> <span class=\"token function\">PastFrameStateIndex</span><span class=\"token punctuation\">(</span>Node<span class=\"token operator\">*</span> node<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n<span class=\"token number\">48</span>     <span class=\"token keyword\">return</span> <span class=\"token function\">FirstFrameStateIndex</span><span class=\"token punctuation\">(</span>node<span class=\"token punctuation\">)</span> <span class=\"token operator\">+</span>\n<span class=\"token number\">49</span>            <span class=\"token class-name\">OperatorProperties</span><span class=\"token double-colon punctuation\">::</span><span class=\"token function\">GetFrameStateInputCount</span><span class=\"token punctuation\">(</span>node<span class=\"token operator\">-></span><span class=\"token function\">op</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token number\">50</span>   <span class=\"token punctuation\">}</span>\n<span class=\"token number\">51</span>\n<span class=\"token number\">52</span>   <span class=\"token keyword\">static</span> <span class=\"token keyword\">int</span> <span class=\"token function\">PastEffectIndex</span><span class=\"token punctuation\">(</span>Node<span class=\"token operator\">*</span> node<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n<span class=\"token number\">53</span>     <span class=\"token keyword\">return</span> <span class=\"token function\">FirstEffectIndex</span><span class=\"token punctuation\">(</span>node<span class=\"token punctuation\">)</span> <span class=\"token operator\">+</span> node<span class=\"token operator\">-></span><span class=\"token function\">op</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token operator\">-></span><span class=\"token function\">EffectInputCount</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token number\">54</span>   <span class=\"token punctuation\">}</span>\n<span class=\"token number\">55</span>\n<span class=\"token number\">56</span>   <span class=\"token keyword\">static</span> <span class=\"token keyword\">int</span> <span class=\"token function\">PastControlIndex</span><span class=\"token punctuation\">(</span>Node<span class=\"token operator\">*</span> node<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n<span class=\"token number\">57</span>     <span class=\"token keyword\">return</span> <span class=\"token function\">FirstControlIndex</span><span class=\"token punctuation\">(</span>node<span class=\"token punctuation\">)</span> <span class=\"token operator\">+</span> node<span class=\"token operator\">-></span><span class=\"token function\">op</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token operator\">-></span><span class=\"token function\">ControlInputCount</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token number\">58</span>   <span class=\"token punctuation\">}</span>\n\n<span class=\"token number\">60</span>   <span class=\"token comment\">// ---------------------------------------------------------------------------</span>\n<span class=\"token number\">61</span>   <span class=\"token comment\">// Input accessors.</span>\n<span class=\"token number\">62</span>\n<span class=\"token number\">63</span>   <span class=\"token keyword\">static</span> Node<span class=\"token operator\">*</span> <span class=\"token function\">GetValueInput</span><span class=\"token punctuation\">(</span>Node<span class=\"token operator\">*</span> node<span class=\"token punctuation\">,</span> <span class=\"token keyword\">int</span> index<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n<span class=\"token punctuation\">.</span><span class=\"token punctuation\">.</span><span class=\"token punctuation\">.</span>\n<span class=\"token number\">66</span>     <span class=\"token keyword\">return</span> node<span class=\"token operator\">-></span><span class=\"token function\">InputAt</span><span class=\"token punctuation\">(</span><span class=\"token function\">FirstValueIndex</span><span class=\"token punctuation\">(</span>node<span class=\"token punctuation\">)</span> <span class=\"token operator\">+</span> index<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token number\">67</span>   <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">.</span><span class=\"token punctuation\">.</span><span class=\"token punctuation\">.</span>\n<span class=\"token number\">75</span>   <span class=\"token keyword\">static</span> Node<span class=\"token operator\">*</span> <span class=\"token function\">GetContextInput</span><span class=\"token punctuation\">(</span>Node<span class=\"token operator\">*</span> node<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n<span class=\"token punctuation\">.</span><span class=\"token punctuation\">.</span><span class=\"token punctuation\">.</span>\n<span class=\"token number\">77</span>     <span class=\"token keyword\">return</span> node<span class=\"token operator\">-></span><span class=\"token function\">InputAt</span><span class=\"token punctuation\">(</span><span class=\"token function\">FirstContextIndex</span><span class=\"token punctuation\">(</span>node<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token number\">78</span>   <span class=\"token punctuation\">}</span>\n\n</code></pre>\n"}]},{"t":"heading","d":2,"p":{"lines":[778,779]},"v":"NodeWrapper","c":[{"t":"list_item","d":4,"p":{"lines":[779,828]},"v":"<pre class=\"language-cpp\"><code class=\"language-cpp\"><span class=\"token number\">319</span> <span class=\"token keyword\">class</span> <span class=\"token class-name\">NodeWrapper</span> <span class=\"token punctuation\">{</span>\n<span class=\"token number\">320</span>  <span class=\"token keyword\">public</span><span class=\"token operator\">:</span>\n<span class=\"token number\">321</span>   <span class=\"token keyword\">explicit</span> <span class=\"token keyword\">constexpr</span> <span class=\"token function\">NodeWrapper</span><span class=\"token punctuation\">(</span>Node<span class=\"token operator\">*</span> node<span class=\"token punctuation\">)</span> <span class=\"token operator\">:</span> <span class=\"token function\">node_</span><span class=\"token punctuation\">(</span>node<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span><span class=\"token punctuation\">}</span>\n<span class=\"token number\">322</span>   <span class=\"token keyword\">operator</span> Node<span class=\"token operator\">*</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token keyword\">const</span> <span class=\"token punctuation\">{</span> <span class=\"token keyword\">return</span> node_<span class=\"token punctuation\">;</span> <span class=\"token punctuation\">}</span>\n<span class=\"token number\">323</span>   Node<span class=\"token operator\">*</span> <span class=\"token keyword\">operator</span><span class=\"token operator\">-></span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token keyword\">const</span> <span class=\"token punctuation\">{</span> <span class=\"token keyword\">return</span> node_<span class=\"token punctuation\">;</span> <span class=\"token punctuation\">}</span>\n<span class=\"token number\">324</span>\n<span class=\"token number\">325</span>  <span class=\"token keyword\">protected</span><span class=\"token operator\">:</span>\n<span class=\"token number\">326</span>   Node<span class=\"token operator\">*</span> <span class=\"token function\">node</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token keyword\">const</span> <span class=\"token punctuation\">{</span> <span class=\"token keyword\">return</span> node_<span class=\"token punctuation\">;</span> <span class=\"token punctuation\">}</span>\n<span class=\"token number\">327</span>   <span class=\"token keyword\">void</span> <span class=\"token function\">set_node</span><span class=\"token punctuation\">(</span>Node<span class=\"token operator\">*</span> node<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n<span class=\"token number\">328</span>     <span class=\"token function\">DCHECK_NOT_NULL</span><span class=\"token punctuation\">(</span>node<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token number\">329</span>     node_ <span class=\"token operator\">=</span> node<span class=\"token punctuation\">;</span>\n<span class=\"token number\">330</span>   <span class=\"token punctuation\">}</span>\n<span class=\"token number\">331</span>\n<span class=\"token number\">332</span>  <span class=\"token keyword\">private</span><span class=\"token operator\">:</span>\n<span class=\"token number\">333</span>   Node<span class=\"token operator\">*</span> node_<span class=\"token punctuation\">;</span>\n<span class=\"token number\">334</span> <span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token number\">336</span> <span class=\"token comment\">// Wrapper classes for special node/edge types (effect, control, frame states).</span>\n<span class=\"token number\">337</span>\n<span class=\"token number\">338</span> <span class=\"token keyword\">class</span> <span class=\"token class-name\">Effect</span> <span class=\"token operator\">:</span> <span class=\"token base-clause\"><span class=\"token keyword\">public</span> <span class=\"token class-name\">NodeWrapper</span></span> <span class=\"token punctuation\">{</span>\n<span class=\"token number\">339</span>  <span class=\"token keyword\">public</span><span class=\"token operator\">:</span>\n<span class=\"token number\">340</span>   <span class=\"token keyword\">explicit</span> <span class=\"token keyword\">constexpr</span> <span class=\"token function\">Effect</span><span class=\"token punctuation\">(</span>Node<span class=\"token operator\">*</span> node<span class=\"token punctuation\">)</span> <span class=\"token operator\">:</span> <span class=\"token function\">NodeWrapper</span><span class=\"token punctuation\">(</span>node<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n<span class=\"token punctuation\">.</span><span class=\"token punctuation\">.</span><span class=\"token punctuation\">.</span>\n<span class=\"token number\">344</span>   <span class=\"token punctuation\">}</span>\n<span class=\"token number\">345</span>\n<span class=\"token number\">346</span>   <span class=\"token comment\">// Support the common `Node* x = effect = ...` pattern.</span>\n<span class=\"token number\">347</span>   Node<span class=\"token operator\">*</span> <span class=\"token keyword\">operator</span><span class=\"token operator\">=</span><span class=\"token punctuation\">(</span>Node<span class=\"token operator\">*</span> value<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n<span class=\"token punctuation\">.</span><span class=\"token punctuation\">.</span><span class=\"token punctuation\">.</span>\n<span class=\"token number\">349</span>     <span class=\"token function\">set_node</span><span class=\"token punctuation\">(</span>value<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token number\">350</span>     <span class=\"token keyword\">return</span> value<span class=\"token punctuation\">;</span>\n<span class=\"token number\">351</span>   <span class=\"token punctuation\">}</span>\n<span class=\"token number\">352</span> <span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span>\n<span class=\"token number\">353</span>\n<span class=\"token number\">354</span> <span class=\"token keyword\">class</span> <span class=\"token class-name\">Control</span> <span class=\"token operator\">:</span> <span class=\"token base-clause\"><span class=\"token keyword\">public</span> <span class=\"token class-name\">NodeWrapper</span></span> <span class=\"token punctuation\">{</span>\n<span class=\"token number\">355</span>  <span class=\"token keyword\">public</span><span class=\"token operator\">:</span>\n<span class=\"token number\">356</span>   <span class=\"token keyword\">explicit</span> <span class=\"token keyword\">constexpr</span> <span class=\"token function\">Control</span><span class=\"token punctuation\">(</span>Node<span class=\"token operator\">*</span> node<span class=\"token punctuation\">)</span> <span class=\"token operator\">:</span> <span class=\"token function\">NodeWrapper</span><span class=\"token punctuation\">(</span>node<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n<span class=\"token punctuation\">.</span><span class=\"token punctuation\">.</span><span class=\"token punctuation\">.</span>\n<span class=\"token number\">360</span>   <span class=\"token punctuation\">}</span>\n<span class=\"token number\">361</span>\n<span class=\"token number\">362</span>   <span class=\"token comment\">// Support the common `Node* x = control = ...` pattern.</span>\n<span class=\"token number\">363</span>   Node<span class=\"token operator\">*</span> <span class=\"token keyword\">operator</span><span class=\"token operator\">=</span><span class=\"token punctuation\">(</span>Node<span class=\"token operator\">*</span> value<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n<span class=\"token punctuation\">.</span><span class=\"token punctuation\">.</span><span class=\"token punctuation\">.</span>\n<span class=\"token number\">365</span>     <span class=\"token function\">set_node</span><span class=\"token punctuation\">(</span>value<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token number\">366</span>     <span class=\"token keyword\">return</span> value<span class=\"token punctuation\">;</span>\n<span class=\"token number\">367</span>   <span class=\"token punctuation\">}</span>\n<span class=\"token number\">368</span> <span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span>\n</code></pre>\n"}]}]})</script>
</body>
</html>
