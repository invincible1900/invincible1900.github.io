<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta http-equiv="X-UA-Compatible" content="ie=edge">
<title>Markmap</title>
<style>
* {
  margin: 0;
  padding: 0;
}
#mindmap {
  display: block;
  width: 100vw;
  height: 100vh;
}
</style>
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/prismjs@1.25.0/themes/prism.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/markmap-toolbar@0.2.0/dist/style.css">
</head>
<body>
<svg id="mindmap"></svg>
<script src="https://cdn.jsdelivr.net/npm/d3@6.7.0"></script><script src="https://cdn.jsdelivr.net/npm/markmap-view@0.2.7"></script><script src="https://cdn.jsdelivr.net/npm/markmap-toolbar@0.2.0/dist/index.umd.min.js"></script><script>(r => {
                setTimeout(r);
              })(() => {
  const {
    markmap,
    mm
  } = window;
  const toolbar = new markmap.Toolbar();
  toolbar.attach(mm);
  const el = toolbar.render();
  el.setAttribute('style', 'position:absolute;bottom:20px;right:20px');
  document.body.append(el);
})</script><script>((getMarkmap, getOptions, data) => {
        const {
          Markmap
        } = getMarkmap();
        window.mm = Markmap.create('svg#mindmap', getOptions == null ? void 0 : getOptions(), data);
      })(() => window.markmap,null,{"t":"heading","d":1,"p":{"lines":[0,1]},"v":"case study","c":[{"t":"heading","d":2,"p":{"lines":[1,2]},"v":"case code","c":[{"t":"list_item","d":4,"p":{"lines":[2,30]},"v":"<pre class=\"language-sql\"><code class=\"language-sql\"><span class=\"token keyword\">import</span> cpp\n<span class=\"token keyword\">import</span> Chrome<span class=\"token punctuation\">.</span>common\n<span class=\"token keyword\">import</span> semmle<span class=\"token punctuation\">.</span>code<span class=\"token punctuation\">.</span>cpp<span class=\"token punctuation\">.</span>dataflow<span class=\"token punctuation\">.</span>DataFlow\n\n<span class=\"token keyword\">from</span> Field key_map<span class=\"token punctuation\">,</span> ManagedMapField map_field<span class=\"token punctuation\">,</span> \n    <span class=\"token keyword\">Function</span> reset_func<span class=\"token punctuation\">,</span> <span class=\"token comment\">// Function ext_func,</span>\n    Variable member_V<span class=\"token punctuation\">,</span> VariableAccess ex<span class=\"token punctuation\">,</span>\n    <span class=\"token keyword\">Function</span> member_f1<span class=\"token punctuation\">,</span>\n    FunctionCall fc\n\n<span class=\"token keyword\">where</span> key_map<span class=\"token punctuation\">.</span>getType<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span>stripType<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> instanceof ManagedMapType\n<span class=\"token operator\">and</span> key_map<span class=\"token punctuation\">.</span>getType<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span>stripType<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token punctuation\">(</span>ManagedMapType<span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span>getManagedType<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=</span> \n        map_field<span class=\"token punctuation\">.</span>getManagedType<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n<span class=\"token operator\">and</span> reset_func <span class=\"token operator\">=</span> map_field<span class=\"token punctuation\">.</span>getAManagedReset<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span>getEnclosingFunction<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n<span class=\"token comment\">// and  reach*(ext_func, reset_func) </span>\n<span class=\"token operator\">and</span> member_f1<span class=\"token punctuation\">.</span>getDeclaringType<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=</span> map_field<span class=\"token punctuation\">.</span>getManagedType<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n<span class=\"token operator\">and</span> fc<span class=\"token punctuation\">.</span>getTarget<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=</span> reset_func\n<span class=\"token operator\">and</span> fc<span class=\"token punctuation\">.</span>getEnclosingFunction<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=</span> member_f1\n<span class=\"token operator\">and</span> <span class=\"token punctuation\">(</span>member_V<span class=\"token punctuation\">.</span>getAnAccess<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=</span> ex <span class=\"token operator\">and</span> \n        ex<span class=\"token punctuation\">.</span>getEnclosingFunction<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=</span> member_f1<span class=\"token punctuation\">)</span>\n<span class=\"token operator\">or</span> <span class=\"token punctuation\">(</span>member_fc<span class=\"token punctuation\">.</span>getTarget<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=</span> member_f2 <span class=\"token operator\">and</span> \n        member_fc<span class=\"token punctuation\">.</span>getEnclosingFunction<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=</span> member_f1<span class=\"token punctuation\">)</span>\n<span class=\"token punctuation\">.</span><span class=\"token punctuation\">.</span><span class=\"token punctuation\">.</span>\n\n<span class=\"token keyword\">select</span> member_V\n</code></pre>\n"}]},{"t":"heading","d":2,"p":{"lines":[30,31]},"v":"C++ Library","c":[{"t":"list_item","d":4,"p":{"lines":[31,32]},"v":"Declaration classes","c":[{"t":"list_item","d":6,"p":{"lines":[32,33]},"v":"class Function","c":[{"t":"list_item","d":8,"p":{"lines":[33,34]},"v":"getType() stripType()","c":[{"t":"list_item","d":10,"p":{"lines":[34,35]},"v":"Member predicate <a href=\"https://codeql.github.com/codeql-standard-libraries/cpp/semmle/code/cpp/Function.qll/type.Function$Function.html\">Function</a>::<a href=\"https://codeql.github.com/codeql-standard-libraries/cpp/semmle/code/cpp/Function.qll/predicate.Function$Function$getType.0.html\">getType</a>: Gets the return type of this function."},{"t":"list_item","d":10,"p":{"lines":[35,36]},"v":"Predicate stripType: Gets the type stripped of pointers, references and cv-qualifiers, and resolving typedefs."},{"t":"list_item","d":10,"p":{"lines":[36,37]},"v":"<code>.//ql/lib/semmle/code/cpp/Function.qll</code>"},{"t":"list_item","d":10,"p":{"lines":[37,79]},"v":"<pre class=\"language-sql\"><code class=\"language-sql\"><span class=\"token keyword\">import</span> cpp\n\n<span class=\"token keyword\">from</span> FunctionCall fc<span class=\"token punctuation\">,</span> <span class=\"token keyword\">Type</span> t\n<span class=\"token keyword\">where</span> fc<span class=\"token punctuation\">.</span>getTarget<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span>getName<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span>matches<span class=\"token punctuation\">(</span><span class=\"token string\">\"my_func%\"</span><span class=\"token punctuation\">)</span>\n    <span class=\"token operator\">and</span> t <span class=\"token operator\">=</span> fc<span class=\"token punctuation\">.</span>getType<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span>stripType<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n<span class=\"token keyword\">select</span> fc<span class=\"token punctuation\">,</span> fc<span class=\"token punctuation\">.</span>getType<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span> t\n\n\n<span class=\"token comment\">/*\n┌──────────────────┬──────────────┬──────────────┐\n│        fc        │     ---      │      t       │\n├──────────────────┼──────────────┼──────────────┤\n│ call to my_func1 │    my_u32    │ unsigned int │\n│     3.cpp:12     │   3.cpp:4    │      :0      │\n├──────────────────┼──────────────┼──────────────┤\n│ call to my_func2 │     long     │     long     │\n│     3.cpp:13     │      :0      │      :0      │\n├──────────────────┼──────────────┼──────────────┤\n│ call to my_func3 │    char *    │     char     │\n│     3.cpp:14     │      :0      │      :0      │\n├──────────────────┼──────────────┼──────────────┤\n│ call to my_func4 │ const char * │     char     │\n│     3.cpp:15     │      :0      │      :0      │\n└──────────────────┴──────────────┴──────────────┘\n\ntypedef unsigned int my_u32;\n\nmy_u32 my_func1(){return 0;}\nlong my_func2(){return 0xfffff;}\nchar *my_func3(){return (char *)malloc(100);}\nconst char *my_func4(){return \"Hello\";}\n\nint main(){\n        my_func1();\n        my_func2();\n        my_func3();\n        my_func4();\n}\n*/</span>\n</code></pre>\n"}]},{"t":"list_item","d":8,"p":{"lines":[79,80]},"v":"getDeclaringType()","c":[{"t":"list_item","d":10,"p":{"lines":[80,131]},"v":"<pre class=\"language-sql\"><code class=\"language-sql\"><span class=\"token keyword\">from</span> FunctionCall fc<span class=\"token punctuation\">,</span> <span class=\"token keyword\">Function</span> target<span class=\"token punctuation\">,</span> <span class=\"token keyword\">Function</span> enf<span class=\"token punctuation\">,</span> Class dtype\n<span class=\"token keyword\">where</span> <span class=\"token punctuation\">(</span>fc<span class=\"token punctuation\">.</span>getTarget<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span>getName<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span>matches<span class=\"token punctuation\">(</span><span class=\"token string\">\"my_func%\"</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">or</span> <span class=\"token punctuation\">(</span>fc<span class=\"token punctuation\">.</span>getTarget<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span>getName<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=</span> <span class=\"token string\">\"erase\"</span><span class=\"token punctuation\">)</span>\n    <span class=\"token operator\">and</span> fc<span class=\"token punctuation\">.</span>getEnclosingFunction<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span>getName<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span>matches<span class=\"token punctuation\">(</span><span class=\"token string\">\"my_func%\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span>\n    <span class=\"token operator\">and</span> target <span class=\"token operator\">=</span> fc<span class=\"token punctuation\">.</span>getTarget<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n    <span class=\"token operator\">and</span> enf <span class=\"token operator\">=</span> fc<span class=\"token punctuation\">.</span>getEnclosingFunction<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n    <span class=\"token operator\">and</span> dtype <span class=\"token operator\">=</span> target<span class=\"token punctuation\">.</span>getDeclaringType<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n<span class=\"token keyword\">select</span> enf<span class=\"token punctuation\">,</span> fc<span class=\"token punctuation\">,</span> target<span class=\"token punctuation\">,</span> dtype\n\n<span class=\"token comment\">/*\nClass getDeclaringType() - Declaration \n返回值是 Class 类型, Declaration 类的 predicate\n──────────────────────────────────────────────────────────────────\nGets the class where this member is declared, if it is a member.\nFor templates, both the template itself and all instantiations of\nthe template are considered to have the same declaring class.、\n*/</span>\n\n┌──────────┬────────────────────┬────────────┬─────────────────────────────────────────────────────────────────────────┐\n│   enf    │         fc         │   target   │                                  dtype                                  │\n├──────────┼────────────────────┼────────────┼─────────────────────────────────────────────────────────────────────────┤\n│ my_func  │ <span class=\"token keyword\">call</span> <span class=\"token keyword\">to</span> my_func_hi │ my_func_hi │                                MyClassA                                 │\n│ <span class=\"token number\">3.</span>cpp:<span class=\"token number\">10</span> │      <span class=\"token number\">3.</span>cpp:<span class=\"token number\">13</span>      │  <span class=\"token number\">3.</span>cpp:<span class=\"token number\">7</span>   │                                 <span class=\"token number\">3.</span>cpp:<span class=\"token number\">5</span>                                 │\n├──────────┼────────────────────┼────────────┼─────────────────────────────────────────────────────────────────────────┤\n│ my_func  │   <span class=\"token keyword\">call</span> <span class=\"token keyword\">to</span> erase    │   erase    │ map<span class=\"token operator\">&lt;</span><span class=\"token keyword\">int</span><span class=\"token punctuation\">,</span> MyClassA <span class=\"token operator\">*</span><span class=\"token punctuation\">,</span> less<span class=\"token operator\">&lt;</span><span class=\"token keyword\">int</span><span class=\"token operator\">></span><span class=\"token punctuation\">,</span> allocator<span class=\"token operator\">&lt;</span>pair<span class=\"token operator\">&lt;</span>const <span class=\"token keyword\">int</span><span class=\"token punctuation\">,</span> MyClassA <span class=\"token operator\">*</span><span class=\"token operator\">>></span><span class=\"token operator\">></span> │\n│ <span class=\"token number\">3.</span>cpp:<span class=\"token number\">10</span> │      <span class=\"token number\">3.</span>cpp:<span class=\"token number\">14</span>      │  map:<span class=\"token number\">1305</span>  │                                 map:<span class=\"token number\">900</span>                                 │\n└──────────┴────────────────────┴────────────┴─────────────────────────────────────────────────────────────────────────┘\n\n<span class=\"token comment\">#include &lt;iostream></span>\n<span class=\"token comment\">#include &lt;map></span>\n<span class=\"token keyword\">using</span> namespace std<span class=\"token punctuation\">;</span>\n\nclass MyClassA{\n        <span class=\"token keyword\">public</span>:\n                void my_func_hi<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>{ cout <span class=\"token operator\">&lt;&lt;</span> <span class=\"token string\">\"Hi \"</span> <span class=\"token operator\">&lt;&lt;</span> this <span class=\"token operator\">&lt;&lt;</span> endl<span class=\"token punctuation\">;</span> }\n}<span class=\"token punctuation\">;</span>\n\nvoid my_func<span class=\"token punctuation\">(</span>MyClassA <span class=\"token operator\">*</span>a<span class=\"token punctuation\">)</span>{\n        map <span class=\"token operator\">&lt;</span><span class=\"token keyword\">int</span><span class=\"token punctuation\">,</span> MyClassA <span class=\"token operator\">*</span><span class=\"token operator\">></span> m<span class=\"token punctuation\">;</span>\n        m<span class=\"token punctuation\">[</span><span class=\"token number\">1</span><span class=\"token punctuation\">]</span> <span class=\"token operator\">=</span> a<span class=\"token punctuation\">;</span>\n        m<span class=\"token punctuation\">[</span><span class=\"token number\">1</span><span class=\"token punctuation\">]</span><span class=\"token operator\">-</span><span class=\"token operator\">></span>my_func_hi<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        m<span class=\"token punctuation\">.</span>erase<span class=\"token punctuation\">(</span><span class=\"token number\">1</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n}\n\n<span class=\"token keyword\">int</span> main<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>{\n        MyClassA a<span class=\"token punctuation\">;</span>\n        my_func<span class=\"token punctuation\">(</span><span class=\"token operator\">&amp;</span>a<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n}\n\n</code></pre>\n"}]}]},{"t":"list_item","d":6,"p":{"lines":[131,132]},"v":"class Variable","c":[{"t":"list_item","d":8,"p":{"lines":[132,133]},"v":"getAnAccess()","c":[{"t":"list_item","d":10,"p":{"lines":[133,177]},"v":"<pre class=\"language-sql\"><code class=\"language-sql\"><span class=\"token keyword\">import</span> cpp\n\n<span class=\"token keyword\">from</span> Variable v<span class=\"token punctuation\">,</span> VariableAccess va<span class=\"token punctuation\">,</span> <span class=\"token keyword\">Function</span> f\n<span class=\"token keyword\">where</span> f<span class=\"token punctuation\">.</span>getName<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=</span> <span class=\"token string\">\"my_func\"</span>\n<span class=\"token operator\">and</span> v<span class=\"token punctuation\">.</span>getAnAccess<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span>getEnclosingFunction<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=</span> f\n<span class=\"token operator\">and</span> v<span class=\"token punctuation\">.</span>getName<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span>matches<span class=\"token punctuation\">(</span><span class=\"token string\">\"v_map\"</span><span class=\"token punctuation\">)</span>\n<span class=\"token operator\">and</span> va <span class=\"token operator\">=</span> v<span class=\"token punctuation\">.</span>getAnAccess<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n<span class=\"token keyword\">select</span> v<span class=\"token punctuation\">,</span> va<span class=\"token punctuation\">,</span> f\n\n\n<span class=\"token comment\">/*\nVariableAccess getAnAccess() - Variable\n───────────────────────────────────────\nGets an access to this variable.\n\n┌──────────┬──────────┬──────────┐\n│    v     │    va    │    f     │\n├──────────┼──────────┼──────────┤\n│  v_map   │  v_map   │ my_func  │\n│ 3.cpp:11 │ 3.cpp:12 │ 3.cpp:10 │\n├──────────┼──────────┼──────────┤\n│  v_map   │  v_map   │ my_func  │\n│ 3.cpp:11 │ 3.cpp:14 │ 3.cpp:10 │\n├──────────┼──────────┼──────────┤\n│  v_map   │  v_map   │ my_func  │\n│ 3.cpp:11 │ 3.cpp:13 │ 3.cpp:10 │\n├──────────┼──────────┼──────────┤\n│  v_map   │  v_map   │ my_func  │\n│ 3.cpp:11 │ 3.cpp:16 │ 3.cpp:10 │\n└──────────┴──────────┴──────────┘\n\n...\n10 void my_func(MyClassA *a){\n11         map &lt;int, MyClassA *> v_map;\n12         v_map[1] = a;\n13         v_map[1]->my_func_hi();\n14         v_map.erase(1);\n15         cout &lt;&lt; \"exit\" &lt;&lt; endl;\n16 }\n...\n*/</span>\n</code></pre>\n"}]}]}]},{"t":"list_item","d":4,"p":{"lines":[177,178]},"v":"Expression classes","c":[{"t":"list_item","d":6,"p":{"lines":[178,179]},"v":"<a href=\"https://codeql.github.com/codeql-standard-libraries/cpp/semmle/code/cpp/exprs/Call.qll/type.Call$FunctionCall.html\">class FunctionCall</a>","c":[{"t":"list_item","d":8,"p":{"lines":[179,183]},"v":"<pre class=\"language-sql\"><code class=\"language-sql\">class Expr <span class=\"token operator\">-</span><span class=\"token operator\">></span> class <span class=\"token keyword\">Call</span> <span class=\"token operator\">-</span><span class=\"token operator\">></span> class FunctionCall\n</code></pre>\n"},{"t":"list_item","d":8,"p":{"lines":[183,184]},"v":"getEnclosingFunction()","c":[{"t":"list_item","d":10,"p":{"lines":[184,217]},"v":"<pre class=\"language-sql\"><code class=\"language-sql\"><span class=\"token keyword\">import</span> cpp\n\n<span class=\"token keyword\">from</span> FunctionCall fc\n<span class=\"token keyword\">where</span> fc<span class=\"token punctuation\">.</span>getTarget<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span>getName<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span>matches<span class=\"token punctuation\">(</span><span class=\"token string\">\"my_func%\"</span><span class=\"token punctuation\">)</span>\n<span class=\"token keyword\">select</span> fc<span class=\"token punctuation\">.</span>getEnclosingFunction<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n\n<span class=\"token comment\">/*\nFunction getEnclosingFunction() - Expr\nGets the enclosing function of this expression, if any.\n\n┌──────────┐\n│   ---    │\n├──────────┤\n│ my_func2 │\n│ 3.cpp:7  │\n├──────────┤\n│   main   │\n│ 3.cpp:9  │\n└──────────┘\n\ntypedef unsigned int my_u32;\n\nmy_u32 my_func1(){return 0;}\nlong my_func2(){return long(my_func1());}\n\nint main(){\n        my_func1();\n        my_func2();\n}\n*/</span>\n</code></pre>\n"}]},{"t":"list_item","d":8,"p":{"lines":[217,218]},"v":"getTarget()","c":[{"t":"list_item","d":10,"p":{"lines":[218,225]},"v":"<pre class=\"language-sql\"><code class=\"language-sql\"><span class=\"token keyword\">Function</span> getTarget<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">-</span> FunctionCall\nFunctionCall 的 predicate 返回值是 <span class=\"token keyword\">Function</span>\n──────────────────────────────────────────────────────────────────────────────\nGets the <span class=\"token keyword\">function</span> called <span class=\"token keyword\">by</span> this <span class=\"token keyword\">call</span><span class=\"token punctuation\">.</span>\n</code></pre>\n"}]}]},{"t":"list_item","d":6,"p":{"lines":[225,226]},"v":"<a href=\"https://codeql.github.com/codeql-standard-libraries/cpp/semmle/code/cpp/exprs/Access.qll/type.Access$VariableAccess.html\">class VariableAccess</a>","c":[{"t":"list_item","d":8,"p":{"lines":[226,230]},"v":"<pre class=\"language-sql\"><code class=\"language-sql\">class Expr <span class=\"token operator\">-</span><span class=\"token operator\">></span> class Access <span class=\"token operator\">-</span><span class=\"token operator\">></span> class VariableAccess\n</code></pre>\n"}]}]}]},{"t":"heading","d":2,"p":{"lines":[230,231]},"v":"Third Party Chrome Library","c":[{"t":"list_item","d":4,"p":{"lines":[231,232]},"v":"ManagedMapType","c":[{"t":"list_item","d":6,"p":{"lines":[232,235]},"v":"ManagedMapType 是ManagedCollectionType + MapType,<br>\n对应的就是一个包含 <code>unique_ptr</code> 类型的 <code>map</code>,<br>\n<code>predicate getManagedType</code> 获取的是 <code>unique_ptr</code> 指向的类型"},{"t":"list_item","d":6,"p":{"lines":[235,259]},"v":"<pre class=\"language-sql\"><code class=\"language-sql\"><span class=\"token punctuation\">.</span><span class=\"token comment\">//pointers/managed_ptr.qll:216:</span>\n<span class=\"token comment\">/**\n* A managed pointer inside a map.\n*/</span>\nclass ManagedMapType extends ManagedCollectionType<span class=\"token punctuation\">,</span> MapType {\n\n    ManagedMapType<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> {\n        getComponentType<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> instanceof ManagedPtr\n    }\n\n    override <span class=\"token keyword\">Type</span> getManagedType<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> {\n        <span class=\"token keyword\">exists</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">Type</span> t <span class=\"token operator\">|</span>\n        t <span class=\"token operator\">=</span> getComponentType<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">and</span>\n        result <span class=\"token operator\">=</span>  t<span class=\"token punctuation\">.</span><span class=\"token punctuation\">(</span>ManagedPtr<span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span>getManagedType<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n        <span class=\"token punctuation\">)</span>\n    }\n}\n</code></pre>\n","c":[{"t":"list_item","d":8,"p":{"lines":[255,256]},"v":"ManagedCollectionType"},{"t":"list_item","d":8,"p":{"lines":[256,257]},"v":"MapType"},{"t":"list_item","d":8,"p":{"lines":[257,258]},"v":"getComponentType()"},{"t":"list_item","d":8,"p":{"lines":[258,259]},"v":"ManagedPtr"}]}]},{"t":"list_item","d":4,"p":{"lines":[259,260]},"v":"MapType","c":[{"t":"list_item","d":6,"p":{"lines":[260,261]},"v":"代表一个 map 类，getComponentType 获取map的类型"},{"t":"list_item","d":6,"p":{"lines":[261,305]},"v":"<pre class=\"language-sql\"><code class=\"language-sql\"><span class=\"token punctuation\">.</span><span class=\"token comment\">//collections.qll:205:</span>\n<span class=\"token comment\">/**\n* Heuristics for the map type.\n*/</span>\nclass MapType extends Class {\n    MapType<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> {\n        <span class=\"token punctuation\">(</span>\n        <span class=\"token keyword\">exists</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">Function</span> f<span class=\"token punctuation\">,</span> <span class=\"token keyword\">Type</span> t <span class=\"token operator\">|</span>\n            f<span class=\"token punctuation\">.</span>hasName<span class=\"token punctuation\">(</span><span class=\"token string\">\"find\"</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">or</span> f<span class=\"token punctuation\">.</span>hasName<span class=\"token punctuation\">(</span><span class=\"token string\">\"insert\"</span><span class=\"token punctuation\">)</span><span class=\"token operator\">|</span>\n            t <span class=\"token operator\">=</span> f<span class=\"token punctuation\">.</span>getDeclaringType<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">and</span>\n            this <span class=\"token operator\">=</span> t<span class=\"token punctuation\">.</span>stripType<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token punctuation\">(</span>ClassTemplateInstantiation<span class=\"token punctuation\">)</span>\n        <span class=\"token punctuation\">)</span>\n        <span class=\"token punctuation\">)</span>\n        <span class=\"token operator\">and</span>\n        <span class=\"token operator\">not</span> this<span class=\"token punctuation\">.</span>getName<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span>matches<span class=\"token punctuation\">(</span><span class=\"token string\">\"__tuple_leaf%\"</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">and</span>\n        <span class=\"token operator\">not</span> this<span class=\"token punctuation\">.</span>getName<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span>matches<span class=\"token punctuation\">(</span><span class=\"token string\">\"pair%\"</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">and</span>\n        <span class=\"token operator\">not</span> this<span class=\"token punctuation\">.</span>getName<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span>matches<span class=\"token punctuation\">(</span><span class=\"token string\">\"union%\"</span><span class=\"token punctuation\">)</span>\n    }\n\n    <span class=\"token comment\">/** Component 0 is the key type, component 1 is the value type.*/</span>\n    <span class=\"token keyword\">Type</span> getComponentTypeAt<span class=\"token punctuation\">(</span><span class=\"token keyword\">int</span> i<span class=\"token punctuation\">)</span> {\n        <span class=\"token punctuation\">(</span>\n        result <span class=\"token operator\">=</span> getComponentType<span class=\"token operator\">*</span><span class=\"token punctuation\">(</span>this<span class=\"token punctuation\">.</span>getTemplateArgument<span class=\"token punctuation\">(</span>i<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">and</span>\n        <span class=\"token operator\">not</span> collectionTemplateType<span class=\"token punctuation\">(</span>result<span class=\"token punctuation\">)</span>\n        <span class=\"token punctuation\">)</span>\n    }\n\n    <span class=\"token keyword\">Type</span> getComponentType<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> {\n        <span class=\"token punctuation\">(</span>\n        result <span class=\"token operator\">=</span> getComponentType<span class=\"token operator\">*</span><span class=\"token punctuation\">(</span>this<span class=\"token punctuation\">.</span>getTemplateArgument<span class=\"token punctuation\">(</span><span class=\"token number\">0</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">and</span>\n        <span class=\"token operator\">not</span> collectionTemplateType<span class=\"token punctuation\">(</span>result<span class=\"token punctuation\">)</span>\n        <span class=\"token punctuation\">)</span> <span class=\"token operator\">or</span>\n        <span class=\"token punctuation\">(</span>\n        result <span class=\"token operator\">=</span> getComponentType<span class=\"token operator\">*</span><span class=\"token punctuation\">(</span>this<span class=\"token punctuation\">.</span>getTemplateArgument<span class=\"token punctuation\">(</span><span class=\"token number\">1</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">and</span>\n        <span class=\"token operator\">not</span> collectionTemplateType<span class=\"token punctuation\">(</span>result<span class=\"token punctuation\">)</span>\n        <span class=\"token punctuation\">)</span>\n    }\n}\n</code></pre>\n","c":[{"t":"list_item","d":8,"p":{"lines":[302,303]},"v":"<code>ClassTemplateInstantiation</code>"},{"t":"list_item","d":8,"p":{"lines":[303,304]},"v":"<code>getComponentType*</code>"},{"t":"list_item","d":8,"p":{"lines":[304,305]},"v":"<code>collectionTemplateType</code>"}]},{"t":"list_item","d":6,"p":{"lines":[305,338]},"v":"<pre class=\"language-sql\"><code class=\"language-sql\"><span class=\"token keyword\">from</span> Expr e\n<span class=\"token keyword\">where</span> e<span class=\"token punctuation\">.</span>getEnclosingFunction<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span>getName<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span>matches<span class=\"token punctuation\">(</span><span class=\"token string\">\"my_func%\"</span><span class=\"token punctuation\">)</span>\n    <span class=\"token operator\">and</span> e<span class=\"token punctuation\">.</span>getType<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> instanceof MapType\n<span class=\"token keyword\">select</span> e\n<span class=\"token comment\">/*\n┌──────────┐\n│    e     │\n├──────────┤\n│  v_map   │\n│ 3.cpp:12 │\n├──────────┤\n│  v_map   │\n│ 3.cpp:13 │\n├──────────┤\n│  v_map   │\n│ 3.cpp:14 │\n├──────────┤\n│  v_map   │\n│ 3.cpp:16 │\n└──────────┘\n...\n10 void my_func(MyClassA *a){\n11         map &lt;int, MyClassA *> v_map;\n12         v_map[1] = a;\n13         v_map[1]->my_func_hi();\n14         v_map.erase(1);\n15         cout &lt;&lt; \"exit\" &lt;&lt; endl;\n16 }\n...\n*/</span>\n</code></pre>\n"},{"t":"list_item","d":6,"p":{"lines":[338,339]},"v":"getComponetType","c":[{"t":"list_item","d":8,"p":{"lines":[339,380]},"v":"<pre class=\"language-sql\"><code class=\"language-sql\"><span class=\"token keyword\">import</span> cpp\n<span class=\"token keyword\">import</span> Chrome<span class=\"token punctuation\">.</span>common\n\n<span class=\"token keyword\">from</span> MapType m<span class=\"token punctuation\">,</span> <span class=\"token keyword\">Type</span> cp0<span class=\"token punctuation\">,</span> <span class=\"token keyword\">Type</span> cp1<span class=\"token punctuation\">,</span> Expr map_expr\n<span class=\"token keyword\">where</span> cp0 <span class=\"token operator\">=</span> m<span class=\"token punctuation\">.</span>getComponentTypeAt<span class=\"token punctuation\">(</span><span class=\"token number\">0</span><span class=\"token punctuation\">)</span> <span class=\"token comment\">// map key 的类型</span>\n    <span class=\"token operator\">and</span> cp1 <span class=\"token operator\">=</span> m<span class=\"token punctuation\">.</span>getComponentTypeAt<span class=\"token punctuation\">(</span><span class=\"token number\">1</span><span class=\"token punctuation\">)</span> <span class=\"token comment\">// map value 的类型</span>\n    <span class=\"token operator\">and</span> map_expr<span class=\"token punctuation\">.</span>getType<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=</span> m\n    <span class=\"token operator\">and</span> map_expr<span class=\"token punctuation\">.</span>getEnclosingFunction<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span>getName<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span>matches<span class=\"token punctuation\">(</span><span class=\"token string\">\"my_func%\"</span><span class=\"token punctuation\">)</span> <span class=\"token comment\">// 找到my_func 函数 map 相关的操作</span>\n<span class=\"token keyword\">select</span> cp0<span class=\"token punctuation\">,</span> cp1<span class=\"token punctuation\">,</span> map_expr\n\n<span class=\"token comment\">/*\n┌─────┬────────────┬──────────┐\n│ cp0 │    cp1     │ map_expr │\n├─────┼────────────┼──────────┤\n│ int │ MyClassA * │  v_map   │\n│ :0  │     :0     │ 3.cpp:12 │\n├─────┼────────────┼──────────┤\n│ int │ MyClassA * │  v_map   │\n│ :0  │     :0     │ 3.cpp:14 │\n├─────┼────────────┼──────────┤\n│ int │ MyClassA * │  v_map   │\n│ :0  │     :0     │ 3.cpp:13 │\n├─────┼────────────┼──────────┤\n│ int │ MyClassA * │  v_map   │\n│ :0  │     :0     │ 3.cpp:16 │\n└─────┴────────────┴──────────┘\n\n...\n10 void my_func(MyClassA *a){\n11         map &lt;int, MyClassA *> v_map;\n12         v_map[1] = a;\n13         v_map[1]->my_func_hi();\n14         v_map.erase(1);\n15         cout &lt;&lt; \"exit\" &lt;&lt; endl;\n16 }\n...\n\n*/</span>\n</code></pre>\n"}]}]},{"t":"list_item","d":4,"p":{"lines":[380,381]},"v":"ManagedPtr","c":[{"t":"list_item","d":6,"p":{"lines":[381,382]},"v":"可以认为代表了 unique_ptr 类型，通过 getManagedType 获取指针类型"},{"t":"list_item","d":6,"p":{"lines":[382,397]},"v":"<pre class=\"language-sql\"><code class=\"language-sql\"><span class=\"token punctuation\">.</span><span class=\"token comment\">//pointers/managed_ptr.qll:162:</span>\n<span class=\"token comment\">/** Normal managed pointers.*/</span>\nclass ManagedPtr extends GeneralManagedType {\n    ManagedPtr<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> {\n        this<span class=\"token punctuation\">.</span>getName<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span>matches<span class=\"token punctuation\">(</span><span class=\"token string\">\"unique_ptr%\"</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">or</span>\n        this<span class=\"token punctuation\">.</span>getName<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span>matches<span class=\"token punctuation\">(</span><span class=\"token string\">\"scoped_refptr%\"</span><span class=\"token punctuation\">)</span>\n    }\n\n    override <span class=\"token keyword\">Type</span> getManagedType<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> {result <span class=\"token operator\">=</span> this<span class=\"token punctuation\">.</span>getTemplateArgument<span class=\"token punctuation\">(</span><span class=\"token number\">0</span><span class=\"token punctuation\">)</span>}\n\n    override predicate isOwner<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> {getName<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span>matches<span class=\"token punctuation\">(</span><span class=\"token string\">\"unique_ptr%\"</span><span class=\"token punctuation\">)</span>}\n}\n</code></pre>\n"},{"t":"list_item","d":6,"p":{"lines":[397,427]},"v":"<pre class=\"language-sql\"><code class=\"language-sql\"><span class=\"token keyword\">import</span> cpp\n<span class=\"token keyword\">import</span> Chrome<span class=\"token punctuation\">.</span>common\n\n<span class=\"token keyword\">from</span> ManagedPtr p\n<span class=\"token keyword\">where</span> p<span class=\"token punctuation\">.</span>getManagedType<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span>getName<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=</span> <span class=\"token string\">\"X1\"</span>\n<span class=\"token keyword\">select</span> p<span class=\"token punctuation\">,</span> p<span class=\"token punctuation\">.</span>getManagedType<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n\n<span class=\"token comment\">/*\n┌────────────────────────────────────┬─────────┐\n│                 p                  │   ---   │\n├────────────────────────────────────┼─────────┤\n│ unique_ptr&lt;X1, default_delete&lt;X1>> │   X1    │\n│            memory:2148             │ 2.cpp:6 │\n└────────────────────────────────────┴─────────┘\n\nclass X1 {\npublic:\nvoid hi(){ std::cout &lt;&lt; \"Hi\" &lt;&lt; std::endl; }\n};\n\nclass TestClass {\npublic:\n...\nmap &lt;int ,unique_ptr&lt;X1>> m3;\n...\n};\n*/</span>\n</code></pre>\n"}]},{"t":"list_item","d":4,"p":{"lines":[427,428]},"v":"ManagedCollectionType","c":[{"t":"list_item","d":6,"p":{"lines":[428,445]},"v":"<pre class=\"language-sql\"><code class=\"language-sql\"><span class=\"token punctuation\">.</span><span class=\"token comment\">//pointers/managed_ptr.qll:202:</span>\n<span class=\"token comment\">/**\n* A managed pointer that is inside a collection.\n*/</span>\nabstract class ManagedCollectionType extends GeneralManagedType {\n    ManagedCollectionType<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> {\n        this<span class=\"token punctuation\">.</span>stripType<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span>getName<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span>matches<span class=\"token punctuation\">(</span><span class=\"token string\">\"%unique_ptr%\"</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">or</span>\n        this<span class=\"token punctuation\">.</span>stripType<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span>getName<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span>matches<span class=\"token punctuation\">(</span><span class=\"token string\">\"%scoped_refptr%\"</span><span class=\"token punctuation\">)</span>\n    }\n\n    override predicate isOwner<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> {\n        this<span class=\"token punctuation\">.</span>stripType<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span>getName<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span>matches<span class=\"token punctuation\">(</span><span class=\"token string\">\"%unique_ptr%\"</span><span class=\"token punctuation\">)</span>\n    }\n}\n</code></pre>\n"},{"t":"list_item","d":6,"p":{"lines":[445,487]},"v":"<pre class=\"language-sql\"><code class=\"language-sql\"><span class=\"token keyword\">import</span> cpp\n<span class=\"token keyword\">import</span> Chrome<span class=\"token punctuation\">.</span>common\n\npredicate isMyClass<span class=\"token punctuation\">(</span>Field f<span class=\"token punctuation\">)</span>{\n    f<span class=\"token punctuation\">.</span>getDeclaringType<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span>getName<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=</span> <span class=\"token string\">\"TestClass\"</span>\n}\n\n<span class=\"token keyword\">from</span> ManagedCollectionType f<span class=\"token punctuation\">,</span> Field fd\n<span class=\"token keyword\">where</span> isMyClass<span class=\"token punctuation\">(</span>fd<span class=\"token punctuation\">)</span>\n    <span class=\"token comment\">// and (fd.getType() = f or fd.getType() instanceof ManagedPtr)</span>\n    <span class=\"token operator\">and</span> fd<span class=\"token punctuation\">.</span>getType<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=</span> f\n<span class=\"token keyword\">select</span> fd<span class=\"token punctuation\">,</span> fd<span class=\"token punctuation\">.</span>getType<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n<span class=\"token comment\">/*\n筛选出集合类型中包含 unique_ptr 的类型, m1, m2, up1都别剔除了\n如果使用注释掉的那行结果中会包含 up1\n┌──────────┬─────────────────────────\n│    fd    │                        ...\n├──────────┼─────────────────────────\n│    m3    │ map&lt;int, unique_ptr&lt;X1, ...\n│ 2.cpp:15 │\n├──────────┼─────────────────────────\n│    m4    │ map&lt;int, unique_ptr&lt;X1,  ...\n│ 2.cpp:16 │\n├──────────┼─────────────────────────\n│    m5    │ map&lt;int, unique_ptr&lt;X1, ...\n│ 2.cpp:17 │\n└──────────┴─────────────────────────\n\n11 class TestClass {\n12 public:\n13         map &lt;int ,int> m1;\n14         map &lt;int ,string> m2;\n15         map &lt;int ,unique_ptr&lt;X1>> m3;\n16         map &lt;int ,unique_ptr&lt;X1>> m4;\n17         map &lt;int ,unique_ptr&lt;X1>> m5;\n18         unique_ptr&lt;X1> up1;\n...\n*/</span>\n\n</code></pre>\n"},{"t":"list_item","d":6,"p":{"lines":[487,488]},"v":"GeneralManagedType","c":[{"t":"list_item","d":8,"p":{"lines":[488,489]},"v":"抽象类，nothing here"},{"t":"list_item","d":8,"p":{"lines":[489,509]},"v":"<pre class=\"language-sql\"><code class=\"language-sql\"><span class=\"token punctuation\">.</span><span class=\"token comment\">//pointers/managed_ptr.qll:96:</span>\n<span class=\"token comment\">/**\n* General managed pointer type. Only includes `scoped_refptr` and `unique_ptr`\n* at the moment. (`WeakPtr` not too interesting for memory corruption problem)\n* Includes normal type or container types.\n*/</span>\nabstract class GeneralManagedType extends Class {\n    <span class=\"token comment\">/**\n    * Gets the underlying managed type.\n    */</span>\n    abstract <span class=\"token keyword\">Type</span> getManagedType<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n    <span class=\"token comment\">/**\n    * Holds if the type is owned completely, i.e. `unique_ptr`.\n    */</span>\n    abstract predicate isOwner<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n}\n</code></pre>\n"}]}]},{"t":"list_item","d":4,"p":{"lines":[509,510]},"v":"ManagedMapField","c":[{"t":"list_item","d":6,"p":{"lines":[510,587]},"v":"<pre class=\"language-sql\"><code class=\"language-sql\"><span class=\"token comment\">/**\n* A field that stores managed pointers in a map.\n*/</span>\nclass ManagedMapField extends MapField<span class=\"token punctuation\">,</span> GeneralManagedField {\n    ManagedMapField<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> {\n        <span class=\"token comment\">// binding set is not likely to have problem.</span>\n        <span class=\"token operator\">not</span> <span class=\"token punctuation\">(</span>getName<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=</span> <span class=\"token string\">\"bindings_\"</span> <span class=\"token operator\">and</span> getDeclaringType<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span>getName<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span>matches<span class=\"token punctuation\">(</span><span class=\"token string\">\"BindingSet%\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">and</span>\n        getType<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> instanceof ManagedMapType\n    }\n\n    override <span class=\"token keyword\">Type</span> getManagedType<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> {\n        result <span class=\"token operator\">=</span> getType<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token punctuation\">(</span>ManagedMapType<span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span>getManagedType<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n    }\n\n    override Expr getAManagedReset<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> {result <span class=\"token operator\">=</span> getAReset<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>}\n\n    override predicate isOwner<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> {getType<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token punctuation\">(</span>ManagedMapType<span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span>isOwner<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>}\n}\n</code></pre>\n","c":[{"t":"list_item","d":8,"p":{"lines":[531,532]},"v":"MapField","c":[{"t":"list_item","d":10,"p":{"lines":[532,533]},"v":"<code>.//collections.qll:247:class MapField extends CollectionField {</code>","c":[{"t":"list_item","d":12,"p":{"lines":[533,534]},"v":"<code>.//collections.qll:241:abstract class CollectionField extends Field {</code>"}]}]},{"t":"list_item","d":8,"p":{"lines":[534,535]},"v":"GeneralManagedField","c":[{"t":"list_item","d":10,"p":{"lines":[535,560]},"v":"<pre class=\"language-sql\"><code class=\"language-sql\"><span class=\"token punctuation\">.</span><span class=\"token comment\">//pointers/managed_ptr.qll:112</span>\n<span class=\"token comment\">/**\n* General managed pointer field. Excludes `WeakPtr` as it is less interesting.\n* Includes normal field or collection field.\n*/</span>\nabstract class GeneralManagedField extends Field {\n\n    <span class=\"token comment\">/**\n    * Gets the underlying type that is being managed.\n    */</span>\n    abstract <span class=\"token keyword\">Type</span> getManagedType<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n    <span class=\"token comment\">/**\n    * Gets an expression that resets the pointer, which can free the underlying object.\n    */</span>\n    abstract Expr getAManagedReset<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n    <span class=\"token comment\">/**\n    * Holds if the field is owned completely, i.e. `unique_ptr`.\n    */</span>\n    abstract predicate isOwner<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n}\n</code></pre>\n"},{"t":"list_item","d":10,"p":{"lines":[560,561]},"v":"getAManagedReset() -&gt; getAReset()","c":[{"t":"list_item","d":12,"p":{"lines":[561,587]},"v":"<pre class=\"language-sql\"><code class=\"language-sql\">class MapField extends CollectionField {\n    MapField<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> {\n        getType<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> instanceof MapType\n    }\n\n    override Expr getAReset<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> {\n        <span class=\"token keyword\">exists</span><span class=\"token punctuation\">(</span>FunctionCall fc <span class=\"token operator\">|</span> fc<span class=\"token punctuation\">.</span>getTarget<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span>hasName<span class=\"token punctuation\">(</span><span class=\"token string\">\"erase\"</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">or</span>\n        fc<span class=\"token punctuation\">.</span>getTarget<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span>getName<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span>matches<span class=\"token punctuation\">(</span><span class=\"token string\">\"pop%\"</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">or</span> fc<span class=\"token punctuation\">.</span>getTarget<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span>hasName<span class=\"token punctuation\">(</span><span class=\"token string\">\"clear\"</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">or</span>\n        fc<span class=\"token punctuation\">.</span>getTarget<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span>hasName<span class=\"token punctuation\">(</span><span class=\"token string\">\"insert\"</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">|</span>\n        fc<span class=\"token punctuation\">.</span>getQualifier<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=</span> this<span class=\"token punctuation\">.</span>getAnAccess<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">and</span>\n        result <span class=\"token operator\">=</span> fc\n        <span class=\"token punctuation\">)</span>\n        <span class=\"token operator\">or</span>\n        <span class=\"token keyword\">exists</span><span class=\"token punctuation\">(</span>FunctionCall fc <span class=\"token operator\">|</span> fc<span class=\"token punctuation\">.</span>getTarget<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span>hasName<span class=\"token punctuation\">(</span><span class=\"token string\">\"operator[]\"</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">and</span>\n        fc<span class=\"token punctuation\">.</span>getQualifier<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=</span> this<span class=\"token punctuation\">.</span>getAnAccess<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">and</span>\n        <span class=\"token operator\">not</span> <span class=\"token keyword\">exists</span><span class=\"token punctuation\">(</span>FunctionCall assign <span class=\"token operator\">|</span> assign<span class=\"token punctuation\">.</span>getTarget<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span>hasName<span class=\"token punctuation\">(</span><span class=\"token string\">\"operator=\"</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">and</span>\n            fc <span class=\"token operator\">=</span> assign<span class=\"token punctuation\">.</span>getArgument<span class=\"token punctuation\">(</span><span class=\"token number\">0</span><span class=\"token punctuation\">)</span>\n        <span class=\"token punctuation\">)</span> <span class=\"token operator\">and</span>\n        <span class=\"token operator\">not</span> <span class=\"token keyword\">exists</span><span class=\"token punctuation\">(</span>AssignExpr assign <span class=\"token operator\">|</span> assign<span class=\"token punctuation\">.</span>getRValue<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=</span> fc<span class=\"token punctuation\">)</span> <span class=\"token operator\">and</span>\n        result <span class=\"token operator\">=</span> fc\n        <span class=\"token punctuation\">)</span>\n    }\n}\n</code></pre>\n"}]}]}]}]},{"t":"list_item","d":4,"p":{"lines":[587,588]},"v":"collectionTemplateType","c":[{"t":"list_item","d":6,"p":{"lines":[588,599]},"v":"<pre class=\"language-sql\"><code class=\"language-sql\"><span class=\"token comment\">/** Holds if `t` is a collection type.*/</span>\npredicate collectionTemplateType<span class=\"token punctuation\">(</span><span class=\"token keyword\">Type</span> t<span class=\"token punctuation\">)</span> {\n    t instanceof ListType <span class=\"token operator\">or</span>\n    t instanceof TupleType <span class=\"token operator\">or</span>\n    t instanceof ValueType <span class=\"token operator\">or</span>\n    t instanceof HashValueType <span class=\"token operator\">or</span>\n    t instanceof MapType\n}\n</code></pre>\n"}]}]},{"t":"heading","d":2,"p":{"lines":[599,600]},"v":"代码解析","c":[{"t":"list_item","d":4,"p":{"lines":[600,601]},"v":"第一行:","c":[{"t":"list_item","d":6,"p":{"lines":[601,621]},"v":"<pre class=\"language-sql\"><code class=\"language-sql\"><span class=\"token number\">1</span> <span class=\"token keyword\">where</span> key_map<span class=\"token punctuation\">.</span>getType<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span>stripType<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> instanceof ManagedMapType\n</code></pre>\n","c":[{"t":"list_item","d":8,"p":{"lines":[605,606]},"v":"筛选出 <code>ManagedMapType</code> 相关的操作","c":[{"t":"list_item","d":10,"p":{"lines":[606,621]},"v":"<pre class=\"language-sql\"><code class=\"language-sql\"><span class=\"token keyword\">import</span> cpp\n<span class=\"token keyword\">import</span> Chrome<span class=\"token punctuation\">.</span>common\n\n<span class=\"token keyword\">from</span> Field key_map\n<span class=\"token keyword\">where</span> key_map<span class=\"token punctuation\">.</span>getType<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span>stripType<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> instanceof ManagedMapType\n<span class=\"token keyword\">select</span> key_map\n\n<span class=\"token comment\">/*\nfrom Expr key_map\nwhere key_map.getType().stripType() instanceof ManagedMapType\nselect key_map\n*/</span>\n</code></pre>\n"}]}]}]},{"t":"list_item","d":4,"p":{"lines":[621,622]},"v":"第二～三行:","c":[{"t":"list_item","d":6,"p":{"lines":[622,646]},"v":"<pre class=\"language-sql\"><code class=\"language-sql\"><span class=\"token number\">2</span> <span class=\"token operator\">and</span> key_map<span class=\"token punctuation\">.</span>getType<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span>stripType<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token punctuation\">(</span>ManagedMapType<span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span>getManagedType<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=</span>\n<span class=\"token number\">3</span>         map_field<span class=\"token punctuation\">.</span>getManagedType<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n</code></pre>\n","c":[{"t":"list_item","d":8,"p":{"lines":[627,629]},"v":"看起来第一句没有作用，一开始直接用map_filed 效果应该是一样的，<br>\n这里map_field 用了 getManagedType, 再根据名称，判断应该是MangedMapField 类型"},{"t":"list_item","d":8,"p":{"lines":[629,646]},"v":"<pre class=\"language-sql\"><code class=\"language-sql\"><span class=\"token comment\">// 前两句应该是这个意思</span>\n<span class=\"token keyword\">import</span> cpp\n<span class=\"token keyword\">import</span> Chrome<span class=\"token punctuation\">.</span>common\n\n<span class=\"token keyword\">from</span> ManagedMapField map_field\n<span class=\"token keyword\">select</span> map_field\n\n<span class=\"token comment\">/*\nfrom ManagedMapField map_field, Expr key_map\nwhere key_map.getType().stripType() instanceof ManagedMapType\n    and key_map.getType().stripType().(ManagedMapType).getManagedType() \n        = map_field.getManagedType()\nselect map_field\n*/</span>\n</code></pre>\n"}]}]},{"t":"list_item","d":4,"p":{"lines":[646,647]},"v":"第四行:","c":[{"t":"list_item","d":6,"p":{"lines":[647,652]},"v":"<pre class=\"language-sql\"><code class=\"language-sql\"><span class=\"token number\">4</span> <span class=\"token operator\">and</span> reset_func <span class=\"token operator\">=</span> map_field<span class=\"token punctuation\">.</span>getAManagedReset<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span>getEnclosingFunction<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>        \n</code></pre>\n","c":[{"t":"list_item","d":8,"p":{"lines":[651,652]},"v":"reset_func: 减少指针引用的函数"}]}]},{"t":"list_item","d":4,"p":{"lines":[652,653]},"v":"第五行:","c":[{"t":"list_item","d":6,"p":{"lines":[653,658]},"v":"<pre class=\"language-sql\"><code class=\"language-sql\"><span class=\"token number\">5</span> <span class=\"token comment\">// and  reach*(ext_func, reset_func)        </span>\n</code></pre>\n","c":[{"t":"list_item","d":8,"p":{"lines":[657,658]},"v":"reset_func: 减少指针引用的函数"}]}]},{"t":"list_item","d":4,"p":{"lines":[658,659]},"v":"第六行:","c":[{"t":"list_item","d":6,"p":{"lines":[659,664]},"v":"<pre class=\"language-sql\"><code class=\"language-sql\"><span class=\"token number\">6</span> <span class=\"token operator\">and</span> member_f1<span class=\"token punctuation\">.</span>getDeclaringType<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=</span> map_field<span class=\"token punctuation\">.</span>getManagedType<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>        \n</code></pre>\n","c":[{"t":"list_item","d":8,"p":{"lines":[663,664]},"v":"找到 map_field 指向的类的成员函数 member_f1"}]}]},{"t":"list_item","d":4,"p":{"lines":[664,665]},"v":"第七～八行:","c":[{"t":"list_item","d":6,"p":{"lines":[665,671]},"v":"<pre class=\"language-sql\"><code class=\"language-sql\"><span class=\"token number\">7</span> <span class=\"token operator\">and</span> fc<span class=\"token punctuation\">.</span>getTarget<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=</span> reset_func\n<span class=\"token number\">8</span> <span class=\"token operator\">and</span> fc<span class=\"token punctuation\">.</span>getEnclosingFunction<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=</span> member_f1\n</code></pre>\n","c":[{"t":"list_item","d":8,"p":{"lines":[670,671]},"v":"进一步找到调用了 reset_func 的 member_f1"}]}]},{"t":"list_item","d":4,"p":{"lines":[671,672]},"v":"第九～十行:","c":[{"t":"list_item","d":6,"p":{"lines":[672,678]},"v":"<pre class=\"language-sql\"><code class=\"language-sql\"><span class=\"token number\">9</span> <span class=\"token operator\">and</span> <span class=\"token punctuation\">(</span>member_V<span class=\"token punctuation\">.</span>getAnAccess<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=</span> ex <span class=\"token operator\">and</span>\n<span class=\"token number\">10</span>         ex<span class=\"token punctuation\">.</span>getEnclosingFunction<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=</span> member_f1<span class=\"token punctuation\">)</span>\n</code></pre>\n","c":[{"t":"list_item","d":8,"p":{"lines":[677,678]},"v":"找到一个成员变量 member_V , 在 member_f1 中被使用"}]}]},{"t":"list_item","d":4,"p":{"lines":[678,679]},"v":"第十一～十二行:","c":[{"t":"list_item","d":6,"p":{"lines":[679,685]},"v":"<pre class=\"language-sql\"><code class=\"language-sql\"><span class=\"token number\">11</span> <span class=\"token operator\">or</span> <span class=\"token punctuation\">(</span>member_fc<span class=\"token punctuation\">.</span>getTarget<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=</span> member_f2 <span class=\"token operator\">and</span>\n<span class=\"token number\">12</span>         member_fc<span class=\"token punctuation\">.</span>getEnclosingFunction<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=</span> member_f1<span class=\"token punctuation\">)</span>\n</code></pre>\n","c":[{"t":"list_item","d":8,"p":{"lines":[684,685]},"v":"找到一个成员函数 member_f2 , 在 member_f1 中被调用"}]}]},{"t":"list_item","d":4,"p":{"lines":[685,686]},"v":"汇总","c":[{"t":"list_item","d":6,"p":{"lines":[686,687]},"v":"这段代码很不完整，大致思路应该是：","c":[{"t":"list_item","d":8,"p":{"lines":[687,688]},"v":"找到所有包含 <code>map&lt;xx, unique_ptr&lt;SomeClass&gt; &gt; x</code> 属性的类 <code>TestClass</code>，"},{"t":"list_item","d":8,"p":{"lines":[688,689]},"v":"找到直接或者间接调用释放指针引用(reset)的操作( 如<code>map.erase()</code> )的成员函数, <code>TestClass.clean()</code>， <code>TestClass.member_f1()</code>"},{"t":"list_item","d":8,"p":{"lines":[689,690]},"v":"找到指针指向的类(<code>MyClass1</code>)的成员变量或者函数被使用的地方，如果是调用reset的同一个成员函数，则大概率是UAF"}]},{"t":"list_item","d":6,"p":{"lines":[690,691]},"v":"示例：","c":[{"t":"list_item","d":8,"p":{"lines":[691,719]},"v":"<pre class=\"language-cpp\"><code class=\"language-cpp\">Class TestClass<span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">public</span><span class=\"token operator\">:</span>\n        <span class=\"token keyword\">void</span> <span class=\"token operator\">*</span>member_V<span class=\"token punctuation\">;</span>\n        map <span class=\"token operator\">&lt;</span><span class=\"token keyword\">int</span><span class=\"token punctuation\">,</span> unique_ptr<span class=\"token operator\">&lt;</span>TestClass<span class=\"token operator\">>></span> map_field<span class=\"token punctuation\">;</span>\n\n        <span class=\"token keyword\">void</span> <span class=\"token function\">member_f1</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">{</span>\n            <span class=\"token keyword\">if</span><span class=\"token punctuation\">(</span>A<span class=\"token punctuation\">)</span><span class=\"token punctuation\">{</span>\n                <span class=\"token function\">clean</span><span class=\"token punctuation\">(</span>x<span class=\"token punctuation\">)</span>\n            <span class=\"token punctuation\">}</span>\n            <span class=\"token keyword\">if</span><span class=\"token punctuation\">(</span>B<span class=\"token punctuation\">)</span><span class=\"token punctuation\">{</span>\n                map_field<span class=\"token punctuation\">[</span>x<span class=\"token punctuation\">]</span><span class=\"token operator\">-></span>member_v<span class=\"token operator\">-></span><span class=\"token function\">call</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n            <span class=\"token punctuation\">}</span>\n            <span class=\"token keyword\">if</span><span class=\"token punctuation\">(</span>C<span class=\"token punctuation\">)</span><span class=\"token punctuation\">{</span>\n                map_field<span class=\"token punctuation\">[</span>x<span class=\"token punctuation\">]</span><span class=\"token operator\">-></span><span class=\"token function\">member_f2</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n            <span class=\"token punctuation\">}</span>\n        <span class=\"token punctuation\">}</span>\n\n        <span class=\"token keyword\">void</span> <span class=\"token function\">clean</span><span class=\"token punctuation\">(</span>x<span class=\"token punctuation\">)</span><span class=\"token punctuation\">{</span>\n            map_field<span class=\"token punctuation\">.</span><span class=\"token function\">erase</span><span class=\"token punctuation\">(</span>x<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        <span class=\"token punctuation\">}</span>\n\n        <span class=\"token keyword\">void</span> <span class=\"token function\">member_f2</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">{</span>\n\n        <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span>\n</code></pre>\n"}]}]}]},{"t":"heading","d":2,"p":{"lines":[719,720]},"v":"漏洞分析 CVE-2021-21115","c":[{"t":"list_item","d":4,"p":{"lines":[720,725]},"v":"","c":[{"t":"list_item","d":6,"p":{"lines":[721,722]},"v":"<a href=\"https://bugs.chromium.org/p/chromium/issues/detail?id=1157814\">issue 1157814</a>"},{"t":"list_item","d":6,"p":{"lines":[723,724]},"v":"<a href=\"https://source.chromium.org/chromium/chromium/src/+/main:;drc=4e69945675d6aa53455a418ffc764b313842a3ee\">commit 4e699456</a>"}]},{"t":"list_item","d":4,"p":{"lines":[725,726]},"v":"<a href=\"https://source.chromium.org/chromium/chromium/src/+/master:components/safe_browsing/content/password_protection/password_protection_request.h;l=83;drc=4e69945675d6aa53455a418ffc764b313842a3ee\">class PasswordProtectionRequest</a>","c":[{"t":"list_item","d":6,"p":{"lines":[726,793]},"v":"<pre class=\"language-cpp\"><code class=\"language-cpp\"><span class=\"token keyword\">class</span> <span class=\"token class-name\">PasswordProtectionRequest</span> <span class=\"token punctuation\">{</span>\n<span class=\"token keyword\">private</span><span class=\"token operator\">:</span>\n    <span class=\"token keyword\">void</span> <span class=\"token function\">OnWhitelistCheckDone</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">.</span><span class=\"token punctuation\">.</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n    <span class=\"token comment\">// Fill |request_proto_| with appropriate values.</span>\n    <span class=\"token keyword\">void</span> <span class=\"token function\">FillRequestProto</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">bool</span> is_sampled_ping<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n    <span class=\"token comment\">// |this| will be destroyed after calling this function.</span>\n    <span class=\"token keyword\">void</span> <span class=\"token function\">Finish</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">.</span><span class=\"token punctuation\">.</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n    <span class=\"token comment\">// Initiates network request to Safe Browsing backend.</span>\n    <span class=\"token keyword\">void</span> <span class=\"token function\">SendRequest</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n    PasswordProtectionServiceBase<span class=\"token operator\">*</span> password_protection_service_<span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span>\n</code></pre>\n","c":[{"t":"list_item","d":8,"p":{"lines":[744,745]},"v":"<a href=\"https://source.chromium.org/chromium/chromium/src/+/master:components/safe_browsing/content/password_protection/password_protection_request.cc;l=191;drc=4e69945675d6aa53455a418ffc764b313842a3ee\">PasswordProtectionRequest::OnWhitelistCheckDone</a>","c":[{"t":"list_item","d":10,"p":{"lines":[745,793]},"v":"<pre class=\"language-cpp\"><code class=\"language-cpp\"><span class=\"token keyword\">void</span> <span class=\"token class-name\">PasswordProtectionRequest</span><span class=\"token double-colon punctuation\">::</span><span class=\"token function\">OnWhitelistCheckDone</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">bool</span> match_whitelist<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>match_whitelist<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n            <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>password_protection_service_<span class=\"token operator\">-></span><span class=\"token function\">CanSendSamplePing</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n                <span class=\"token function\">FillRequestProto</span><span class=\"token punctuation\">(</span><span class=\"token comment\">/*is_sampled_ping=*/</span><span class=\"token boolean\">true</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        <span class=\"token punctuation\">}</span>\n        <span class=\"token function\">Finish</span><span class=\"token punctuation\">(</span>RequestOutcome<span class=\"token double-colon punctuation\">::</span>MATCHED_WHITELIST<span class=\"token punctuation\">,</span> <span class=\"token keyword\">nullptr</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span>\n</code></pre>\n","c":[{"t":"list_item","d":12,"p":{"lines":[756,757]},"v":"<a href=\"https://source.chromium.org/chromium/chromium/src/+/master:components/safe_browsing/content/password_protection/password_protection_request.cc;l=233;drc=4e69945675d6aa53455a418ffc764b313842a3ee\">PasswordProtectionRequest::FillRequestProto</a>","c":[{"t":"list_item","d":14,"p":{"lines":[757,758]},"v":"<a href=\"https://source.chromium.org/chromium/chromium/src/+/master:components/safe_browsing/content/password_protection/password_protection_request.cc;l=483;drc=4e69945675d6aa53455a418ffc764b313842a3ee\">PasswordProtectionRequest::SendRequest</a>","c":[{"t":"list_item","d":16,"p":{"lines":[758,769]},"v":"<pre class=\"language-cpp\"><code class=\"language-cpp\"><span class=\"token keyword\">void</span> <span class=\"token class-name\">PasswordProtectionRequest</span><span class=\"token double-colon punctuation\">::</span><span class=\"token function\">SendRequest</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    std<span class=\"token double-colon punctuation\">::</span>string serialized_request<span class=\"token punctuation\">;</span>\n    <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span><span class=\"token operator\">!</span>request_proto_<span class=\"token operator\">-></span><span class=\"token function\">SerializeToString</span><span class=\"token punctuation\">(</span><span class=\"token operator\">&amp;</span>serialized_request<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token function\">Finish</span><span class=\"token punctuation\">(</span>RequestOutcome<span class=\"token double-colon punctuation\">::</span>REQUEST_MALFORMED<span class=\"token punctuation\">,</span> <span class=\"token keyword\">nullptr</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        <span class=\"token keyword\">return</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span>\n\n</code></pre>\n"}]}]},{"t":"list_item","d":12,"p":{"lines":[769,770]},"v":"<a href=\"https://source.chromium.org/chromium/chromium/src/+/master:components/safe_browsing/content/password_protection/password_protection_request.cc;l=590;drc=4e69945675d6aa53455a418ffc764b313842a3ee\">PasswordProtectionRequest::Finish</a>","c":[{"t":"list_item","d":14,"p":{"lines":[770,793]},"v":"<pre class=\"language-cpp\"><code class=\"language-cpp\"><span class=\"token keyword\">void</span> <span class=\"token class-name\">PasswordProtectionRequest</span><span class=\"token double-colon punctuation\">::</span><span class=\"token function\">Finish</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">.</span><span class=\"token punctuation\">.</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">{</span>\n<span class=\"token punctuation\">.</span><span class=\"token punctuation\">.</span><span class=\"token punctuation\">.</span>\n    password_protection_service_<span class=\"token operator\">-></span><span class=\"token function\">RequestFinished</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">this</span><span class=\"token punctuation\">,</span> outcome<span class=\"token punctuation\">,</span>\n                                                std<span class=\"token double-colon punctuation\">::</span><span class=\"token function\">move</span><span class=\"token punctuation\">(</span>response<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span>\n</code></pre>\n","c":[{"t":"list_item","d":16,"p":{"lines":[778,793]},"v":"<pre class=\"language-cpp\"><code class=\"language-cpp\"><span class=\"token keyword\">void</span> <span class=\"token class-name\">PasswordProtectionServiceBase</span><span class=\"token double-colon punctuation\">::</span><span class=\"token function\">RequestFinished</span><span class=\"token punctuation\">(</span>\n    PasswordProtectionRequest<span class=\"token operator\">*</span> request<span class=\"token punctuation\">,</span><span class=\"token punctuation\">.</span><span class=\"token punctuation\">.</span><span class=\"token punctuation\">.</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">{</span>\n    <span class=\"token punctuation\">.</span><span class=\"token punctuation\">.</span><span class=\"token punctuation\">.</span>\n    <span class=\"token keyword\">for</span> <span class=\"token punctuation\">(</span><span class=\"token keyword\">auto</span> it <span class=\"token operator\">=</span> pending_requests_<span class=\"token punctuation\">.</span><span class=\"token function\">begin</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span> it <span class=\"token operator\">!=</span> pending_requests_<span class=\"token punctuation\">.</span><span class=\"token function\">end</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    it<span class=\"token operator\">++</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>it<span class=\"token operator\">-></span><span class=\"token function\">get</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">==</span> request<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n                <span class=\"token comment\">//...</span>\n        pending_requests_<span class=\"token punctuation\">.</span><span class=\"token function\">erase</span><span class=\"token punctuation\">(</span>it<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        <span class=\"token keyword\">break</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span>\n</code></pre>\n"}]}]}]}]}]}]},{"t":"list_item","d":4,"p":{"lines":[793,794]},"v":"<a href=\"https://source.chromium.org/chromium/chromium/src/+/master:components/safe_browsing/content/password_protection/password_protection_service.h;l=67;drc=4e69945675d6aa53455a418ffc764b313842a3ee\">class PasswordProtectionServiceBase</a>","c":[{"t":"list_item","d":6,"p":{"lines":[794,838]},"v":"<pre class=\"language-cpp\"><code class=\"language-cpp\"><span class=\"token keyword\">class</span> <span class=\"token class-name\">PasswordProtectionServiceBase</span> <span class=\"token punctuation\">{</span>\n\n<span class=\"token keyword\">protected</span><span class=\"token operator\">:</span>\n    <span class=\"token comment\">// Called by a PasswordProtectionRequest instance when it finishes to remove</span>\n    <span class=\"token comment\">// itself from |requests_|.</span>\n    <span class=\"token keyword\">virtual</span> <span class=\"token keyword\">void</span> <span class=\"token function\">RequestFinished</span><span class=\"token punctuation\">(</span>\n        PasswordProtectionRequest<span class=\"token operator\">*</span> request<span class=\"token punctuation\">,</span>\n        <span class=\"token punctuation\">.</span><span class=\"token punctuation\">.</span><span class=\"token punctuation\">.</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token keyword\">void</span> <span class=\"token function\">StartRequest</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n    std<span class=\"token double-colon punctuation\">::</span>set<span class=\"token operator\">&lt;</span>scoped_refptr<span class=\"token operator\">&lt;</span>PasswordProtectionRequest<span class=\"token operator\">>></span> pending_requests_<span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span>\n</code></pre>\n","c":[{"t":"list_item","d":8,"p":{"lines":[809,810]},"v":"<a href=\"https://source.chromium.org/chromium/chromium/src/+/master:components/safe_browsing/content/password_protection/password_protection_service.cc;l=304;drc=4e69945675d6aa53455a418ffc764b313842a3ee\">PasswordProtectionServiceBase::RequestFinished</a>","c":[{"t":"list_item","d":10,"p":{"lines":[810,826]},"v":"<pre class=\"language-cpp\"><code class=\"language-cpp\"><span class=\"token keyword\">void</span> <span class=\"token class-name\">PasswordProtectionServiceBase</span><span class=\"token double-colon punctuation\">::</span><span class=\"token function\">RequestFinished</span><span class=\"token punctuation\">(</span>\n    PasswordProtectionRequest<span class=\"token operator\">*</span> request<span class=\"token punctuation\">,</span><span class=\"token punctuation\">.</span><span class=\"token punctuation\">.</span><span class=\"token punctuation\">.</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">{</span>\n<span class=\"token punctuation\">.</span><span class=\"token punctuation\">.</span><span class=\"token punctuation\">.</span>\n    <span class=\"token keyword\">for</span> <span class=\"token punctuation\">(</span><span class=\"token keyword\">auto</span> it <span class=\"token operator\">=</span> pending_requests_<span class=\"token punctuation\">.</span><span class=\"token function\">begin</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span> \n            it <span class=\"token operator\">!=</span> pending_requests_<span class=\"token punctuation\">.</span><span class=\"token function\">end</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n            it<span class=\"token operator\">++</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>it<span class=\"token operator\">-></span><span class=\"token function\">get</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">==</span> request<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n            <span class=\"token comment\">//...</span>\n            pending_requests_<span class=\"token punctuation\">.</span><span class=\"token function\">erase</span><span class=\"token punctuation\">(</span>it<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n            <span class=\"token keyword\">break</span><span class=\"token punctuation\">;</span>\n        <span class=\"token punctuation\">}</span>\n    <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span>\n</code></pre>\n"}]},{"t":"list_item","d":8,"p":{"lines":[826,827]},"v":"<a href=\"https://source.chromium.org/chromium/chromium/src/+/master:components/safe_browsing/content/password_protection/password_protection_service.cc;l=196;drc=4e69945675d6aa53455a418ffc764b313842a3ee\">PasswordProtectionServiceBase::StartRequest</a>","c":[{"t":"list_item","d":10,"p":{"lines":[827,836]},"v":"<pre class=\"language-cpp\"><code class=\"language-cpp\"><span class=\"token keyword\">void</span> <span class=\"token class-name\">PasswordProtectionServiceBase</span><span class=\"token double-colon punctuation\">::</span><span class=\"token function\">StartRequest</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    scoped_refptr<span class=\"token operator\">&lt;</span>PasswordProtectionRequest<span class=\"token operator\">></span> <span class=\"token function\">request</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">new</span> <span class=\"token function\">PasswordProtectionRequest</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    request<span class=\"token operator\">-></span><span class=\"token function\">Start</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    pending_requests_<span class=\"token punctuation\">.</span><span class=\"token function\">insert</span><span class=\"token punctuation\">(</span>std<span class=\"token double-colon punctuation\">::</span><span class=\"token function\">move</span><span class=\"token punctuation\">(</span>request<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span>\n\n</code></pre>\n"}]},{"t":"list_item","d":8,"p":{"lines":[836,837]},"v":"<a href=\"https://source.chromium.org/chromium/chromium/src/+/master:components/safe_browsing/content/password_protection/password_protection_service.h;l=432;drc=4e69945675d6aa53455a418ffc764b313842a3ee\">pending_requests_</a>"}]}]},{"t":"list_item","d":4,"p":{"lines":[838,839]},"v":"replay","c":[{"t":"list_item","d":6,"p":{"lines":[839,931]},"v":"<pre class=\"language-cpp\"><code class=\"language-cpp\"><span class=\"token macro property\"><span class=\"token directive-hash\">#</span><span class=\"token directive keyword\">include</span> <span class=\"token string\">&lt;iostream></span></span>\n<span class=\"token macro property\"><span class=\"token directive-hash\">#</span><span class=\"token directive keyword\">include</span> <span class=\"token string\">&lt;set></span></span>\n<span class=\"token macro property\"><span class=\"token directive-hash\">#</span><span class=\"token directive keyword\">include</span> <span class=\"token string\">&lt;string></span></span>\n<span class=\"token keyword\">using</span> <span class=\"token keyword\">namespace</span> std<span class=\"token punctuation\">;</span>\n\n<span class=\"token macro property\"><span class=\"token directive-hash\">#</span><span class=\"token directive keyword\">define</span> <span class=\"token macro-name\">scoped_refptr</span> <span class=\"token expression\">unique_ptr</span></span>\n\n<span class=\"token keyword\">class</span> <span class=\"token class-name\">PasswordProtectionRequest</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">class</span> <span class=\"token class-name\">PasswordProtectionServiceBase</span><span class=\"token punctuation\">;</span>\n\n\n<span class=\"token keyword\">class</span> <span class=\"token class-name\">PasswordProtectionRequest</span> <span class=\"token punctuation\">{</span>\n<span class=\"token keyword\">public</span><span class=\"token operator\">:</span>\n    <span class=\"token function\">PasswordProtectionRequest</span><span class=\"token punctuation\">(</span>PasswordProtectionServiceBase<span class=\"token operator\">*</span> pps<span class=\"token punctuation\">)</span><span class=\"token operator\">:</span>\n                <span class=\"token function\">password_protection_service_</span><span class=\"token punctuation\">(</span>pps<span class=\"token punctuation\">)</span><span class=\"token punctuation\">{</span><span class=\"token punctuation\">}</span>\n\n    <span class=\"token keyword\">void</span> <span class=\"token function\">Start</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token keyword\">void</span> <span class=\"token function\">OnWhitelistCheckDone</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">bool</span> match_whitelist<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token keyword\">void</span> <span class=\"token function\">FillRequestProto</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">bool</span> is_sampled_ping<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n    <span class=\"token comment\">// |this| will be destroyed after calling this function.</span>\n    <span class=\"token keyword\">void</span> <span class=\"token function\">Finish</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token keyword\">void</span> <span class=\"token function\">SendRequest</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    PasswordProtectionServiceBase<span class=\"token operator\">*</span> password_protection_service_<span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token keyword\">class</span> <span class=\"token class-name\">PasswordProtectionServiceBase</span> <span class=\"token punctuation\">{</span>\n<span class=\"token keyword\">public</span><span class=\"token operator\">:</span>\n    <span class=\"token keyword\">virtual</span> <span class=\"token keyword\">void</span> <span class=\"token function\">RequestFinished</span><span class=\"token punctuation\">(</span>PasswordProtectionRequest<span class=\"token operator\">*</span> request<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token keyword\">void</span> <span class=\"token function\">StartRequest</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    std<span class=\"token double-colon punctuation\">::</span>set<span class=\"token operator\">&lt;</span>scoped_refptr<span class=\"token operator\">&lt;</span>PasswordProtectionRequest<span class=\"token operator\">>></span> pending_requests_<span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token comment\">////////////////////////////////////////////////////////////////////////////</span>\n<span class=\"token keyword\">void</span> <span class=\"token class-name\">PasswordProtectionServiceBase</span><span class=\"token double-colon punctuation\">::</span><span class=\"token function\">StartRequest</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    scoped_refptr<span class=\"token operator\">&lt;</span>PasswordProtectionRequest<span class=\"token operator\">></span> <span class=\"token function\">request</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">new</span> <span class=\"token function\">PasswordProtectionRequest</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">this</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    request<span class=\"token operator\">-></span><span class=\"token function\">Start</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    pending_requests_<span class=\"token punctuation\">.</span><span class=\"token function\">insert</span><span class=\"token punctuation\">(</span>std<span class=\"token double-colon punctuation\">::</span><span class=\"token function\">move</span><span class=\"token punctuation\">(</span>request<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span>\n\n<span class=\"token keyword\">void</span> <span class=\"token class-name\">PasswordProtectionServiceBase</span><span class=\"token double-colon punctuation\">::</span><span class=\"token function\">RequestFinished</span><span class=\"token punctuation\">(</span>PasswordProtectionRequest<span class=\"token operator\">*</span> request<span class=\"token punctuation\">)</span><span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">for</span> <span class=\"token punctuation\">(</span><span class=\"token keyword\">auto</span> it <span class=\"token operator\">=</span> pending_requests_<span class=\"token punctuation\">.</span><span class=\"token function\">begin</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span> it <span class=\"token operator\">!=</span> pending_requests_<span class=\"token punctuation\">.</span><span class=\"token function\">end</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    it<span class=\"token operator\">++</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>it<span class=\"token operator\">-></span><span class=\"token function\">get</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">==</span> request<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n                pending_requests_<span class=\"token punctuation\">.</span><span class=\"token function\">erase</span><span class=\"token punctuation\">(</span>it<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n                <span class=\"token keyword\">break</span><span class=\"token punctuation\">;</span>\n        <span class=\"token punctuation\">}</span>\n    <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span>\n\n<span class=\"token comment\">////////////////////////////////////////////////////////////////////////////</span>\n<span class=\"token keyword\">void</span> <span class=\"token class-name\">PasswordProtectionRequest</span><span class=\"token double-colon punctuation\">::</span><span class=\"token function\">Start</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">{</span>\n        <span class=\"token function\">OnWhitelistCheckDone</span><span class=\"token punctuation\">(</span><span class=\"token boolean\">true</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span>\n\n<span class=\"token keyword\">void</span> <span class=\"token class-name\">PasswordProtectionRequest</span><span class=\"token double-colon punctuation\">::</span><span class=\"token function\">OnWhitelistCheckDone</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">bool</span> match_whitelist<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>match_whitelist<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n            <span class=\"token comment\">// if (password_protection_service_->CanSendSamplePing()) {</span>\n            <span class=\"token keyword\">if</span><span class=\"token punctuation\">(</span><span class=\"token boolean\">true</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">{</span>\n                <span class=\"token function\">FillRequestProto</span><span class=\"token punctuation\">(</span><span class=\"token comment\">/*is_sampled_ping=*/</span><span class=\"token boolean\">true</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        <span class=\"token punctuation\">}</span>\n        <span class=\"token comment\">// Finish(RequestOutcome::MATCHED_WHITELIST, nullptr);</span>\n        <span class=\"token function\">Finish</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span>\n\n<span class=\"token keyword\">void</span> <span class=\"token class-name\">PasswordProtectionRequest</span><span class=\"token double-colon punctuation\">::</span><span class=\"token function\">FillRequestProto</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">bool</span> is_sampled_ping<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token function\">SendRequest</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span>\n\n<span class=\"token keyword\">void</span> <span class=\"token class-name\">PasswordProtectionRequest</span><span class=\"token double-colon punctuation\">::</span><span class=\"token function\">Finish</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">{</span>\n    <span class=\"token comment\">// password_protection_service_->RequestFinished(this, outcome,</span>\n    <span class=\"token comment\">//                                           std::move(response));</span>\n    password_protection_service_<span class=\"token operator\">-></span><span class=\"token function\">RequestFinished</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">this</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span>\n\n<span class=\"token keyword\">void</span> <span class=\"token class-name\">PasswordProtectionRequest</span><span class=\"token double-colon punctuation\">::</span><span class=\"token function\">SendRequest</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token comment\">//if (!request_proto_->SerializeToString(&amp;serialized_request)) {</span>\n    <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span><span class=\"token boolean\">true</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token function\">Finish</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        <span class=\"token comment\">// Finish(RequestOutcome::REQUEST_MALFORMED, nullptr);</span>\n        <span class=\"token keyword\">return</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span>\n\n<span class=\"token keyword\">int</span> <span class=\"token function\">main</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">{</span>\n        PasswordProtectionServiceBase ppsb<span class=\"token punctuation\">;</span>\n        ppsb<span class=\"token punctuation\">.</span><span class=\"token function\">StartRequest</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span>\n</code></pre>\n"}]}]}]})</script>
</body>
</html>
